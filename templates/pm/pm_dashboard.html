{% extends 'base.html' %}
{% load static %}

{% block title %}PM Checklist Dashboard{% endblock %}

{% block content %}
<div class="container">
    <div class="page-inner">
        <!-- Page Header -->
        <div class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4">
            <div>
                <h3 class="fw-bold mb-3">PM Checklist Dashboard</h3>
                <h6 class="op-7 mb-2">Preventive Maintenance Management System</h6>
            </div>
            <div class="ms-md-auto py-2 py-md-0">
                <a href="{% url 'pm_schedule_create' %}" class="btn btn-primary btn-round">
                    <i class="fas fa-plus"></i> Schedule New Checklist
                </a>
            </div>
        </div>

        <!-- Statistics Cards Row -->
        <div class="row row-card-no-pd">
            <div class="col-sm-6 col-md-3">
                <div class="card card-stats card-round">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-5">
                                <div class="icon-big text-center">
                                    <i class="icon-clock text-warning"></i>
                                </div>
                            </div>
                            <div class="col-7 col-stats">
                                <div class="numbers">
                                    <p class="card-category">Pending</p>
                                    <h4 class="card-title">{{ stats.pending_count|default:"0" }}</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-sm-6 col-md-3">
                <div class="card card-stats card-round">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-5">
                                <div class="icon-big text-center">
                                    <i class="icon-exclamation text-danger"></i>
                                </div>
                            </div>
                            <div class="col-7 col-stats">
                                <div class="numbers">
                                    <p class="card-category">Overdue</p>
                                    <h4 class="card-title">{{ stats.overdue_count|default:"0" }}</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-sm-6 col-md-3">
                <div class="card card-stats card-round">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-5">
                                <div class="icon-big text-center">
                                    <i class="fas fa-check-circle text-success"></i>
                                </div>
                            </div>
                            <div class="col-7 col-stats">
                                <div class="numbers">
                                    <p class="card-category">Completed Today</p>
                                    <h4 class="card-title">{{ stats.completed_today_count|default:"0" }}</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-sm-6 col-md-3">
                <div class="card card-stats card-round">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-5">
                                <div class="icon-big text-center">
                                    <i class="fas fa-tools text-info"></i>
                                </div>
                            </div>
                            <div class="col-7 col-stats">
                                <div class="numbers">
                                    <p class="card-category">Open Issues</p>
                                    <h4 class="card-title">{{ stats.open_issues_count|default:"0" }}</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Row -->
        <div class="row mt-4">
            <!-- Pending Checklists -->
            <div class="col-md-6">
                <div class="card card-round">
                    <div class="card-header">
                        <div class="card-head-row">
                            <div class="card-title">
                                <i class="fas fa-clipboard-list me-2"></i>Pending Checklists
                            </div>
                            <div class="card-tools">
                                <a href="{% url 'pm_checklist_list' %}?status=PENDING" class="btn btn-label-primary btn-round btn-sm">
                                    <span class="btn-label">
                                        <i class="fa fa-eye"></i>
                                    </span>
                                    View All
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        {% if pending_checklists %}
                            {% for schedule in pending_checklists %}
                            <div class="d-flex mb-3 pb-3 border-bottom">
                                <div class="flex-1">
                                    <div class="mb-2">
                                        <span class="badge badge-{% if schedule.template.annex_code == 'A' %}primary{% elif schedule.template.annex_code == 'B' %}info{% elif schedule.template.annex_code == 'C' %}success{% else %}warning{% endif %}">
                                            Annex {{ schedule.template.annex_code }}
                                        </span>
                                    </div>
                                    <h5 class="fw-bold mb-1">{{ schedule.template.title }}</h5>
                                    <div class="text-muted small">
                                        <i class="fas fa-calendar me-1"></i>Due: {{ schedule.due_date|date:"M d, Y" }}
                                        {% if schedule.assigned_to %}
                                        <span class="ms-2">
                                            <i class="fas fa-user me-1"></i>{{ schedule.assigned_to.get_full_name|default:schedule.assigned_to.username }}
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <a href="{% url 'pm_checklist_fill' schedule.id %}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-edit"></i> Fill
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-5">
                                <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                                <h5 class="fw-bold">All Clear!</h5>
                                <p class="text-muted">No pending checklists at the moment</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Overdue Checklists -->
            <div class="col-md-6">
                <div class="card card-round">
                    <div class="card-header">
                        <div class="card-head-row">
                            <div class="card-title">
                                <i class="fas fa-exclamation-triangle me-2"></i>Overdue Checklists
                            </div>
                            <div class="card-tools">
                                <a href="{% url 'pm_checklist_list' %}?status=OVERDUE" class="btn btn-label-danger btn-round btn-sm">
                                    <span class="btn-label">
                                        <i class="fa fa-eye"></i>
                                    </span>
                                    View All
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        {% if overdue_checklists %}
                            {% for schedule in overdue_checklists %}
                            <div class="d-flex mb-3 pb-3 border-bottom border-danger">
                                <div class="flex-1">
                                    <div class="mb-2">
                                        <span class="badge badge-{% if schedule.template.annex_code == 'A' %}primary{% elif schedule.template.annex_code == 'B' %}info{% elif schedule.template.annex_code == 'C' %}success{% else %}warning{% endif %}">
                                            Annex {{ schedule.template.annex_code }}
                                        </span>
                                        <span class="badge badge-danger ms-1">OVERDUE</span>
                                    </div>
                                    <h5 class="fw-bold mb-1 text-danger">{{ schedule.template.title }}</h5>
                                    <div class="text-danger small">
                                        <i class="fas fa-calendar-times me-1"></i>Due: {{ schedule.due_date|date:"M d, Y" }} 
                                        <span class="fw-bold">({{ schedule.due_date|timesince }} ago)</span>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <a href="{% url 'pm_checklist_fill' schedule.id %}" class="btn btn-danger btn-sm">
                                        <i class="fas fa-bolt"></i> Now
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-5">
                                <i class="fas fa-smile fa-3x text-success mb-3"></i>
                                <h5 class="fw-bold">Perfect!</h5>
                                <p class="text-muted">No overdue checklists</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Second Row -->
        <div class="row mt-4">
            <!-- Completed Today -->
            <div class="col-md-6">
                <div class="card card-round">
                    <div class="card-header">
                        <div class="card-head-row">
                            <div class="card-title">
                                <i class="fas fa-history me-2"></i>Completed Today
                            </div>
                            <div class="card-tools">
                                <a href="{% url 'pm_checklist_list' %}?status=COMPLETED" class="btn btn-label-success btn-round btn-sm">
                                    <span class="btn-label">
                                        <i class="fa fa-eye"></i>
                                    </span>
                                    View All
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        {% if completed_today %}
                            {% for completion in completed_today %}
                            <div class="d-flex mb-3 pb-3 border-bottom border-success">
                                <div class="flex-1">
                                    <div class="mb-2">
                                        <span class="badge badge-{% if completion.schedule.template.annex_code == 'A' %}primary{% elif completion.schedule.template.annex_code == 'B' %}info{% elif completion.schedule.template.annex_code == 'C' %}success{% else %}warning{% endif %}">
                                            Annex {{ completion.schedule.template.annex_code }}
                                        </span>
                                    </div>
                                    <h6 class="fw-bold mb-1">{{ completion.schedule.template.title }}</h6>
                                    <div class="text-muted small">
                                        <i class="fas fa-user-check me-1"></i>{{ completion.completed_by.get_full_name|default:completion.completed_by.username }}
                                        <span class="ms-2">
                                            <i class="fas fa-clock me-1"></i>{{ completion.completion_time|time:"g:i A" }}
                                        </span>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <div class="btn-group-vertical">
                                        <a href="{% url 'pm_checklist_view' completion.id %}" class="btn btn-info btn-sm mb-1">
                                            <i class="fas fa-eye"></i> View
                                        </a>
                                        <a href="{% url 'pm_export_checklist_pdf' completion.id %}" class="btn btn-secondary btn-sm">
                                            <i class="fas fa-file-pdf"></i> PDF
                                        </a>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-5">
                                <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                                <h5 class="fw-bold">No completions yet</h5>
                                <p class="text-muted">Checklists completed today will appear here</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Open Issues -->
            <div class="col-md-6">
                <div class="card card-round">
                    <div class="card-header">
                        <div class="card-head-row">
                            <div class="card-title">
                                <i class="fas fa-wrench me-2"></i>Open Issues
                            </div>
                            <div class="card-tools">
                                <a href="{% url 'pm_issues' %}" class="btn btn-label-warning btn-round btn-sm">
                                    <span class="btn-label">
                                        <i class="fa fa-eye"></i>
                                    </span>
                                    View All
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        {% if open_issues %}
                            {% for issue in open_issues %}
                            <div class="d-flex mb-3 pb-3 border-bottom">
                                <div class="flex-1">
                                    <div class="mb-2">
                                        {% if issue.priority == 'CRITICAL' %}
                                            <span class="badge badge-danger">Critical</span>
                                        {% elif issue.priority == 'HIGH' %}
                                            <span class="badge badge-warning">High</span>
                                        {% elif issue.priority == 'MEDIUM' %}
                                            <span class="badge badge-info">Medium</span>
                                        {% else %}
                                            <span class="badge badge-secondary">Low</span>
                                        {% endif %}
                                    </div>
                                    <h6 class="fw-bold mb-1">{{ issue.issue_title }}</h6>
                                    <div class="text-muted small">
                                        <i class="fas fa-user me-1"></i>{{ issue.reported_by.get_full_name|default:issue.reported_by.username }}
                                        <span class="ms-2">
                                            <i class="fas fa-calendar me-1"></i>{{ issue.reported_at|date:"M d, Y" }}
                                        </span>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <a href="{% url 'pm_issue_update' issue.id %}" class="btn btn-warning btn-sm">
                                        <i class="fas fa-edit"></i> Update
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-5">
                                <i class="fas fa-thumbs-up fa-3x text-success mb-3"></i>
                                <h5 class="fw-bold">Excellent!</h5>
                                <p class="text-muted">No open issues to resolve</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions Card -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card card-round">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-bolt me-2"></i>Quick Actions
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6 col-md-3 mb-3">
                                <a href="{% url 'pm_schedule_create' %}" class="btn btn-primary btn-lg btn-block">
                                    <i class="fas fa-plus-circle fa-2x mb-2"></i>
                                    <br>Schedule Checklist
                                </a>
                            </div>
                            <div class="col-6 col-md-3 mb-3">
                                <a href="{% url 'pm_generate_report' %}" class="btn btn-success btn-lg btn-block">
                                    <i class="fas fa-file-pdf fa-2x mb-2"></i>
                                    <br>Generate Report
                                </a>
                            </div>
                            <div class="col-6 col-md-3 mb-3">
                                <a href="{% url 'pm_checklist_list' %}" class="btn btn-info btn-lg btn-block">
                                    <i class="fas fa-list fa-2x mb-2"></i>
                                    <br>View All Checklists
                                </a>
                            </div>
                            <div class="col-6 col-md-3 mb-3">
                                <a href="{% url 'pm_reports' %}" class="btn btn-secondary btn-lg btn-block">
                                    <i class="fas fa-folder fa-2x mb-2"></i>
                                    <br>View Reports
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}