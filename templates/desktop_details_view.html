{% extends 'base.html' %}
{% load static %} 
{% block content %}
{% load custom_filters %}

<style>
/* Modern Design System */
:root {
  --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
  --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}

/* Modern Container */
.modern-container {
  background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 50%, #ddd6fe 100%);
  min-height: 100vh;
  padding: 2rem;
  padding-top: 6rem;
}

/* Hero Header Card */
.hero-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #ec4899 100%);
  border-radius: 1.5rem;
  padding: 2rem;
  color: white;
  box-shadow: var(--shadow-xl);
  position: relative;
  overflow: hidden;
  margin-bottom: 2rem;
}

.hero-header::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -20%;
  width: 300px;
  height: 300px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 50%;
}

.hero-header::after {
  content: '';
  position: absolute;
  bottom: -30%;
  left: -10%;
  width: 200px;
  height: 200px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 50%;
}

.hero-content {
  position: relative;
  z-index: 1;
}

.hero-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1rem;
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  border-radius: 1rem;
  margin-bottom: 1rem;
}

.hero-title {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}

.info-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-top: 1.5rem;
}

.info-card {
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(10px);
  border-radius: 1rem;
  padding: 1.25rem;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.info-label {
  font-size: 0.875rem;
  opacity: 0.8;
  margin-bottom: 0.25rem;
}

.info-value {
  font-size: 1.25rem;
  font-weight: 600;
}

/* Modern Action Buttons */
.action-buttons {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.modern-btn {
  padding: 0.75rem 1.5rem;
  border-radius: 1rem;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  box-shadow: var(--shadow-md);
}

.modern-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-primary {
  background: white;
  color: #667eea;
}

.btn-secondary {
  background: rgba(255, 255, 255, 0.2);
  color: white;
  backdrop-filter: blur(10px);
}

/* Modern Tab Navigation */
.modern-tabs {
  background: white;
  border-radius: 1.5rem;
  padding: 0.5rem;
  box-shadow: var(--shadow-xl);
  margin-bottom: 1.5rem;
  display: flex;
  overflow-x: auto;
  gap: 0.5rem;
}

.modern-tabs::-webkit-scrollbar {
  height: 4px;
}

.modern-tabs::-webkit-scrollbar-thumb {
  background: #e5e7eb;
  border-radius: 2px;
}

.nav-pills .nav-link {
  padding: 1rem 1.5rem;
  border-radius: 1rem;
  border: none;
  background: transparent;
  cursor: pointer;
  font-weight: 600;
  color: #6b7280;
  transition: all 0.3s ease;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.nav-pills .nav-link:hover {
  background: #f3f4f6;
}

.nav-pills .nav-link.active {
  background: var(--gradient-primary);
  color: white;
  box-shadow: var(--shadow-md);
}

/* Modern Card */
.modern-card {
  background: white;
  border-radius: 1.5rem;
  padding: 2rem;
  box-shadow: var(--shadow-xl);
  margin-bottom: 1.5rem;
}

.card-header-modern {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.card-title-modern {
  font-size: 1.75rem;
  font-weight: 700;
  color: #1f2937;
}

/* Spec Grid */
.spec-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.spec-item {
  background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
  border: 1px solid #e5e7eb;
  border-radius: 1rem;
  padding: 1.25rem;
  transition: all 0.3s ease;
}

.spec-item:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
  border-color: #667eea;
}

.spec-label {
  font-size: 0.875rem;
  color: #6b7280;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.spec-value {
  font-size: 1.125rem;
  font-weight: 700;
  color: #1f2937;
}

/* Software Section */
.software-section {
  margin-top: 1.5rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
  border: 1px solid #93c5fd;
  border-radius: 1rem;
}

.software-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 700;
  color: #1e40af;
  margin-bottom: 1rem;
}

/* PM Schedule Sidebar */
.pm-schedule-card {
  background: white;
  border-radius: 1.5rem;
  padding: 1.5rem;
  box-shadow: var(--shadow-xl);
}

.pm-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.pm-icon {
  padding: 1rem;
  background: var(--gradient-success);
  border-radius: 1rem;
  color: white;
}

.pm-item {
  border: 1px solid #e5e7eb;
  border-radius: 1rem;
  padding: 1.25rem;
  margin-bottom: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.pm-item:hover {
  box-shadow: var(--shadow-md);
  border-color: #667eea;
}

.pm-status {
  display: inline-flex;
  align-items: center;
  padding: 0.375rem 0.75rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 600;
}

.status-completed {
  background: #d1fae5;
  color: #065f46;
}

.status-pending {
  background: #fef3c7;
  color: #92400e;
}

/* Badge System */
.badge-modern {
  display: inline-flex;
  align-items: center;
  padding: 0.5rem 1rem;
  border-radius: 9999px;
  font-size: 0.875rem;
  font-weight: 600;
}

.badge-success {
  background: #d1fae5;
  color: #065f46;
}

.badge-danger {
  background: #fee2e2;
  color: #991b1b;
}

/* Quick Actions */
.quick-actions {
  background: white;
  border-radius: 1.5rem;
  padding: 1.5rem;
  box-shadow: var(--shadow-xl);
  margin-bottom: 1.5rem;
}

.action-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem;
  background: #f9fafb;
  border-radius: 1rem;
  margin-bottom: 0.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  color: inherit;
}

.action-item:hover {
  background: #f3f4f6;
  transform: translateX(4px);
}

/* Status Card */
.status-card {
  background: var(--gradient-success);
  color: white;
  border-radius: 1.5rem;
  padding: 1.5rem;
  box-shadow: var(--shadow-xl);
}

.status-disposed {
  background: var(--gradient-danger);
}

/* Table Modern */
.table-modern {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 0.5rem;
}

.table-modern thead th {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 1rem;
  font-weight: 600;
  text-align: left;
}

.table-modern thead th:first-child {
  border-radius: 1rem 0 0 1rem;
}

.table-modern thead th:last-child {
  border-radius: 0 1rem 1rem 0;
}

.table-modern tbody tr {
  background: white;
  box-shadow: var(--shadow-sm);
  transition: all 0.3s ease;
}

.table-modern tbody tr:hover {
  transform: translateX(4px);
  box-shadow: var(--shadow-md);
}

.table-modern tbody td {
  padding: 1rem;
  border-top: 1px solid #f3f4f6;
  border-bottom: 1px solid #f3f4f6;
}

.table-modern tbody td:first-child {
  border-left: 1px solid #f3f4f6;
  border-radius: 1rem 0 0 1rem;
}

.table-modern tbody td:last-child {
  border-right: 1px solid #f3f4f6;
  border-radius: 0 1rem 1rem 0;
}

/* Responsive */
@media (max-width: 768px) {
  .hero-title {
    font-size: 1.75rem;
  }
  
  .modern-tabs {
    padding: 0.25rem;
  }
  
  .nav-pills .nav-link {
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
  }
  
  .spec-grid {
    grid-template-columns: 1fr;
  }
}
</style>

<div class="modern-container">
  <div class="container-fluid">
    
    <!-- Hero Header -->
    <div class="hero-header">
      <div class="hero-content">
        <div class="d-flex justify-content-between align-items-start flex-wrap">
          <div class="flex-grow-1">
            <div class="hero-badge">
              <i class="fas fa-desktop"></i>
              <span>Desktop Package</span>
            </div>
            <h1 class="hero-title">{{ desktop_detailsx.computer_name }}</h1>
            
            <div class="info-cards">
              <div class="info-card">
                <div class="info-label">Asset Owner</div>
                <div class="info-value">{{ user_details.user_Assetowner.employee_fname }} {{ user_details.user_Assetowner.employee_lname }}</div>
                <small style="opacity: 0.9;">{{ user_details.user_Assetowner.employee_position }}</small>
              </div>
              <div class="info-card">
                <div class="info-label">Office</div>
                <div class="info-value">{{ user_details.user_Assetowner.employee_office_section }}</div>
                <small style="opacity: 0.9;">Engineering Department</small>
              </div>
            </div>
          </div>
          
          <div class="action-buttons mt-3 mt-md-0">
            <a href="{% url 'generate_desktop_pdf' equipment_package.id %}" class="modern-btn btn-primary">
              <i class="fa fa-file-pdf"></i>
              PDF
            </a>
            <button class="modern-btn btn-secondary" data-bs-toggle="modal" data-bs-target="#qrModal">
              <i class="fas fa-qrcode"></i>
              QR
            </button>
            {% if not desktop_detailsx.is_disposed %}
            <button class="modern-btn btn-secondary" data-bs-toggle="modal" data-bs-target="#disposeModal">
              <i class="fa fa-location-arrow"></i>
              Return
            </button>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- Main Content -->
      <div class="col-lg-8">
        
        <!-- Modern Tab Navigation -->
        <ul class="nav nav-pills modern-tabs" id="pills-tab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active " id="pills-desktop-tab" data-bs-toggle="pill" data-bs-target="#pills-desktop" type="button" role="tab">
              <i class="fas fa-desktop"></i> Desktop
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-monitor-tab" data-bs-toggle="pill" data-bs-target="#pills-monitor" type="button" role="tab">
              <i class="fas fa-tv"></i> Monitor
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-keyboard-tab" data-bs-toggle="pill" data-bs-target="#pills-keyboard" type="button" role="tab">
              <i class="fas fa-keyboard"></i> Keyboard
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-mouse-tab" data-bs-toggle="pill" data-bs-target="#pills-mouse" type="button" role="tab">
              <i class="fas fa-mouse-pointer"></i> Mouse
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-ups-tab" data-bs-toggle="pill" data-bs-target="#pills-ups" type="button" role="tab">
              <i class="fas fa-battery-full"></i> UPS
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-user-tab" data-bs-toggle="pill" data-bs-target="#pills-user" type="button" role="tab">
              <i class="fas fa-user"></i> User
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-documents-tab" data-bs-toggle="pill" data-bs-target="#pills-documents" type="button" role="tab">
              <i class="fas fa-file-alt"></i> Documents
            </button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="pills-tabContent">
          
          <!-- Desktop Tab -->
          <div class="tab-pane fade show active" id="pills-desktop" role="tabpanel">
            <div class="modern-card">
              <div class="card-header-modern">
                <h2 class="card-title-modern">Desktop Specifications</h2>
                <div class="d-flex gap-2">
                  <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editDesktopModal">
                    <i class="fa fa-edit"></i> Edit
                  </button>
                  {% if not desktop_detailsx.is_disposed %}
                  <button class="btn btn-danger rounded-pill" data-bs-toggle="modal" data-bs-target="#disposeModal">
                    <i class="fa fa-trash"></i> Dispose
                  </button>
                  {% endif %}
                </div>
              </div>

              {% if has_active_desktop %}
              <div class="spec-grid">
                <div class="spec-item">
                  <div class="spec-label">Serial Number</div>
                  <div class="spec-value">{{ desktop_detailsx.serial_no }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Brand</div>
                  <div class="spec-value">{{ desktop_detailsx.brand_name }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Model</div>
                  <div class="spec-value">{{ desktop_detailsx.model }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Processor</div>
                  <div class="spec-value">{{ desktop_detailsx.processor }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Memory</div>
                  <div class="spec-value">{{ desktop_detailsx.memory }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Storage</div>
                  <div class="spec-value">{{ desktop_detailsx.drive }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Graphics</div>
                  <div class="spec-value">{{ desktop_detailsx.desktop_Graphics|default:"—" }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Graphics Size</div>
                  <div class="spec-value">{{ desktop_detailsx.desktop_Graphics_Size|default:"—" }}</div>
                </div>
              </div>

              <div class="software-section">
                <h3 class="software-title">
                  <i class="fas fa-cog"></i>
                  Software Details
                </h3>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <div class="spec-label">Operating System</div>
                    <div class="spec-value">{{ desktop_detailsx.desktop_OS|default:"—" }}</div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <div class="spec-label">Office Version</div>
                    <div class="spec-value">{{ desktop_detailsx.desktop_Office|default:"—" }}</div>
                  </div>
                  <div class="col-md-6">
                    <div class="spec-label">OS Key</div>
                    <div class="spec-value" style="font-size: 0.875rem;">{{ desktop_detailsx.desktop_OS_keys|default:"—" }}</div>
                  </div>
                  <div class="col-md-6">
                    <div class="spec-label">Office Key</div>
                    <div class="spec-value" style="font-size: 0.875rem;">{{ desktop_detailsx.desktop_Office_keys|default:"—" }}</div>
                  </div>
                </div>
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Monitor Tab -->
          <div class="tab-pane fade" id="pills-monitor" role="tabpanel">
            <div class="modern-card">
              <div class="card-header-modern">
                <h2 class="card-title-modern">Monitor Details</h2>
                {% if not has_active_monitor and has_active_desktop %}
                <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#addMonitorModal">
                  <i class="fa fa-plus"></i> Add Monitor
                </button>
                {% endif %}
              </div>

              {% if monitor_detailse %}
              <div class="spec-grid">
                <div class="spec-item">
                  <div class="spec-label">Serial Number</div>
                  <div class="spec-value">{{ monitor_detailse.monitor_sn_db }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Brand</div>
                  <div class="spec-value">{{ monitor_detailse.monitor_brand_db }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Model</div>
                  <div class="spec-value">{{ monitor_detailse.monitor_model_db }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Size</div>
                  <div class="spec-value">{{ monitor_detailse.monitor_size_db }}</div>
                </div>
              </div>

              <div class="mt-4 d-flex gap-2">
                <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editMonitorModal">
                  <i class="fa fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger rounded-pill" data-bs-toggle="modal" data-bs-target="#confirmDisposeModal_Monitor">
                  <i class="fa fa-trash"></i> Dispose
                </button>
              </div>
              {% else %}
              <div class="alert alert-info" style="border-radius: 1rem;">
                <i class="fas fa-info-circle"></i>
                No monitor available for this desktop package.
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Keyboard Tab -->
          <div class="tab-pane fade" id="pills-keyboard" role="tabpanel">
            <div class="modern-card">
              <div class="card-header-modern">
                <h2 class="card-title-modern">Keyboard Details</h2>
                {% if not has_active_keyboards and has_active_desktop %}
                <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#addKeyboardModal">
                  <i class="fa fa-plus"></i> Add Keyboard
                </button>
                {% endif %}
              </div>

              {% if keyboard_detailse %}
              <div class="spec-grid">
                <div class="spec-item">
                  <div class="spec-label">Serial Number</div>
                  <div class="spec-value">{{ keyboard_detailse.keyboard_sn_db }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Brand</div>
                  <div class="spec-value">{{ keyboard_detailse.keyboard_brand_db }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Model</div>
                  <div class="spec-value">{{ keyboard_detailse.keyboard_model_db }}</div>
                </div>
              </div>
              <div class="mt-4 d-flex gap-2">
                <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editKeyboardModal">
                  <i class="fa fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger rounded-pill" data-bs-toggle="modal" data-bs-target="#confirmDisposeModalKeyboard">
                  <i class="fa fa-trash"></i> Dispose
                </button>
              </div>
              {% else %}
              <div class="alert alert-info" style="border-radius: 1rem;">
                <i class="fas fa-info-circle"></i>
                No keyboard available for this desktop package.
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Mouse Tab -->
          <div class="tab-pane fade" id="pills-mouse" role="tabpanel">
            <div class="modern-card">
              <div class="card-header-modern">
                <h2 class="card-title-modern">Mouse Details</h2>
                {% if not has_active_mouse and has_active_desktop %}
                <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#addMouseModal">
                  <i class="fa fa-plus"></i> Add Mouse
                </button>
                {% endif %}
              </div>

              {% if mouse_detailse %}
              <div class="spec-grid">
                <div class="spec-item">
                  <div class="spec-label">Serial Number</div>
                  <div class="spec-value">{{ mouse_detailse.mouse_sn_db }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Brand</div>
                  <div class="spec-value">{{ mouse_detailse.mouse_brand_db }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Model</div>
                  <div class="spec-value">{{ mouse_detailse.mouse_model_db }}</div>
                </div>
              </div>
              <div class="mt-4 d-flex gap-2">
                <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editMouseModal">
                  <i class="fa fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger rounded-pill" data-bs-toggle="modal" data-bs-target="#confirmDisposeMouseModal">
                  <i class="fa fa-trash"></i> Dispose
                </button>
              </div>
              {% else %}
              <div class="alert alert-info" style="border-radius: 1rem;">
                <i class="fas fa-info-circle"></i>
                No mouse available for this desktop package.
              </div>
              {% endif %}
            </div>
          </div>

          <!-- UPS Tab -->
          <div class="tab-pane fade" id="pills-ups" role="tabpanel">
            <div class="modern-card">
              <div class="card-header-modern">
                <h2 class="card-title-modern">UPS Details</h2>
                {% if not has_active_ups and has_active_desktop %}
                <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#addUPSModal">
                  <i class="fa fa-plus"></i> Add UPS
                </button>
                {% endif %}
              </div>

              {% if ups_detailse %}
              <div class="spec-grid">
                <div class="spec-item">
                  <div class="spec-label">Serial Number</div>
                  <div class="spec-value">{{ ups_detailse.ups_sn_db }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Brand</div>
                  <div class="spec-value">{{ ups_detailse.ups_brand_db }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Model</div>
                  <div class="spec-value">{{ ups_detailse.ups_model_db }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Capacity</div>
                  <div class="spec-value">{{ ups_detailse.ups_capacity_db }}</div>
                </div>
              </div>
              <div class="mt-4 d-flex gap-2">
                <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editUpsModal">
                  <i class="fa fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger rounded-pill" data-bs-toggle="modal" data-bs-target="#confirmDisposeUpsModal">
                  <i class="fa fa-trash"></i> Dispose
                </button>
              </div>
              {% else %}
              <div class="alert alert-info" style="border-radius: 1rem;">
                <i class="fas fa-info-circle"></i>
                No UPS available for this desktop package.
              </div>
              {% endif %}
            </div>
          </div>

          <!-- User Tab -->
          <div class="tab-pane fade" id="pills-user" role="tabpanel">
            <div class="modern-card">
              <div class="card-header-modern">
                <h2 class="card-title-modern">User Details</h2>
              </div>

              {% if user_details %}
              <div class="spec-grid">
                <div class="spec-item">
                  <div class="spec-label">Asset Owner</div>
                  <div class="spec-value">{{ user_details.user_Assetowner.employee_fname }} {{ user_details.user_Assetowner.employee_lname }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Designation</div>
                  <div class="spec-value">{{ user_details.user_Assetowner.employee_position }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Office</div>
                  <div class="spec-value">{{ user_details.user_Assetowner.employee_office_section }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">End User</div>
                  <div class="spec-value">{{ user_details.user_Enduser.employee_fname }} {{ user_details.user_Enduser.employee_lname }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">End User Designation</div>
                  <div class="spec-value">{{ user_details.user_Enduser.employee_position }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">End User Office</div>
                  <div class="spec-value">{{ user_details.user_Enduser.employee_office_section }}</div>
                </div>
              </div>

              <div class="mt-4 d-flex gap-2">
                <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editEndUserModal">
                  <i class="fa fa-edit"></i> Edit User
                </button>
                <button class="btn btn-warning rounded-pill" data-bs-toggle="modal" data-bs-target="#editAssetOwnerModal">
                  <i class="fa fa-exchange-alt"></i> Transfer Ownership
                </button>
              </div>
              {% else %}
              <div class="alert alert-info" style="border-radius: 1rem;">
                <i class="fas fa-info-circle"></i>
                No user details available.
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Documents Tab -->
          <div class="tab-pane fade" id="pills-documents" role="tabpanel">
            <div class="modern-card">
              <div class="card-header-modern">
                <h2 class="card-title-modern">Documents Details</h2>
                <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editDocumentsdModal">
                  <i class="fa fa-edit"></i> Edit
                </button>
              </div>

              <div class="spec-grid">
                <div class="spec-item">
                  <div class="spec-label">PAR Number</div>
                  <div class="spec-value">{{ documents_detailse.docs_PAR }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Property Number</div>
                  <div class="spec-value">{{ documents_detailse.docs_Propertyno }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Acquisition Type</div>
                  <div class="spec-value">{{ documents_detailse.docs_Acquisition_Type }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Package Value</div>
                  <div class="spec-value">{{ documents_detailse.docs_Value }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Date Received</div>
                  <div class="spec-value">{{ documents_detailse.docs_Datereceived }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Date Inspected</div>
                  <div class="spec-value">{{ documents_detailse.docs_Dateinspected }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Supplier</div>
                  <div class="spec-value">{{ documents_detailse.docs_Supplier }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Status</div>
                  <div class="spec-value">
                    {% if equipment_package.is_disposed %}
                      <span class="badge-modern badge-danger">Disposed</span>
                    {% else %}
                      <span class="badge-modern badge-success">Operational</span>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
          
        </div>
      </div>

      <!-- Sidebar -->
      <div class="col-lg-4">
        
        <!-- PM Schedule Card -->
        <div class="pm-schedule-card">
          <div class="pm-header">
            <div class="pm-icon">
              <i class="fas fa-wrench fa-lg"></i>
            </div>
            <div>
              <h3 style="font-weight: 700; margin: 0; color: #1f2937;">PM Schedule</h3>
              <small style="color: #6b7280;">Maintenance Status</small>
            </div>
          </div>

          {% if pm_assignments %}
          <div>
            {% for assignment in pm_assignments %}
            <div class="pm-item">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div class="d-flex align-items-center gap-2">
                  {% if assignment.is_completed %}
                  <i class="fas fa-check-circle" style="color: #10b981;"></i>
                  {% else %}
                  <i class="fas fa-clock" style="color: #f59e0b;"></i>
                  {% endif %}
                  <strong>{{ assignment.pm_section_schedule.quarter_schedule.get_quarter_display }} {{ assignment.pm_section_schedule.quarter_schedule.year }}</strong>
                </div>
                <span class="pm-status {% if assignment.is_completed %}status-completed{% else %}status-pending{% endif %}">
                  {% if assignment.is_completed %}Completed{% else %}Pending{% endif %}
                </span>
              </div>
              <div style="color: #6b7280; font-size: 0.875rem;">{{ assignment.pm_section_schedule.section.name }}</div>
              <div style="color: #9ca3af; font-size: 0.75rem; margin-top: 0.5rem;">
                <i class="far fa-calendar"></i>
                {{ assignment.pm_section_schedule.start_date }} - {{ assignment.pm_section_schedule.end_date }}
              </div>
            </div>
            {% endfor %}
          </div>

          <a href="{% url 'checklist' equipment_package.id %}" class="btn w-100 rounded-pill mt-3" style="background: var(--gradient-success); color: white; font-weight: 600;">
            <i class="fas fa-wrench"></i> Conduct PM
          </a>
          {% else %}
          <p style="color: #6b7280; margin: 0;">No PM schedule found for this desktop.</p>
          {% endif %}
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions mt-4">
          <h4 style="font-weight: 700; margin-bottom: 1rem; color: #1f2937;">Quick Actions</h4>
          
          <a href="{% url 'export_desktop_excel' %}" class="action-item">
            <div class="d-flex align-items-center gap-3">
              <div style="padding: 0.75rem; background: #dcfce7; color: #16a34a; border-radius: 0.75rem;">
                <i class="fa fa-file-excel"></i>
              </div>
              <span style="font-weight: 600;">Export to Excel</span>
            </div>
            <i class="fas fa-chevron-right" style="color: #d1d5db;"></i>
          </a>

          <a href="{% url 'maintenance_history' equipment_package.id %}" class="action-item">
            <div class="d-flex align-items-center gap-3">
              <div style="padding: 0.75rem; background: #dbeafe; color: #2563eb; border-radius: 0.75rem;">
                <i class="fa fa-history"></i>
              </div>
              <span style="font-weight: 600;">View History</span>
            </div>
            <i class="fas fa-chevron-right" style="color: #d1d5db;"></i>
          </a>

          <a href="{% url 'generate_desktop_pdf' equipment_package.id %}" class="action-item">
            <div class="d-flex align-items-center gap-3">
              <div style="padding: 0.75rem; background: #e0e7ff; color: #6366f1; border-radius: 0.75rem;">
                <i class="fa fa-file-pdf"></i>
              </div>
              <span style="font-weight: 600;">Generate Report</span>
            </div>
            <i class="fas fa-chevron-right" style="color: #d1d5db;"></i>
          </a>
        </div>

        <!-- Status Card -->
        <div class="{% if desktop_detailsx.is_disposed %}status-card status-disposed{% else %}status-card{% endif %} mt-4">
          <div class="d-flex align-items-center gap-3 mb-3">
            {% if desktop_detailsx.is_disposed %}
            <i class="fas fa-exclamation-triangle fa-2x"></i>
            {% else %}
            <i class="fas fa-check-circle fa-2x"></i>
            {% endif %}
            <div>
              <h3 style="font-weight: 700; margin: 0;">
                {% if desktop_detailsx.is_disposed %}Disposed{% else %}Operational{% endif %}
              </h3>
              <small style="opacity: 0.9;">Equipment Status</small>
            </div>
          </div>
          <p style="opacity: 0.95; margin: 0; font-size: 0.875rem;">
            {% if desktop_detailsx.is_disposed %}
            This equipment has been disposed and is no longer in active use.
            {% else %}
            This equipment is currently operational and assigned to {{ user_details.user_Assetowner.employee_office_section }}.
            {% endif %}
          </p>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- QR Modal -->
<div class="modal fade" id="qrModal" tabindex="-1" aria-labelledby="qrModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 1.5rem; border: none;">
      <div class="modal-header" style="border-bottom: 1px solid #f3f4f6;">
        <h5 class="modal-title" id="qrModalLabel" style="font-weight: 700;">Desktop Package QR Code</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center" style="padding: 2rem;">
        {% if equipment_package.qr_code %}
          <div style="background: #f9fafb; padding: 2rem; border-radius: 1rem; display: inline-block;">
            <img id="qrImage" src="{{ equipment_package.qr_code.url }}" alt="QR Code" width="200" style="border-radius: 0.5rem;">
          </div>
          <p class="mt-3" style="color: #6b7280;">Scan to view this desktop package</p>
          <button class="btn btn-primary rounded-pill mt-3" onclick="printQrCode()" style="padding: 0.75rem 2rem;">
            <i class="fa fa-print"></i> Print Wallet-Size QR
          </button>
        {% else %}
          <p>No QR code available.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
function printQrCode() {
  const qrImage = document.getElementById("qrImage");
  if (!qrImage) {
    alert("No QR code to print.");
    return;
  }
  const printWindow = window.open("", "_blank", "width=400,height=250");
  printWindow.document.write(`
    <html>
      <head>
        <title>Print QR Code</title>
        <style>
          @page { size: 3.5in 2in; margin: 0; }
          body { width: 3.5in; height: 2in; display: flex; align-items: center; justify-content: center; margin: 0; font-family: Arial, sans-serif; }
          .card { width: 1.8in; height: 1.8in; border: 2px solid black; border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
          img { width: 1.1in; height: 1.1in; }
          .footer { margin-top: 6px; font-weight: bold; font-size: 14px; text-transform: uppercase; }
        </style>
      </head>
      <body>
        <div class="card">
          <img src="${qrImage.src}" alt="QR Code">
          <div class="footer">DPWH PROPERTY</div>
        </div>
        <script>window.onload = function() { window.print(); window.close(); }<\/script>
      </body>
    </html>
  `);
  printWindow.document.close();
}
</script>

<!-- Keep all your existing modals for Edit Desktop, Add Monitor, Dispose, etc. -->
<!-- Include them from your original template -->

{% comment %}
Include all your existing modals here:
- editDesktopModal
- addMonitorModal
- editMonitorModal
- confirmDisposeModal_Monitor
- addKeyboardModal
- editKeyboardModal
- confirmDisposeModalKeyboard
- addMouseModal
- editMouseModal
- confirmDisposeMouseModal
- addUPSModal
- editUpsModal
- confirmDisposeUpsModal
- disposeModal
- editEndUserModal
- editAssetOwnerModal
- editDocumentsdModal
{% endcomment %}

<!-- Edit Desktop Modal -->
 {% include 'desktop/modals/desk/edit_desktop_modal.html' %}
<!-- Dispose Desktop Modal -->
 {% include 'desktop/modals/desk/dispose_desktop_modal_all.html' %}
<!-- Add Monitor Modal -->
{% include 'desktop/modals/mon/add_monitor_modal.html' %}
<!-- Edit Monitor Modal -->
{% include 'desktop/modals/mon/edit_monitor_modal.html' %}
<!-- Confirm Dispose Monitor Modal -->
{% include 'desktop/modals/mon/confirm_dispose_monitor_modal.html' %}
<!-- Add Keyboard Modal -->
{% include 'desktop/modals/key/add_keyboard_modal.html' %}
<!-- Edit Keyboard Modal -->
{% include 'desktop/modals/key/edit_keyboard_modal.html' %}
<!-- Confirm Dispose Keyboard Modal -->
{% include 'desktop/modals/key/confirm_dispose_keyboard_modal.html' %}




<script>
  {% if messages %}
    $(document).ready(function () {
      {% for message in messages %}
        $.notify({
          message: "{{ message|escapejs }}",
          title: "{% if message.tags == 'success' %}Success{% elif message.tags == 'error' %}Error{% elif message.tags == 'warning' %}Warning{% else %}Notice{% endif %}",
          icon: "{% if message.tags == 'success' %}fa fa-check{% elif message.tags == 'error' %}fa fa-times{% elif message.tags == 'warning' %}fa fa-exclamation{% else %}fa fa-info{% endif %}"
        }, {
          type: "{{ message.tags }}",
          placement: { from: "bottom", align: "right" },
          delay: 4000,
          z_index: 9999
        });
      {% endfor %}
    });
  {% endif %}
</script>

{% endblock %}