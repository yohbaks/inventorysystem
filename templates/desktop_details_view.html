{% extends "base.html" %}
{% load custom_filters %}
{% load static %}

{% block content %}


{% block extra_css %}
<style>
:root {
  --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
  --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}




/* ðŸŒˆ Rainbow animation for license keys */
.license-key-rainbow {
  font-family: "Courier New", monospace;
  font-weight: 700;
  letter-spacing: 2px;
  background: linear-gradient(90deg,
    #ef4444,
    #f97316,
    #eab308,
    #22c55e,
    #3b82f6,
    #a855f7,
    #ec4899);
  background-size: 400%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbowFlow 5s linear infinite;
}

/* Smooth flowing gradient */
@keyframes rainbowFlow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

</style>
{% endblock %}


<div class="modern-container">
  <div class="container-fluid">
    <!-- Hero Header -->
    <div class="premium-page-header theme-info">
      <div class="hero-content">
        <div class="d-flex justify-content-between align-items-start flex-wrap">
          <div class="flex-grow-1">
            <div class="hero-badge">
              <i class="fas fa-desktop"></i>
              <span>Desktop Package</span>
            </div>
            <h1 class="hero-title text-white">{{ desktop_detailsx.computer_name }}</h1>
            
            <div class="info-cards">
              <div class="info-card">
                <div class="info-label ">Asset Owner</div>
                <div class="info-value text-white">{{ user_details.user_Assetowner.employee_fname }} {{ user_details.user_Assetowner.employee_lname }}</div>
                <div class="text-white"><small style="opacity: 0.9;">{{ user_details.user_Assetowner.employee_position }}</small></div>
              </div>
              <div class="info-card">
                <div class="info-label">Office</div>
                <div class="info-value text-white">{{ user_details.user_Assetowner.employee_office_section }}</div>
                <div class="text-white"><small style="opacity: 0.9;">Engineering Department</small></div>
              </div>
            </div>
          </div>
          
          <div class="action-buttons mt-3 mt-md-0">
            <a href="{% url 'generate_desktop_pdf' equipment_package.id %}" class="modern-btn btn-primary">
              <i class="fa fa-file-pdf"></i>
              PDF
            </a>
            <button class="modern-btn btn-secondary" data-bs-toggle="modal" data-bs-target="#qrModal">
              <i class="fas fa-qrcode"></i>
              QR
            </button>
            {% if not desktop_detailsx.is_disposed %}
            <button class="modern-btn btn-secondary" data-bs-toggle="modal" data-bs-target="#disposeModal">
              <i class="fa fa-location-arrow"></i>
              Return
            </button>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- Main Content -->
      <div class="col-lg-8">
        
        <!-- Modern Tab Navigation -->
        <ul class="nav nav-pills nav-secondary nav-pills-no-bd modern-tabs" id="pills-tab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active modern-btn" id="pills-desktop-tab" data-bs-toggle="pill" data-bs-target="#pills-desktop" type="button" role="tab">
              <i class="fas fa-desktop"></i> Desktop
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link modern-btn" id="pills-monitor-tab" data-bs-toggle="pill" data-bs-target="#pills-monitor" type="button" role="tab">
              <i class="fas fa-tv"></i> Monitor
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link modern-btn" id="pills-keyboard-tab" data-bs-toggle="pill" data-bs-target="#pills-keyboard" type="button" role="tab">
              <i class="fas fa-keyboard"></i> Keyboard
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link modern-btn" id="pills-mouse-tab" data-bs-toggle="pill" data-bs-target="#pills-mouse" type="button" role="tab">
              <i class="fas fa-mouse-pointer"></i> Mouse
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link modern-btn" id="pills-ups-tab" data-bs-toggle="pill" data-bs-target="#pills-ups" type="button" role="tab">
              <i class="fas fa-battery-full"></i> UPS
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link modern-btn" id="pills-user-tab" data-bs-toggle="pill" data-bs-target="#pills-user" type="button" role="tab">
              <i class="fas fa-user"></i> User
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link modern-btn" id="pills-documents-tab" data-bs-toggle="pill" data-bs-target="#pills-documents" type="button" role="tab">
              <i class="fas fa-file-alt"></i> Documents
            </button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="pills-tabContent">
          
          <!-- Desktop Tab -->
          <div class="tab-pane fade show active" id="pills-desktop" role="tabpanel">
            <div class="modern-card">
              <div class="card-header-modern">
                <h2 class="card-title-modern">Desktop Specifications</h2>
                {% include "photo/desktop_photo.html" %}
                <div class="d-flex gap-2">
                  {% if desktop_detailsx and not desktop_detailsx.is_disposed %}
                    <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editDesktopModal">
                      <i class="fa fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-danger rounded-pill" data-bs-toggle="modal" data-bs-target="#disposeModal">
                      <i class="fa fa-trash"></i> Dispose
                    </button>
                  {% else %}
                    <span class="badge bg-danger rounded-pill p-2 px-3 d-flex align-items-center">
                      <i class="fas fa-trash-alt me-2"></i> Disposed
                    </span>
                  {% endif %}
                </div>

              </div>

              {% if has_active_desktop %}
              <div class="spec-grid">
                <div class="spec-item">
                  <div class="spec-label">Serial Number</div>
                  <div class="spec-value">{{ desktop_detailsx.serial_no }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Brand</div>
                  <div class="spec-value">{{ desktop_detailsx.brand_name }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Model</div>
                  <div class="spec-value">{{ desktop_detailsx.model }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Processor</div>
                  <div class="spec-value">{{ desktop_detailsx.processor }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Memory</div>
                  <div class="spec-value">{{ desktop_detailsx.memory }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Storage</div>
                  <div class="spec-value">{{ desktop_detailsx.drive }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Graphics</div>
                  <div class="spec-value">{{ desktop_detailsx.desktop_Graphics|default:"â€”" }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Graphics Size</div>
                  <div class="spec-value">{{ desktop_detailsx.desktop_Graphics_Size|default:"â€”" }}</div>
                </div>
              </div>

              <div class="software-section mt-4">
                  <h3 class="software-title">
                    <i class="fas fa-cog"></i>
                    Software Details
                  </h3>

                  <div class="row">
                    <!-- Operating System -->
                    <div class="col-md-6 mb-3">
                      <div class="spec-label">Operating System</div>
                      <div class="spec-value">{{ desktop_detailsx.desktop_OS|default:"â€”" }}</div>
                      <div class="spec-sub">
                        <small class="text-muted">License Key:</small><br>
                        <code class="license-key-rainbow">{{ desktop_detailsx.desktop_OS_keys|default:"â€”" }}</code>
                      </div>
                    </div>

                    <!-- Microsoft Office -->
                    <div class="col-md-6 mb-3">
                      <div class="spec-label">Microsoft Office</div>
                      <div class="spec-value">{{ desktop_detailsx.desktop_Office|default:"â€”" }}</div>
                      <div class="spec-sub">
                        <small class="text-muted">License Key:</small><br>
                        <code class="license-key-rainbow">{{ desktop_detailsx.desktop_Office_keys|default:"â€”" }}</code>
                      </div>
                    </div>
                  </div>
                </div>
              {% endif %}


             <!-- âœ… DISPOSED DESKTOP HISTORY SECTION -->
{% if disposed_desktop.exists %}
<div class="mt-5">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 style="font-weight: 700; color: #dc2626; margin: 0;">
      <i class="fas fa-desktop"></i> Disposed Desktop History
    </h3>
    <span class="badge" style="background: #fee2e2; color: #991b1b; padding: 0.5rem 1rem; border-radius: 9999px; font-size: 0.875rem;">
      {{ disposed_desktop.count }} Disposed
    </span>
  </div>

  <div style="border-top: 2px solid #fecaca; padding-top: 1rem;">
    {% for desktop in disposed_desktop %}
    <div class="spec-item" style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border: 2px solid #dc2626; margin-bottom: 1rem; border-radius: 0.75rem; padding: 1rem;">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <span style="background: #dc2626; color: white; padding: 0.25rem 0.75rem; border-radius: 0.5rem; font-size: 0.75rem; font-weight: 600;">
            <i class="fas fa-trash-alt"></i> DISPOSED
          </span>
          <div style="font-size: 0.875rem; color: #7f1d1d; margin-top: 0.25rem;">
            <i class="far fa-calendar"></i> {{ desktop.date_disposed|date:"F d, Y" }}
          </div>
        </div>
        <div style="text-align: right;">
          <div style="font-size: 0.75rem; color: #991b1b; font-weight: 600;">SN: {{ desktop.serial_no }}</div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4">
          <div class="spec-label" style="color: #7f1d1d;">Brand</div>
          <div class="spec-value" style="color: #991b1b;">{{ desktop.brand_name }}</div>
        </div>
        <div class="col-md-4">
          <div class="spec-label" style="color: #7f1d1d;">Model</div>
          <div class="spec-value" style="color: #991b1b;">{{ desktop.model }}</div>
        </div>
        <div class="col-md-4">
          <div class="spec-label" style="color: #7f1d1d;">Disposed By</div>
          <div class="spec-value" style="color: #991b1b;">{{ desktop.asset_owner|default:"N/A" }}</div>
        </div>
      </div>

      {% if desktop.reason %}
      <div class="mt-3" style="font-size: 0.85rem; color: #7f1d1d;">
        <strong>Reason:</strong> {{ desktop.reason }}
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}
<!-- END âœ… DISPOSED DESKTOP HISTORY SECTION -->
            </div>
          </div>








<!-- Monitor Tab -->
<div class="tab-pane fade" id="pills-monitor" role="tabpanel">
  <div class="modern-card">
    <div class="card-header-modern">
      <h2 class="card-title-modern">Monitor Details</h2>
      {% include "photo/monitor_photo.html" %}
      {% if not has_active_monitor and has_active_desktop %}
      <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#addMonitorModal">
        <i class="fa fa-plus"></i> Add Monitor
      </button>
      {% endif %}
    </div>

    {% if monitor_detailse %}
    <div class="spec-grid">
      <div class="spec-item">
        <div class="spec-label">Serial Number</div>
        <div class="spec-value">{{ monitor_detailse.monitor_sn_db }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Brand</div>
        <div class="spec-value">{{ monitor_detailse.monitor_brand_db }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Model</div>
        <div class="spec-value">{{ monitor_detailse.monitor_model_db }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Size</div>
        <div class="spec-value">{{ monitor_detailse.monitor_size_db }}</div>
      </div>
    </div>

    <div class="mt-4 d-flex gap-2">
      <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editMonitorModal">
        <i class="fa fa-edit"></i> Edit
      </button>
      <button class="btn btn-danger rounded-pill" data-bs-toggle="modal" data-bs-target="#confirmDisposeModal_Monitor">
        <i class="fa fa-trash"></i> Dispose
      </button>
    </div>
    {% else %}
    <div class="alert alert-info" style="border-radius: 1rem;">
      <i class="fas fa-info-circle"></i>
      No monitor available for this desktop package.
    </div>
    {% endif %}

    <!-- âœ… DISPOSED MONITOR HISTORY -->
    {% if disposed_monitor.exists %}
    <div class="mt-5">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 style="font-weight:700;color:#dc2626;margin:0;">
          <i class="fas fa-history"></i> Disposed Monitor History
        </h3>
        <span class="badge" style="background:#fee2e2;color:#991b1b;padding:0.5rem 1rem;border-radius:9999px;font-size:0.875rem;">
          {{ disposed_monitor.count }} Disposed
        </span>
      </div>

      <div style="border-top:2px solid #fecaca;padding-top:1rem;">
        {% for monitor in disposed_monitor %}
        <div class="spec-item" style="background:linear-gradient(135deg,#fee2e2 0%,#fecaca 100%);
             border:2px solid #dc2626;margin-bottom:1rem;border-radius:0.75rem;padding:1rem;position:relative;overflow:hidden;">
          <div style="position:absolute;top:0;left:0;width:5px;height:100%;background:#dc2626;"></div>

          <div style="padding-left:0.75rem;">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <span style="background:#dc2626;color:white;padding:0.25rem 0.75rem;
                      border-radius:0.5rem;font-size:0.75rem;font-weight:600;
                      display:inline-block;margin-bottom:0.5rem;">
                  <i class="fas fa-trash-alt"></i> DISPOSED
                </span>
                <div style="font-size:0.875rem;color:#7f1d1d;margin-top:0.25rem;">
                  <i class="far fa-calendar"></i> {{ monitor.disposal_date|date:"F d, Y h:i A" }}
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:0.75rem;color:#991b1b;font-weight:600;">
                  SN: {{ monitor.monitor_sn }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-3">
                <div class="spec-label" style="color:#7f1d1d;">Brand</div>
                <div class="spec-value" style="color:#991b1b;">{{ monitor.monitor_brand|default:"â€”" }}</div>
              </div>
              <div class="col-md-3">
                <div class="spec-label" style="color:#7f1d1d;">Model</div>
                <div class="spec-value" style="color:#991b1b;">{{ monitor.monitor_model|default:"â€”" }}</div>
              </div>
              <div class="col-md-3">
                <div class="spec-label" style="color:#7f1d1d;">Size</div>
                <div class="spec-value" style="color:#991b1b;">{{ monitor.monitor_size|default:"â€”" }}</div>
              </div>
              <div class="col-md-3">
                <div class="spec-label" style="color:#7f1d1d;">Computer</div>
                <div class="spec-value" style="color:#991b1b;font-size:0.875rem;">
                  {{ desktop_detailsx.computer_name|default:"â€”" }}
                </div>
              </div>
            </div>

            {% if monitor.reason %}
            <div class="mt-3" style="padding:0.75rem;background:rgba(127,29,29,0.1);
                 border-radius:0.5rem;border-left:3px solid #dc2626;">
              <div style="font-size:0.75rem;color:#7f1d1d;font-weight:600;margin-bottom:0.25rem;">
                <i class="fas fa-comment-alt"></i> Disposal Reason
              </div>
              <div style="font-size:0.875rem;color:#991b1b;">{{ monitor.reason }}</div>
            </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <!-- END âœ… DISPOSED MONITOR HISTORY -->


    <!-- ðŸ’š SALVAGED MONITOR HISTORY -->
    {% if salvaged_monitors_view.exists %}
    <div class="mt-5">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 style="font-weight:700;color:#16a34a;margin:0;">
          <i class="fas fa-recycle"></i> Salvaged Monitor History
        </h3>
        <span class="badge" style="background:#d1fae5;color:#065f46;padding:0.5rem 1rem;
              border-radius:9999px;font-size:0.875rem;">
          {{ salvaged_monitors_view.count }} Salvaged
        </span>
      </div>

      <div style="border-top:2px solid #a7f3d0;padding-top:1rem;">
        {% for sm in salvaged_monitors_view %}
        <div class="spec-item" style="background:linear-gradient(135deg,#d1fae5 0%,#a7f3d0 100%);
             border:2px solid #16a34a;margin-bottom:1rem;border-radius:0.75rem;padding:1rem;
             position:relative;overflow:hidden;">
          <div style="position:absolute;top:0;left:0;width:5px;height:100%;background:#16a34a;"></div>

          <div style="padding-left:0.75rem;">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <span style="background:#16a34a;color:white;padding:0.25rem 0.75rem;
                      border-radius:0.5rem;font-size:0.75rem;font-weight:600;
                      display:inline-block;margin-bottom:0.5rem;">
                  <i class="fas fa-recycle"></i> SALVAGED
                </span>
                <div style="font-size:0.875rem;color:#065f46;margin-top:0.25rem;">
                  <i class="far fa-calendar"></i> {{ sm.salvage_date|date:"F d, Y h:i A" }}
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:0.75rem;color:#065f46;font-weight:600;">
                  SN: {{ sm.monitor_sn }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-3">
                <div class="spec-label" style="color:#065f46;">Brand</div>
                <div class="spec-value" style="color:#065f46;">{{ sm.monitor_brand|default:"â€”" }}</div>
              </div>
              <div class="col-md-3">
                <div class="spec-label" style="color:#065f46;">Model</div>
                <div class="spec-value" style="color:#065f46;">{{ sm.monitor_model|default:"â€”" }}</div>
              </div>
              <div class="col-md-3">
                <div class="spec-label" style="color:#065f46;">Size</div>
                <div class="spec-value" style="color:#065f46;">{{ sm.monitor_size|default:"â€”" }}</div>
              </div>
              <div class="col-md-3">
                <div class="spec-label" style="color:#065f46;">Computer</div>
                <div class="spec-value" style="color:#065f46;font-size:0.875rem;">
                  {{ sm.computer_name|default:"â€”" }}
                </div>
              </div>
            </div>

            {% if sm.notes %}
            <div class="mt-3" style="padding:0.75rem;background:rgba(6,95,70,0.08);
                 border-radius:0.5rem;border-left:3px solid #16a34a;">
              <div style="font-size:0.75rem;color:#065f46;font-weight:600;margin-bottom:0.25rem;">
                <i class="fas fa-comment-alt"></i> Salvage Notes
              </div>
              <div style="font-size:0.875rem;color:#065f46;">{{ sm.notes }}</div>
            </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <!-- END ðŸ’š SALVAGED MONITOR HISTORY -->

  </div>
</div>

<!-- Keyboard Tab -->
<div class="tab-pane fade" id="pills-keyboard" role="tabpanel">
  <div class="modern-card">
    <div class="card-header-modern">
      <h2 class="card-title-modern">Keyboard Details</h2>
      {% include "photo/keyboard_photo.html" %}
      {% if not has_active_keyboards and has_active_desktop %}
      <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#addKeyboardModal">
        <i class="fa fa-plus"></i> Add Keyboard
      </button>
      {% endif %}
    </div>

    {% if keyboard_detailse %}
    <div class="spec-grid">
      <div class="spec-item">
        <div class="spec-label">Serial Number</div>
        <div class="spec-value">{{ keyboard_detailse.keyboard_sn_db }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Brand</div>
        <div class="spec-value">{{ keyboard_detailse.keyboard_brand_db }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Model</div>
        <div class="spec-value">{{ keyboard_detailse.keyboard_model_db }}</div>
      </div>
    </div>

    <div class="mt-4 d-flex gap-2">
      <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editKeyboardModal">
        <i class="fa fa-edit"></i> Edit
      </button>
      <button class="btn btn-danger rounded-pill" data-bs-toggle="modal" data-bs-target="#confirmDisposeModalKeyboard">
        <i class="fa fa-trash"></i> Dispose
      </button>
    </div>

    {% else %}
    <div class="alert alert-info" style="border-radius: 1rem;">
      <i class="fas fa-info-circle"></i> No keyboard available for this desktop package.
    </div>
    {% endif %}

    <!-- â¤ï¸ DISPOSED KEYBOARD HISTORY -->
    {% if disposed_keyboards.exists %}
    <div class="mt-5">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 style="font-weight:700;color:#dc2626;margin:0;">
          <i class="fas fa-history"></i> Disposed Keyboard History
        </h3>
        <span class="badge" style="background:#fee2e2;color:#991b1b;padding:0.5rem 1rem;border-radius:9999px;font-size:0.875rem;">
          {{ disposed_keyboards.count }} Disposed
        </span>
      </div>

      <div style="border-top:2px solid #fecaca;padding-top:1rem;">
        {% for dk in disposed_keyboards %}
        <div class="spec-item" style="background:linear-gradient(135deg,#fee2e2 0%,#fecaca 100%);
             border:2px solid #dc2626;margin-bottom:1rem;border-radius:0.75rem;padding:1rem;position:relative;">
          <div style="position:absolute;top:0;left:0;width:5px;height:100%;background:#dc2626;"></div>

          <div style="padding-left:0.75rem;">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <span style="background:#dc2626;color:white;padding:0.25rem 0.75rem;
                      border-radius:0.5rem;font-size:0.75rem;font-weight:600;
                      display:inline-block;margin-bottom:0.5rem;">
                  <i class="fas fa-trash-alt"></i> DISPOSED
                </span>
                <div style="font-size:0.875rem;color:#7f1d1d;margin-top:0.25rem;">
                  <i class="far fa-calendar"></i> {{ dk.disposal_date|date:"F d, Y" }}
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:0.75rem;color:#991b1b;font-weight:600;">
                  SN: {{ dk.keyboard_dispose_db.keyboard_sn_db }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="spec-label" style="color:#7f1d1d;">Brand</div>
                <div class="spec-value" style="color:#991b1b;">{{ dk.keyboard_dispose_db.keyboard_brand_db }}</div>
              </div>
              <div class="col-md-4">
                <div class="spec-label" style="color:#7f1d1d;">Model</div>
                <div class="spec-value" style="color:#991b1b;">{{ dk.keyboard_dispose_db.keyboard_model_db }}</div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <!-- END â¤ï¸ DISPOSED KEYBOARD HISTORY -->


    <!-- ðŸ’š SALVAGED KEYBOARD HISTORY -->
    {% if salvaged_keyboards_view.exists %}
    <div class="mt-5">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 style="font-weight:700;color:#16a34a;margin:0;">
          <i class="fas fa-recycle"></i> Salvaged Keyboard History
        </h3>
        <span class="badge" style="background:#d1fae5;color:#065f46;padding:0.5rem 1rem;
              border-radius:9999px;font-size:0.875rem;">
          {{ salvaged_keyboards_view.count }} Salvaged
        </span>
      </div>

      <div style="border-top:2px solid #a7f3d0;padding-top:1rem;">
        {% for sk in salvaged_keyboards_view %}
        <div class="spec-item" style="background:linear-gradient(135deg,#d1fae5 0%,#a7f3d0 100%);
             border:2px solid #16a34a;margin-bottom:1rem;border-radius:0.75rem;padding:1rem;position:relative;">
          <div style="position:absolute;top:0;left:0;width:5px;height:100%;background:#16a34a;"></div>

          <div style="padding-left:0.75rem;">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <span style="background:#16a34a;color:white;padding:0.25rem 0.75rem;
                      border-radius:0.5rem;font-size:0.75rem;font-weight:600;
                      display:inline-block;margin-bottom:0.5rem;">
                  <i class="fas fa-recycle"></i> SALVAGED
                </span>
                <div style="font-size:0.875rem;color:#065f46;margin-top:0.25rem;">
                  <i class="far fa-calendar"></i> {{ sk.salvage_date|date:"F d, Y h:i A" }}
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:0.75rem;color:#065f46;font-weight:600;">
                  SN: {{ sk.keyboard_sn }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="spec-label" style="color:#065f46;">Brand</div>
                <div class="spec-value" style="color:#065f46;">{{ sk.keyboard_brand|default:"â€”" }}</div>
              </div>
              <div class="col-md-4">
                <div class="spec-label" style="color:#065f46;">Model</div>
                <div class="spec-value" style="color:#065f46;">{{ sk.keyboard_model|default:"â€”" }}</div>
              </div>
              <div class="col-md-4">
                <div class="spec-label" style="color:#065f46;">Computer</div>
                <div class="spec-value" style="color:#065f46;font-size:0.875rem;">
                  {{ sk.computer_name|default:"â€”" }}
                </div>
              </div>
            </div>

            {% if sk.notes %}
            <div class="mt-3" style="padding:0.75rem;background:rgba(6,95,70,0.08);
                 border-radius:0.5rem;border-left:3px solid #16a34a;">
              <div style="font-size:0.75rem;color:#065f46;font-weight:600;margin-bottom:0.25rem;">
                <i class="fas fa-comment-alt"></i> Salvage Notes
              </div>
              <div style="font-size:0.875rem;color:#065f46;">{{ sk.notes }}</div>
            </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <!-- END ðŸ’š SALVAGED KEYBOARD HISTORY -->
  </div>
</div>
<!-- Mouse Tab -->
<div class="tab-pane fade" id="pills-mouse" role="tabpanel">
  <div class="modern-card">
    <div class="card-header-modern">
      <h2 class="card-title-modern">Mouse Details</h2>
      {% include "photo/mouse_photo.html" %}
      {% if not has_active_mouse and has_active_desktop %}
      <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#addMouseModal">
        <i class="fa fa-plus"></i> Add Mouse
      </button>
      {% endif %}
    </div>

    {% if mouse_detailse %}
    <div class="spec-grid">
      <div class="spec-item">
        <div class="spec-label">Serial Number</div>
        <div class="spec-value">{{ mouse_detailse.mouse_sn_db }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Brand</div>
        <div class="spec-value">{{ mouse_detailse.mouse_brand_db }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Model</div>
        <div class="spec-value">{{ mouse_detailse.mouse_model_db }}</div>
      </div>
    </div>

    <div class="mt-4 d-flex gap-2">
      <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editMouseModal">
        <i class="fa fa-edit"></i> Edit
      </button>
      <button class="btn btn-danger rounded-pill" data-bs-toggle="modal" data-bs-target="#confirmDisposeMouseModal">
        <i class="fa fa-trash"></i> Dispose
      </button>
    </div>
    {% else %}
    <div class="alert alert-info" style="border-radius: 1rem;">
      <i class="fas fa-info-circle"></i>
      No mouse available for this desktop package.
    </div>
    {% endif %}

    <!-- â¤ï¸ DISPOSED MOUSE HISTORY -->
    {% if disposed_mouse.exists %}
    <div class="mt-5">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 style="font-weight:700;color:#dc2626;margin:0;">
          <i class="fas fa-history"></i> Disposed Mouse History
        </h3>
        <span class="badge" style="background:#fee2e2;color:#991b1b;padding:0.5rem 1rem;border-radius:9999px;font-size:0.875rem;">
          {{ disposed_mouse.count }} Disposed
        </span>
      </div>

      <div style="border-top:2px solid #fecaca;padding-top:1rem;">
        {% for mouse in disposed_mouse %}
        <div class="spec-item" style="background:linear-gradient(135deg,#fee2e2 0%,#fecaca 100%);
             border:2px solid #dc2626;margin-bottom:1rem;border-radius:0.75rem;padding:1rem;position:relative;">
          <div style="position:absolute;top:0;left:0;width:5px;height:100%;background:#dc2626;"></div>

          <div style="padding-left:0.75rem;">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <span style="background:#dc2626;color:white;padding:0.25rem 0.75rem;
                      border-radius:0.5rem;font-size:0.75rem;font-weight:600;
                      display:inline-block;margin-bottom:0.5rem;">
                  <i class="fas fa-trash-alt"></i> DISPOSED
                </span>
                <div style="font-size:0.875rem;color:#7f1d1d;margin-top:0.25rem;">
                  <i class="far fa-calendar"></i> {{ mouse.disposal_date|date:"F d, Y" }}
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:0.75rem;color:#991b1b;font-weight:600;">
                  SN: {{ mouse.mouse_db.mouse_sn_db }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="spec-label" style="color:#7f1d1d;">Brand</div>
                <div class="spec-value" style="color:#991b1b;">{{ mouse.mouse_db.mouse_brand_db }}</div>
              </div>
              <div class="col-md-4">
                <div class="spec-label" style="color:#7f1d1d;">Model</div>
                <div class="spec-value" style="color:#991b1b;">{{ mouse.mouse_db.mouse_model_db }}</div>
              </div>
              <div class="col-md-4">
                <div class="spec-label" style="color:#7f1d1d;">Computer</div>
                <div class="spec-value" style="color:#991b1b;">{{ desktop_detailsx.computer_name|default:"â€”" }}</div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <!-- END â¤ï¸ DISPOSED MOUSE HISTORY -->


    <!-- ðŸ’š SALVAGED MOUSE HISTORY -->
    {% if salvaged_mice_view.exists %}
    <div class="mt-5">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 style="font-weight:700;color:#16a34a;margin:0;">
          <i class="fas fa-recycle"></i> Salvaged Mouse History
        </h3>
        <span class="badge" style="background:#d1fae5;color:#065f46;padding:0.5rem 1rem;
              border-radius:9999px;font-size:0.875rem;">
          {{ salvaged_mice_view.count }} Salvaged
        </span>
      </div>

      <div style="border-top:2px solid #a7f3d0;padding-top:1rem;">
        {% for sm in salvaged_mice_view %}
        <div class="spec-item" style="background:linear-gradient(135deg,#d1fae5 0%,#a7f3d0 100%);
             border:2px solid #16a34a;margin-bottom:1rem;border-radius:0.75rem;padding:1rem;position:relative;">
          <div style="position:absolute;top:0;left:0;width:5px;height:100%;background:#16a34a;"></div>

          <div style="padding-left:0.75rem;">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <span style="background:#16a34a;color:white;padding:0.25rem 0.75rem;
                      border-radius:0.5rem;font-size:0.75rem;font-weight:600;
                      display:inline-block;margin-bottom:0.5rem;">
                  <i class="fas fa-recycle"></i> SALVAGED
                </span>
                <div style="font-size:0.875rem;color:#065f46;margin-top:0.25rem;">
                  <i class="far fa-calendar"></i> {{ sm.salvage_date|date:"F d, Y h:i A" }}
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:0.75rem;color:#065f46;font-weight:600;">
                  SN: {{ sm.mouse_sn }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="spec-label" style="color:#065f46;">Brand</div>
                <div class="spec-value" style="color:#065f46;">{{ sm.mouse_brand|default:"â€”" }}</div>
              </div>
              <div class="col-md-4">
                <div class="spec-label" style="color:#065f46;">Model</div>
                <div class="spec-value" style="color:#065f46;">{{ sm.mouse_model|default:"â€”" }}</div>
              </div>
              <div class="col-md-4">
                <div class="spec-label" style="color:#065f46;">Computer</div>
                <div class="spec-value" style="color:#065f46;font-size:0.875rem;">
                  {{ sm.computer_name|default:"â€”" }}
                </div>
              </div>
            </div>

            {% if sm.notes %}
            <div class="mt-3" style="padding:0.75rem;background:rgba(6,95,70,0.08);
                 border-radius:0.5rem;border-left:3px solid #16a34a;">
              <div style="font-size:0.75rem;color:#065f46;font-weight:600;margin-bottom:0.25rem;">
                <i class="fas fa-comment-alt"></i> Salvage Notes
              </div>
              <div style="font-size:0.875rem;color:#065f46;">{{ sm.notes }}</div>
            </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <!-- END ðŸ’š SALVAGED MOUSE HISTORY -->
  </div>
</div>

<!-- UPS Tab -->
<div class="tab-pane fade" id="pills-ups" role="tabpanel">
  <div class="modern-card">
    <div class="card-header-modern">
      <h2 class="card-title-modern">UPS Details</h2>
      {% include "photo/ups_photo.html" %}
      {% if not has_active_ups and has_active_desktop %}
      <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#addUPSModal">
        <i class="fa fa-plus"></i> Add UPS
      </button>
      {% endif %}
    </div>

    {% if ups_detailse %}
    <div class="spec-grid">
      <div class="spec-item">
        <div class="spec-label">Serial Number</div>
        <div class="spec-value">{{ ups_detailse.ups_sn_db }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Brand</div>
        <div class="spec-value">{{ ups_detailse.ups_brand_db }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Model</div>
        <div class="spec-value">{{ ups_detailse.ups_model_db }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Capacity</div>
        <div class="spec-value">{{ ups_detailse.ups_capacity_db }}</div>
      </div>
    </div>

    <div class="mt-4 d-flex gap-2">
      <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editUpsModal">
        <i class="fa fa-edit"></i> Edit
      </button>
      <button class="btn btn-danger rounded-pill" data-bs-toggle="modal" data-bs-target="#confirmDisposeUpsModal">
        <i class="fa fa-trash"></i> Dispose
      </button>
    </div>
    {% else %}
    <div class="alert alert-info" style="border-radius: 1rem;">
      <i class="fas fa-info-circle"></i> No UPS available for this desktop package.
    </div>
    {% endif %}

    <!-- â¤ï¸ DISPOSED UPS HISTORY -->
    {% if disposed_ups.exists %}
    <div class="mt-5">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 style="font-weight:700;color:#dc2626;margin:0;">
          <i class="fas fa-history"></i> Disposed UPS History
        </h3>
        <span class="badge" style="background:#fee2e2;color:#991b1b;padding:0.5rem 1rem;border-radius:9999px;font-size:0.875rem;">
          {{ disposed_ups.count }} Disposed
        </span>
      </div>

      <div style="border-top:2px solid #fecaca;padding-top:1rem;">
        {% for ups in disposed_ups %}
        <div class="spec-item" style="background:linear-gradient(135deg,#fee2e2 0%,#fecaca 100%);
             border:2px solid #dc2626;margin-bottom:1rem;border-radius:0.75rem;padding:1rem;position:relative;">
          <div style="position:absolute;top:0;left:0;width:5px;height:100%;background:#dc2626;"></div>

          <div style="padding-left:0.75rem;">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <span style="background:#dc2626;color:white;padding:0.25rem 0.75rem;
                      border-radius:0.5rem;font-size:0.75rem;font-weight:600;
                      display:inline-block;margin-bottom:0.5rem;">
                  <i class="fas fa-trash-alt"></i> DISPOSED
                </span>
                <div style="font-size:0.875rem;color:#7f1d1d;margin-top:0.25rem;">
                  <i class="far fa-calendar"></i> {{ ups.disposal_date|date:"F d, Y" }}

                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:0.75rem;color:#991b1b;font-weight:600;">
                  SN: {{ ups.ups_db.ups_sn_db }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="spec-label" style="color:#7f1d1d;">Brand</div>
                <div class="spec-value" style="color:#991b1b;">{{ ups.ups_db.ups_brand_db }}</div>
              </div>
              <div class="col-md-4">
                <div class="spec-label" style="color:#7f1d1d;">Model</div>
                <div class="spec-value" style="color:#991b1b;">{{ ups.ups_db.ups_model_db }}</div>
              </div>
              <div class="col-md-4">
                <div class="spec-label" style="color:#7f1d1d;">Capacity</div>
                <div class="spec-value" style="color:#991b1b;">{{ ups.ups_db.ups_capacity_db }}</div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <!-- END â¤ï¸ DISPOSED UPS HISTORY -->


    <!-- ðŸ’š SALVAGED UPS HISTORY -->
    {% if salvaged_ups_view.exists %}
    <div class="mt-5">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 style="font-weight:700;color:#16a34a;margin:0;">
          <i class="fas fa-recycle"></i> Salvaged UPS History
        </h3>
        <span class="badge" style="background:#d1fae5;color:#065f46;padding:0.5rem 1rem;
              border-radius:9999px;font-size:0.875rem;">
          {{ salvaged_ups_view.count }} Salvaged
        </span>
      </div>

      <div style="border-top:2px solid #a7f3d0;padding-top:1rem;">
        {% for su in salvaged_ups_view %}
        <div class="spec-item" style="background:linear-gradient(135deg,#d1fae5 0%,#a7f3d0 100%);
             border:2px solid #16a34a;margin-bottom:1rem;border-radius:0.75rem;padding:1rem;position:relative;">
          <div style="position:absolute;top:0;left:0;width:5px;height:100%;background:#16a34a;"></div>

          <div style="padding-left:0.75rem;">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <span style="background:#16a34a;color:white;padding:0.25rem 0.75rem;
                      border-radius:0.5rem;font-size:0.75rem;font-weight:600;
                      display:inline-block;margin-bottom:0.5rem;">
                  <i class="fas fa-recycle"></i> SALVAGED
                </span>
                <div style="font-size:0.875rem;color:#065f46;margin-top:0.25rem;">
                  <i class="far fa-calendar"></i> {{ su.salvage_date|date:"F d, Y h:i A" }}
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:0.75rem;color:#065f46;font-weight:600;">
                  SN: {{ su.ups_sn }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="spec-label" style="color:#065f46;">Brand</div>
                <div class="spec-value" style="color:#065f46;">{{ su.ups_brand|default:"â€”" }}</div>
              </div>
              <div class="col-md-4">
                <div class="spec-label" style="color:#065f46;">Model</div>
                <div class="spec-value" style="color:#065f46;">{{ su.ups_model|default:"â€”" }}</div>
              </div>
              <div class="col-md-4">
                <div class="spec-label" style="color:#065f46;">Computer</div>
                <div class="spec-value" style="color:#065f46;font-size:0.875rem;">
                  {{ su.computer_name|default:"â€”" }}
                </div>
              </div>
            </div>

            {% if su.notes %}
            <div class="mt-3" style="padding:0.75rem;background:rgba(6,95,70,0.08);
                 border-radius:0.5rem;border-left:3px solid #16a34a;">
              <div style="font-size:0.75rem;color:#065f46;font-weight:600;margin-bottom:0.25rem;">
                <i class="fas fa-comment-alt"></i> Salvage Notes
              </div>
              <div style="font-size:0.875rem;color:#065f46;">{{ su.notes }}</div>
            </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <!-- END ðŸ’š SALVAGED UPS HISTORY -->
  </div>
</div>


         <!-- User Tab -->
<div class="tab-pane fade" id="pills-user" role="tabpanel">
  <div class="modern-card">
    <div class="card-header-modern">
      <h2 class="card-title-modern">User Details</h2>
    </div>

    {% if user_details %}
    <div class="spec-grid">
      <div class="spec-item">
        <div class="spec-label">Asset Owner</div>
        <div class="spec-value">{{ user_details.user_Assetowner.employee_fname }} {{ user_details.user_Assetowner.employee_lname }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Designation</div>
        <div class="spec-value">{{ user_details.user_Assetowner.employee_position }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">Office</div>
        <div class="spec-value">{{ user_details.user_Assetowner.employee_office_section }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">End User</div>
        <div class="spec-value">{{ user_details.user_Enduser.employee_fname }} {{ user_details.user_Enduser.employee_lname }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">End User Designation</div>
        <div class="spec-value">{{ user_details.user_Enduser.employee_position }}</div>
      </div>
      <div class="spec-item">
        <div class="spec-label">End User Office</div>
        <div class="spec-value">{{ user_details.user_Enduser.employee_office_section }}</div>
      </div>
    </div>

    <div class="mt-4 d-flex gap-2">
      {% if desktop_detailsx.is_disposed %}
        <!-- ðŸ”’ Disabled buttons when disposed -->
        <button type="button" class="btn btn-secondary rounded-pill" disabled data-bs-toggle="tooltip" title="Editing not allowed â€” this package is disposed.">
          <i class="fa fa-edit"></i> Edit User
        </button>
        <button type="button" class="btn btn-secondary rounded-pill" disabled data-bs-toggle="tooltip" title="Ownership transfer disabled for disposed equipment.">
          <i class="fa fa-lock"></i> Transfer Ownership
        </button>
      {% else %}
        <!-- âœ… Active buttons when operational -->
        <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editEndUserModal">
          <i class="fa fa-edit"></i> Edit User
        </button>
        <button class="btn btn-warning rounded-pill" data-bs-toggle="modal" data-bs-target="#editAssetOwnerModal">
          <i class="fa fa-exchange-alt"></i> Transfer Ownership
        </button>
      {% endif %}
    </div>

    {% else %}
    <div class="alert alert-info" style="border-radius: 1rem;">
      <i class="fas fa-info-circle"></i>
      No user details available.
    </div>
    {% endif %}


    
  </div>

  <!-- ==================== ðŸ“œ TRANSFER HISTORY SECTION ==================== -->
<!-- Add this inside the User Tab (pills-user), after the existing user info card -->

<div class="modern-card mt-4">
    <div class="card-header-modern">
        <h2 class="card-title-modern">
            <i class="fas fa-history"></i> Transfer History
        </h2>
    </div>

    <!-- ðŸ”¹ End User Change History -->
      <div class="mb-4 software-section">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h5 style="font-weight: 700; color: #1f2937; margin: 0;">
            <i class="fas fa-user-clock"></i> End User Change History
          </h5>
        <span class="badge-modern badge-success ">
            {{ enduser_history|length }} Change{{ enduser_history|length|pluralize }}
          </span>
          </div>  



        {% if enduser_history %}
        <div class="table-responsive">
            <table class="table-modern table-bordered table-head-bg-primary table-bordered-bd-info mt-4">
                <thead class="table-light">
                    <tr>
                        <th><i class="fas fa-calendar"></i> Date & Time</th>
                        <th><i class="fas fa-user-minus"></i> From</th>
                        <th><i class="fas fa-arrow-right text-muted"></i></th>
                        <th><i class="fas fa-user-plus"></i> To</th>
                        <th><i class="fas fa-user-shield"></i> Changed By</th>
                    </tr>
                </thead>
                <tbody>
                    {% for change in enduser_history %}
                    <tr>
                        <td>
                            <span class="badge bg-info">
                                {{ change.changed_at|date:"M d, Y" }}
                            </span>
                            <small class="text-muted d-block">{{ change.changed_at|date:"h:i A" }}</small>
                        </td>
                        <td>
                            {% if change.old_enduser %}
                                <strong>{{ change.old_enduser.full_name }}</strong>
                                <small class="text-muted d-block">{{ change.old_enduser.employee_position }}</small>
                            {% else %}
                                <span class="text-muted">â€”</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <i class="fas fa-arrow-right text-success"></i>
                        </td>
                        <td>
                            <strong class="text-success">{{ change.new_enduser.full_name }}</strong>
                            <small class="text-muted d-block">{{ change.new_enduser.employee_position }}</small>
                        </td>
                        <td>
                            <span class="badge bg-secondary">
                                <i class="fas fa-user"></i>
                                {{ change.changed_by.username|default:"System" }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            No end user transfer history available.
        </div>
        {% endif %}
    </div>

    <hr class="my-4">

    <!-- ðŸ”¹ Asset Owner Change History -->


 <div class="mb-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h5 style="font-weight: 700; color: #1f2937; margin: 0;">
            <i class="fas fa-user-clock"></i> Asset Owner Change History
          </h5>
        <span class="badge-modern" style="background: #fef3c7; color: #92400e;">
            {{ assetowner_history|length }} Transfer{{ assetowner_history|length|pluralize }}
          </span>
          </div>  



   

        {% if assetowner_history %}
        <div class="table-responsive">
            <table class="table-modern table-hover">
                <thead class="table-light">
                    <tr>
                        <th><i class="fas fa-calendar"></i> Date & Time</th>
                        <th><i class="fas fa-user-minus"></i> From</th>
                        <th><i class="fas fa-arrow-right text-muted"></i></th>
                        <th><i class="fas fa-user-plus"></i> To</th>
                        <th><i class="fas fa-user-shield"></i> Changed By</th>
                    </tr>
                </thead>
                <tbody>
                    {% for change in assetowner_history %}
                    <tr>
                        <td>
                            <span class="badge bg-warning text-dark">
                                {{ change.changed_at|date:"M d, Y" }}
                            </span>
                            <small class="text-muted d-block">{{ change.changed_at|date:"h:i A" }}</small>
                        </td>
                        <td>
                            {% if change.old_assetowner %}
                                <strong>{{ change.old_assetowner.full_name }}</strong>
                                <small class="text-muted d-block">{{ change.old_assetowner.employee_position }}</small>
                            {% else %}
                                <span class="text-muted">â€”</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <i class="fas fa-arrow-right text-warning"></i>
                        </td>
                        <td>
                            <strong class="text-warning">{{ change.new_assetowner.full_name }}</strong>
                            <small class="text-muted d-block">{{ change.new_assetowner.employee_position }}</small>
                        </td>
                        <td>
                            <span class="badge bg-secondary">
                                <i class="fas fa-user"></i>
                                {{ change.changed_by.username|default:"System" }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-warning">
            <i class="fas fa-info-circle"></i>
            No asset owner transfer history available.
        </div>
        {% endif %}
    </div>
</div>
</div>


          <!-- Documents Tab -->
          <div class="tab-pane fade" id="pills-documents" role="tabpanel">
            <div class="modern-card">
              <div class="card-header-modern">
                <h2 class="card-title-modern">Documents Details</h2>
                {% include "photo/documents_photo.html" %}
                <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#editDocumentsModal">
                  <i class="fa fa-edit"></i> Edit
                </button>
              </div>

              <div class="spec-grid">
                <div class="spec-item">
                  <div class="spec-label">PAR Number</div>
                  <div class="spec-value">{{ documents_detailse.docs_PAR }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Property Number</div>
                  <div class="spec-value">{{ documents_detailse.docs_Propertyno }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Acquisition Type</div>
                  <div class="spec-value">{{ documents_detailse.docs_Acquisition_Type }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Package Value</div>
                  <div class="spec-value">{{ documents_detailse.docs_Value|peso_format }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Date Received</div>
                  <div class="spec-value">{{ documents_detailse.docs_Datereceived }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Date Inspected</div>
                  <div class="spec-value">{{ documents_detailse.docs_Dateinspected }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Supplier</div>
                  <div class="spec-value">{{ documents_detailse.docs_Supplier }}</div>
                </div>
                <div class="spec-item">
                  <div class="spec-label">Status</div>
                  <div class="spec-value">
                    {% if equipment_package.is_disposed %}
                      <span class="badge-modern badge-danger">Disposed</span>
                    {% else %}
                      <span class="badge-modern badge-success">Operational</span>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
          
        </div>
      </div>

      <!-- Sidebar -->
      <div class="col-lg-4">
        
        <!-- PM Schedule Card -->
        <div class="pm-schedule-card">
          <div class="pm-header">
            <div class="pm-icon">
              <i class="fas fa-wrench fa-lg"></i>
            </div>
            <div>
              <h3 style="font-weight: 700; margin: 0; color: #1f2937;">PM Schedule</h3>
              <small style="color: #6b7280;">Maintenance Status</small>
            </div>
          </div>

         {% if pm_assignments %}
  <div>
    {% for assignment in pm_assignments %}
      <div class="pm-item mb-3 p-3 rounded shadow-sm" style="background-color: #fff; border: 1px solid #f1f1f1;">
        
        <div class="d-flex justify-content-between align-items-start mb-2">
          <div class="d-flex align-items-center gap-2">
            {% if assignment.is_completed %}
              <i class="fas fa-check-circle text-success"></i>
              <strong style="color:#059669;">
                {{ assignment.pm_section_schedule.quarter_schedule.get_quarter_display }}
                {{ assignment.pm_section_schedule.quarter_schedule.year }}
              </strong>
            {% else %}
              <i class="fas fa-clock text-warning"></i>
              <strong style="color:#92400e;">
                {{ assignment.pm_section_schedule.quarter_schedule.get_quarter_display }}
                {{ assignment.pm_section_schedule.quarter_schedule.year }}
              </strong>
            {% endif %}
          </div>

          <span class="pm-status {% if assignment.is_completed %}status-completed{% else %}status-pending{% endif %}">
            {% if assignment.is_completed %}
              Completed
            {% else %}
              Pending
            {% endif %}
          </span>
        </div>

        {% if assignment.is_completed %}
          <div class="text-success small fw-bold">
            Completed under {{ assignment.pm_section_schedule.section.name }}
          </div>
        {% else %}
          <div class="text-secondary small">
            Pending under {{ assignment.pm_section_schedule.section.name }}
          </div>
        {% endif %}

        <div class="text-muted small mt-1">
          <i class="far fa-calendar"></i>
          {{ assignment.pm_section_schedule.start_date }} â€“ {{ assignment.pm_section_schedule.end_date }}
        </div>
      </div>
    {% endfor %}
  </div>

  <a href="{% url 'checklist' equipment_package.id %}"
     class="btn w-100 rounded-pill mt-3"
     style="background: var(--gradient-success); color: white; font-weight: 600;">
    <i class="fas fa-wrench"></i> Conduct PM
  </a>
{% else %}
  <p class="text-muted mb-0">No PM schedule found for this desktop.</p>
{% endif %}

        </div>

        <!-- Quick Actions -->
        <div class="quick-actions mt-4">
          <h4 style="font-weight: 700; margin-bottom: 1rem; color: #1f2937;">Quick Actions</h4>
          
          <a href="{% url 'export_desktop_excel' %}" class="action-item">
            <div class="d-flex align-items-center gap-3">
              <div style="padding: 0.75rem; background: #dcfce7; color: #16a34a; border-radius: 0.75rem;">
                <i class="fa fa-file-excel"></i>
              </div>
              <span style="font-weight: 600;">Export to Excel</span>
            </div>
            <i class="fas fa-chevron-right" style="color: #d1d5db;"></i>
          </a>

          <a href="{% url 'maintenance_history' equipment_package.id %}" class="action-item">
            <div class="d-flex align-items-center gap-3">
              <div style="padding: 0.75rem; background: #dbeafe; color: #2563eb; border-radius: 0.75rem;">
                <i class="fa fa-history"></i>
              </div>
              <span style="font-weight: 600;">View History</span>
            </div>
            <i class="fas fa-chevron-right" style="color: #d1d5db;"></i>
          </a>

          <a href="{% url 'generate_desktop_pdf' equipment_package.id %}" class="action-item">
            <div class="d-flex align-items-center gap-3">
              <div style="padding: 0.75rem; background: #e0e7ff; color: #6366f1; border-radius: 0.75rem;">
                <i class="fa fa-file-pdf"></i>
              </div>
              <span style="font-weight: 600;">Generate Report</span>
            </div>
            <i class="fas fa-chevron-right" style="color: #d1d5db;"></i>
          </a>
        </div>

        <!-- Status Card -->
        <div class="{% if desktop_detailsx.is_disposed %}status-card status-disposed{% else %}status-card{% endif %} mt-4">
          <div class="d-flex align-items-center gap-3 mb-3">
            {% if desktop_detailsx.is_disposed %}
            <i class="fas fa-exclamation-triangle fa-2x"></i>
            {% else %}
            <i class="fas fa-check-circle fa-2x"></i>
            {% endif %}
            <div>
              <h3 style="font-weight: 700; margin: 0;">
                {% if desktop_detailsx.is_disposed %}Disposed{% else %}Operational{% endif %}
              </h3>
              <small style="opacity: 0.9;">Equipment Status</small>
            </div>
          </div>
          <p style="opacity: 0.95; margin: 0; font-size: 0.875rem;">
            {% if desktop_detailsx.is_disposed %}
            This equipment has been disposed and is no longer in active use.
            {% else %}
            This equipment is currently operational and assigned to {{ user_details.user_Assetowner.employee_office_section }}.
            {% endif %}
          </p>
        </div>

        
      </div>
    </div>
  </div>
</div>

<!-- QR Modal -->
<div class="modal fade" id="qrModal" tabindex="-1" aria-labelledby="qrModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 1.5rem; border: none;">
      <div class="modal-header" style="border-bottom: 1px solid #f3f4f6;">
        <h5 class="modal-title" id="qrModalLabel" style="font-weight: 700;">Desktop Package QR Code</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center" style="padding: 2rem;">
        {% if equipment_package.qr_code %}
          <div style="background: #f9fafb; padding: 2rem; border-radius: 1rem; display: inline-block;">
            <img id="qrImage" src="{{ equipment_package.qr_code.url }}" alt="QR Code" width="200" style="border-radius: 0.5rem;">
          </div>
          <p class="mt-3" style="color: #6b7280;">Scan to view this desktop package</p>
          <button class="btn btn-primary rounded-pill mt-3" onclick="printQrCode()" style="padding: 0.75rem 2rem;">
            <i class="fa fa-print"></i> Print Wallet-Size QR
          </button>
        {% else %}
          <p>No QR code available.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
function printQrCode() {
  const qrImage = document.getElementById("qrImage");
  if (!qrImage) {
    alert("No QR code to print.");
    return;
  }
  const printWindow = window.open("", "_blank", "width=400,height=250");
  printWindow.document.write(`
    <html>
      <head>
        <title>Print QR Code</title>
        <style>
          @page { size: 3.5in 2in; margin: 0; }
          body { width: 3.5in; height: 2in; display: flex; align-items: center; justify-content: center; margin: 0; font-family: Arial, sans-serif; }
          .card { width: 1.8in; height: 1.8in; border: 2px solid black; border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
          img { width: 1.1in; height: 1.1in; }
          .footer { margin-top: 6px; font-weight: bold; font-size: 14px; text-transform: uppercase; }
        </style>
      </head>
      <body>
        <div class="card">
          <img src="${qrImage.src}" alt="QR Code">
          <div class="footer">DPWH PROPERTY</div>
        </div>
        <script>window.onload = function() { window.print(); window.close(); }<\/script>
      </body>
    </html>
  `);
  printWindow.document.close();
}
</script>

<!-- Keep all your existing modals for Edit Desktop, Add Monitor, Dispose, etc. -->
<!-- Include them from your original template -->

<!-- {% comment %}
Include all your existing modals here:
- editDesktopModal
- addMonitorModal
- editMonitorModal
- confirmDisposeModal_Monitor
- addKeyboardModal
- editKeyboardModal
- confirmDisposeModalKeyboard
- addMouseModal
- editMouseModal
- confirmDisposeMouseModal
- addUPSModal
- editUpsModal
- confirmDisposeUpsModal
- disposeModal
- editEndUserModal
- editAssetOwnerModal
- editDocumentsdModal
{% endcomment %} -->

<!-- Edit Desktop Modal -->
 {% include 'desktop/modals/desk/edit_desktop_modal.html' %}
<!-- Dispose Desktop Modal -->
 {% include 'desktop/modals/desk/dispose_desktop_modal_all.html' %}
<!-- Add Monitor Modal -->
{% include 'desktop/modals/mon/add_monitor_modal.html' %}
<!-- Edit Monitor Modal -->
{% include 'desktop/modals/mon/edit_monitor_modal.html' %}
<!-- Confirm Dispose Monitor Modal -->
{% include 'desktop/modals/mon/confirm_dispose_monitor_modal.html' %}
<!-- Add Keyboard Modal -->
{% include 'desktop/modals/key/add_keyboard_modal.html' %}
<!-- Edit Keyboard Modal -->
{% include 'desktop/modals/key/edit_keyboard_modal.html' %}
<!-- Confirm Dispose Keyboard Modal -->
{% include 'desktop/modals/key/confirm_dispose_keyboard_modal.html' %}
<!-- Add Mouse Modal -->
{% include 'desktop/modals/mou/add_mouse_modal.html' %}
<!-- Edit Mouse Modal -->
{% include 'desktop/modals/mou/edit_mouse_modal.html' %}
<!-- Confirm Dispose Mouse Modal -->
{% include 'desktop/modals/mou/confirm_dispose_mouse_modal.html' %}
<!-- Add UPS Modal -->
{% include 'desktop/modals/ups/add_ups_modal.html' %}
<!-- Edit UPS Modal -->
{% include 'desktop/modals/ups/edit_ups_modal.html' %}
<!-- Confirm Dispose UPS Modal -->
{% include 'desktop/modals/ups/confirm_dispose_ups_modal.html' %}
<!-- Edit End User Modal -->
{% include 'desktop/modals/user/edit_end_user_modal.html' %}
<!-- Edit Asset Owner Modal -->
{% include 'desktop/modals/user/edit_asset_owner_modal.html' %}
<!-- Edit Documents Modal -->
{% include 'desktop/modals/doc/edit_documents_modal.html' %}



{% block extra_js %}

<!-- ==================== SERIAL NUMBER DUPLICATE CHECK SCRIPT ==================== -->
<script>
$(document).ready(function() {
  console.log("ðŸ” Serial check script loaded with Desktop support!");

  // ðŸ”§ Shared helper functions
  function resetField(inputSelector, modalSelector) {
    $(inputSelector).removeClass('is-invalid').css('border-color', '');
    $(modalSelector + ' button[type="submit"]').prop('disabled', false);
  }

  function checkDuplicate(sn, category, excludeID, inputSelector, modalSelector, label) {
    $.ajax({
      url: "{% url 'check_serial_no' %}",
      data: { serial: sn, category: category, exclude_id: excludeID },
      success: function(resp) {
        if (resp.exists) {
          $(inputSelector).addClass('is-invalid').css('border-color', '#dc3545');
          $(modalSelector + ' button[type="submit"]').prop('disabled', true);
          $.notify({
            title: "Duplicate Serial",
            message: `âš ï¸ ${label} with SN '${sn}' already exists!`,
            icon: "fa fa-exclamation-triangle"
          }, {
            type: "danger",
            placement: { from: "bottom", align: "right" },
            delay: 5000,
            z_index: 9999
          });
        } else {
          $(inputSelector).removeClass('is-invalid').css('border-color', '#28a745');
          $(modalSelector + ' button[type="submit"]').prop('disabled', false);
        }
      },
      error: function(xhr, status, error) {
        console.error("âŒ AJAX Error:", status, error);
      }
    });
  }

  // âœ… Add Modals
  const addMappings = [
    { id: "#monitor_sn", cat: "Monitor", modal: "#addMonitorModal" },
    { id: "#keyboard_sn", cat: "Keyboard", modal: "#addKeyboardModal" },
    { id: "#mouse_sn", cat: "Mouse", modal: "#addMouseModal" },
    { id: "#ups_sn", cat: "UPS", modal: "#addUPSModal" },
    { id: "#desktop_sn", cat: "Desktop", modal: "#addDesktopModal" },
  ];
  addMappings.forEach(item => {
    $(document).on('blur keyup', item.id, function() {
      const sn = $(this).val().trim();
      if (!sn) return resetField(item.id, item.modal);
      checkDuplicate(sn, item.cat, '', item.id, item.modal, item.cat);
    });
  });

  // âœ… Edit Modals (unique check with exclude_id)
  const editMappings = [
    { id: "#editMonitorSN", cat: "Monitor", modal: "#editMonitorModal", idField: "#editMonitorID" },
    { id: "#editKeyboardSN", cat: "Keyboard", modal: "#editKeyboardModal", idField: "#editKeyboardID" },
    { id: "#editMouseSN", cat: "Mouse", modal: "#editMouseModal", idField: "#editMouseID" },
    { id: "#editUPSSN", cat: "UPS", modal: "#editUpsModal", idField: "#editUPSID" },
    { id: "#editDesktopSN", cat: "Desktop", modal: "#editDesktopModal", idField: "#editDesktopID" },
  ];
  editMappings.forEach(item => {
    $(document).on('blur keyup', item.id, function() {
      const sn = $(this).val().trim();
      const id = $(item.idField).val();
      if (!sn) return resetField(item.id, item.modal);
      checkDuplicate(sn, item.cat, id, item.id, item.modal, item.cat);
    });
  });

  // âœ… Reset validation when switching to "From Salvage"
  $('#salvage-tab').on('click', function() {
    $('#monitor_sn, #keyboard_sn, #mouse_sn, #ups_sn, #desktop_sn')
      .removeClass('is-invalid')
      .css('border-color', '');
    $('.modal button[type="submit"]').prop('disabled', false);
  });
});
</script>


<!-- ==================== DESKTOP ACTION SCRIPT (Edit + Dispose combined) ==================== -->  
<script>
(function() {
  // ðŸ”¹ CSRF helper
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  const csrftoken = getCookie('csrftoken');
  $.ajaxSetup({
    beforeSend: function(xhr, settings) {
      if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      }
    }
  });

  // ðŸ”¹ Generic AJAX handler (Edit + Dispose)
  function handleDesktopForm(formSelector, modalSelector, successMessage, btnDefaultText, redirectHash = "#pills-desktop") {
    const form = document.querySelector(formSelector);
    if (!form) return;

    form.addEventListener("submit", function(e) {
      e.preventDefault();

      const url = form.getAttribute("action");
      const submitBtn = form.querySelector('button[type="submit"]');
      const spinner = submitBtn.querySelector(".spinner-border");
      const btnText = submitBtn.querySelector(".button-text");

      submitBtn.disabled = true;
      spinner && spinner.classList.remove("d-none");
      btnText && (btnText.textContent = "Processing...");

      $.ajax({
        url: url,
        type: "POST",
        data: $(form).serialize(),
        success: function(resp) {
          if (resp.success) {
            if (modalSelector) $(modalSelector).modal("hide");

            $.notify({
              title: "âœ… Success",
              message: resp.message || successMessage,
              icon: "fa fa-check-circle"
            }, {
              type: "success",
              placement: { from: "bottom", align: "right" },
              delay: 2500,
              z_index: 9999
            });

            setTimeout(() => {
              const reloadUrl = resp.redirect_url || (window.location.pathname + redirectHash);
              window.location.href = reloadUrl;
              location.reload();
            }, 1000);
          } else {
            $.notify({
              title: "âš ï¸ Failed",
              message: resp.error || "Something went wrong.",
              icon: "fa fa-exclamation-triangle"
            }, {
              type: "danger",
              placement: { from: "bottom", align: "right" },
              delay: 4000,
              z_index: 9999
            });
          }
        },
        error: function(xhr) {
          $.notify({
            title: "âŒ Server Error",
            message: xhr.responseJSON?.error || "Unexpected error occurred.",
            icon: "fa fa-times-circle"
          }, {
            type: "danger",
            placement: { from: "bottom", align: "right" },
            delay: 4000,
            z_index: 9999
          });
        },
        complete: function() {
          submitBtn.disabled = false;
          spinner && spinner.classList.add("d-none");
          btnText && (btnText.textContent = btnDefaultText);
        }
      });
    });
  }

  // âœ… Edit Desktop Modal
  handleDesktopForm(
    "#editDesktopForm", 
    "#editDesktopModal", 
    "Desktop details updated successfully!", 
    "Save Changes"
  );

  // âœ… Dispose Desktop Modal
  handleDesktopForm(
    "#disposeDesktopForm", 
    "#disposeModal", 
    "Desktop disposed successfully!", 
    "Confirm Dispose"
  );
})();
</script>





<!-- ==================== MONITOR ACTION SCRIPT (Add + Edit + Dispose combined) ==================== -->
<script>
(function() {
  // ðŸ”¹ CSRF helper
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  const csrftoken = getCookie('csrftoken');
  $.ajaxSetup({
    beforeSend: function(xhr, settings) {
      if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      }
    }
  });

  // ðŸ”¹ Generic handler
  function handleMonitorForm(formSelector, modalSelector, successMessage, btnDefaultText) {
    const form = document.querySelector(formSelector);
    if (!form) return;

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const url = form.getAttribute('action');
      const submitBtn = form.querySelector('button[type="submit"]');
      const spinner = submitBtn.querySelector('.spinner-border');
      const btnText = submitBtn.querySelector('.button-text');

      submitBtn.disabled = true;
      spinner && spinner.classList.remove('d-none');
      btnText && (btnText.textContent = 'Processing...');

      $.ajax({
        url: url,
        type: 'POST',
        data: $(form).serialize(),
        success: function(resp) {
          if (resp.success) {
            if (modalSelector) $(modalSelector).modal('hide');

            $.notify({
              title: "âœ… Success",
              message: resp.message || successMessage,
              icon: "fa fa-check-circle"
            }, {
              type: "success",
              placement: { from: "bottom", align: "right" },
              delay: 2500,
              z_index: 9999
            });

            setTimeout(() => {
              const reloadUrl = resp.redirect_url || (window.location.pathname + "#pills-monitor");
              window.location.href = reloadUrl;
              location.reload();
            }, 1000);
          } else {
            $.notify({
              title: "âš ï¸ Failed",
              message: resp.message || "Something went wrong.",
              icon: "fa fa-exclamation-triangle"
            }, {
              type: "danger",
              placement: { from: "bottom", align: "right" },
              delay: 4000,
              z_index: 9999
            });
          }
        },
        error: function(xhr) {
          $.notify({
            title: "âŒ Server Error",
            message: xhr.responseJSON?.error || "Unexpected error occurred.",
            icon: "fa fa-times-circle"
          }, {
            type: "danger",
            placement: { from: "bottom", align: "right" },
            delay: 4000,
            z_index: 9999
          });
        },
        complete: function() {
          submitBtn.disabled = false;
          spinner && spinner.classList.add('d-none');
          btnText && (btnText.textContent = btnDefaultText);
        }
      });
    });
  }

  // ðŸ”¹ Initialize handlers for Add, Edit, Dispose
  handleMonitorForm('#addMonitorForm', '#addMonitorModal', 'Monitor added successfully!', 'Add Monitor');
  handleMonitorForm('#editMonitorForm', '#editMonitorModal', 'Monitor updated successfully!', 'Update Monitor');
  handleMonitorForm('#disposeMonitorForm', '#confirmDisposeModal_Monitor', 'Monitor disposed successfully!', 'Confirm Dispose');
})();
</script>



<!-- ==================== KEYBOARD ACTION SCRIPT (Add + Edit + Dispose combined) ==================== -->
<script>
(function() {
  // ðŸ”¹ CSRF helper
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  const csrftoken = getCookie('csrftoken');
  $.ajaxSetup({
    beforeSend: function(xhr, settings) {
      if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      }
    }
  });

  // ðŸ”¹ Generic handler for any keyboard modal form
  function handleKeyboardForm(formSelector, modalSelector, successMessage, btnDefaultText) {
    const form = document.querySelector(formSelector);
    if (!form) return;

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const url = form.getAttribute('action');
      const submitBtn = form.querySelector('button[type="submit"]');
      const spinner = submitBtn.querySelector('.spinner-border');
      const btnText = submitBtn.querySelector('.button-text');

      submitBtn.disabled = true;
      spinner && spinner.classList.remove('d-none');
      btnText && (btnText.textContent = 'Processing...');

      $.ajax({
        url: url,
        type: 'POST',
        data: $(form).serialize(),
        success: function(resp) {
          if (resp.success) {
            if (modalSelector) $(modalSelector).modal('hide');

            $.notify({
              title: "âœ… Success",
              message: resp.message || successMessage,
              icon: "fa fa-check-circle"
            }, {
              type: "success",
              placement: { from: "bottom", align: "right" },
              delay: 2500,
              z_index: 9999
            });

            // âœ… Reload on Keyboard tab
            setTimeout(() => {
              const reloadUrl = resp.redirect_url || (window.location.pathname + "#pills-keyboard");
              window.location.href = reloadUrl;
              location.reload();
            }, 1000);

          } else {
            $.notify({
              title: "âš ï¸ Failed",
              message: resp.message || "Something went wrong.",
              icon: "fa fa-exclamation-triangle"
            }, {
              type: "danger",
              placement: { from: "bottom", align: "right" },
              delay: 4000,
              z_index: 9999
            });
          }
        },
        error: function(xhr) {
          $.notify({
            title: "âŒ Server Error",
            message: xhr.responseJSON?.error || "Unexpected error occurred.",
            icon: "fa fa-times-circle"
          }, {
            type: "danger",
            placement: { from: "bottom", align: "right" },
            delay: 4000,
            z_index: 9999
          });
        },
        complete: function() {
          submitBtn.disabled = false;
          spinner && spinner.classList.add('d-none');
          btnText && (btnText.textContent = btnDefaultText);
        }
      });
    });
  }

  // ðŸ”¹ Initialize handlers for Add, Edit, Dispose
  handleKeyboardForm('#addKeyboardForm', '#addKeyboardModal', 'Keyboard added successfully!', 'Add Keyboard');
  handleKeyboardForm('#editKeyboardForm', '#editKeyboardModal', 'Keyboard updated successfully!', 'Save Changes');
  handleKeyboardForm('#disposeKeyboardForm', '#confirmDisposeModalKeyboard', 'Keyboard disposed successfully!', 'Confirm Dispose');
})();
</script>








<!-- ==================== MOUSE ACTION SCRIPT (Add + Edit + Dispose combined) ==================== -->
<script>
(function() {
  // ðŸ”¹ CSRF helper
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  const csrftoken = getCookie('csrftoken');
  $.ajaxSetup({
    beforeSend: function(xhr, settings) {
      if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      }
    }
  });

  // ðŸ”¹ Generic handler for mouse modals
  function handleMouseForm(formSelector, modalSelector, successMessage, btnDefaultText) {
    const form = document.querySelector(formSelector);
    if (!form) return;

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const url = form.getAttribute('action');
      const submitBtn = form.querySelector('button[type="submit"]');
      const spinner = submitBtn.querySelector('.spinner-border');
      const btnText = submitBtn.querySelector('.button-text');

      submitBtn.disabled = true;
      spinner && spinner.classList.remove('d-none');
      btnText && (btnText.textContent = 'Processing...');

      $.ajax({
        url: url,
        type: 'POST',
        data: $(form).serialize(),
        success: function(resp) {
          if (resp.success) {
            if (modalSelector) $(modalSelector).modal('hide');

            $.notify({
              title: "âœ… Success",
              message: resp.message || successMessage,
              icon: "fa fa-check-circle"
            }, {
              type: "success",
              placement: { from: "bottom", align: "right" },
              delay: 2500,
              z_index: 9999
            });

            setTimeout(() => {
              const reloadUrl = resp.redirect_url || (window.location.pathname + "#pills-mouse");
              window.location.href = reloadUrl;
              location.reload();
            }, 1000);
          } else {
            $.notify({
              title: "âš ï¸ Failed",
              message: resp.message || "Something went wrong.",
              icon: "fa fa-exclamation-triangle"
            }, {
              type: "danger",
              placement: { from: "bottom", align: "right" },
              delay: 4000,
              z_index: 9999
            });
          }
        },
        error: function(xhr) {
          $.notify({
            title: "âŒ Server Error",
            message: xhr.responseJSON?.error || "Unexpected error occurred.",
            icon: "fa fa-times-circle"
          }, {
            type: "danger",
            placement: { from: "bottom", align: "right" },
            delay: 4000,
            z_index: 9999
          });
        },
        complete: function() {
          submitBtn.disabled = false;
          spinner && spinner.classList.add('d-none');
          btnText && (btnText.textContent = btnDefaultText);
        }
      });
    });
  }

  // ðŸ”¹ Initialize for all Mouse modals
  handleMouseForm('#addMouseForm', '#addMouseModal', 'Mouse added successfully!', 'Add Mouse');
  handleMouseForm('#editMouseForm', '#editMouseModal', 'Mouse updated successfully!', 'Update Mouse');
  handleMouseForm('#disposeMouseForm', '#confirmDisposeMouseModal', 'Mouse disposed successfully!', 'Confirm Dispose');
})();
</script>


<!-- ==================== UPS ACTION SCRIPT (Add + Edit + Dispose) ==================== -->
<script>
(function() {
  // ðŸ”¹ CSRF helper
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  const csrftoken = getCookie('csrftoken');
  $.ajaxSetup({
    beforeSend: function(xhr, settings) {
      if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      }
    }
  });

  // ðŸ”¹ Generic handler for UPS modals
  function handleUPSForm(formSelector, modalSelector, successMessage, btnDefaultText) {
    const form = document.querySelector(formSelector);
    if (!form) return;

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const url = form.getAttribute('action');
      const submitBtn = form.querySelector('button[type="submit"]');
      const spinner = submitBtn.querySelector('.spinner-border');
      const btnText = submitBtn.querySelector('.button-text');

      submitBtn.disabled = true;
      spinner && spinner.classList.remove('d-none');
      btnText && (btnText.textContent = 'Processing...');

      $.ajax({
        url: url,
        type: 'POST',
        data: $(form).serialize(),
        success: function(resp) {
          if (resp.success) {
            if (modalSelector) $(modalSelector).modal('hide');

            $.notify({
              title: "âœ… Success",
              message: resp.message || successMessage,
              icon: "fa fa-check-circle"
            }, {
              type: "success",
              placement: { from: "bottom", align: "right" },
              delay: 2500,
              z_index: 9999
            });

            setTimeout(() => {
              const reloadUrl = resp.redirect_url || (window.location.pathname + "#pills-ups");
              window.location.href = reloadUrl;
              location.reload();
            }, 1000);
          } else {
            $.notify({
              title: "âš ï¸ Failed",
              message: resp.message || "Something went wrong.",
              icon: "fa fa-exclamation-triangle"
            }, {
              type: "danger",
              placement: { from: "bottom", align: "right" },
              delay: 4000,
              z_index: 9999
            });
          }
        },
        error: function(xhr) {
          $.notify({
            title: "âŒ Server Error",
            message: xhr.responseJSON?.error || "Unexpected error occurred.",
            icon: "fa fa-times-circle"
          }, {
            type: "danger",
            placement: { from: "bottom", align: "right" },
            delay: 4000,
            z_index: 9999
          });
        },
        complete: function() {
          submitBtn.disabled = false;
          spinner && spinner.classList.add('d-none');
          btnText && (btnText.textContent = btnDefaultText);
        }
      });
    });
  }

  // ðŸ”¹ Initialize UPS modals
  handleUPSForm('#addUPSForm', '#addUPSModal', 'UPS added successfully!', 'Add UPS');
  handleUPSForm('#editUPSForm', '#editUpsModal', 'UPS updated successfully!', 'Update UPS');
  handleUPSForm('#disposeUPSForm', '#confirmDisposeUpsModal', 'UPS disposed successfully!', 'Confirm Dispose');
})();
</script>

<!-- ==================== DOCUMENT UPDATE SCRIPT ==================== -->
<script>
(function() {
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  const csrftoken = getCookie('csrftoken');
  $.ajaxSetup({
    beforeSend: function(xhr, settings) {
      if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      }
    }
  });

  const form = document.getElementById('editDocumentsForm');
  if (!form) return;

  form.addEventListener('submit', function(e) {
    e.preventDefault();
    const url = form.getAttribute('action');

    const submitBtn = form.querySelector('button[type="submit"]');
    const spinner = submitBtn.querySelector('.spinner-border');
    const btnText = submitBtn.querySelector('.button-text');

    submitBtn.disabled = true;
    spinner.classList.remove('d-none');
    btnText.textContent = 'Saving...';

    const payload = $(form).serialize();

    $.ajax({
      url: url,
      type: 'POST',
      data: payload,
      success: function(resp) {
        if (resp.success) {
          $('#editDocumentsModal').modal('hide');
          $.notify({
            title: "âœ… Success",
            message: resp.message || "Document details updated successfully!",
            icon: "fa fa-check-circle"
          }, {
            type: "success",
            placement: { from: "bottom", align: "right" },
            delay: 2500,
            z_index: 9999
          });

          setTimeout(() => {
            const redirect = resp.redirect_url || (window.location.pathname + "#pills-documents");
            window.location.href = redirect;
            location.reload();
          }, 1000);
        } else {
          $.notify({
            title: "âš ï¸ Failed",
            message: resp.message || "Update failed. Please try again.",
            icon: "fa fa-exclamation-triangle"
          }, {
            type: "danger",
            placement: { from: "bottom", align: "right" },
            delay: 4000,
            z_index: 9999
          });
        }
      },
      error: function(xhr) {
        $.notify({
          title: "âŒ Server Error",
          message: xhr.responseJSON?.error || "An unexpected error occurred.",
          icon: "fa fa-times-circle"
        }, {
          type: "danger",
          placement: { from: "bottom", align: "right" },
          delay: 4000,
          z_index: 9999
        });
      },
      complete: function() {
        submitBtn.disabled = false;
        spinner.classList.add('d-none');
        btnText.textContent = 'Update Document Details';
      }
    });
  });
})();
</script>





<!-- ==================== END USER UPDATE SCRIPT ==================== -->
<script>
(function() {
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  const csrftoken = getCookie('csrftoken');
  $.ajaxSetup({
    beforeSend: function(xhr, settings) {
      if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      }
    }
  });

  const form = document.getElementById('editEndUserForm');
  if (!form) return;

  form.addEventListener('submit', function(e) {
    e.preventDefault();
    const url = form.dataset.url;
    if (!url) {
      console.error('âŒ Missing data-url on #editEndUserForm');
      return;
    }

    const submitBtn = document.getElementById('submitButton');
    const spinner = submitBtn.querySelector('.spinner-border');
    const btnText = submitBtn.querySelector('.button-text');
    const errorBox = document.getElementById('enduserError');

    submitBtn.disabled = true;
    spinner.classList.remove('d-none');
    btnText.textContent = 'Saving...';
    if (errorBox) { errorBox.classList.add('d-none'); errorBox.textContent = ''; }

    const payload = $(form).serialize();

    $.ajax({
      url: url,
      type: 'POST',
      data: payload,
      success: function(resp) {
        if (resp.success) {
          $('#editEndUserModal').modal('hide');
          $.notify({
            title: "âœ… Success",
            message: "End user updated successfully!",
            icon: "fa fa-check-circle"
          }, {
            type: "success",
            placement: { from: "bottom", align: "right" },
            delay: 3000
          });
          setTimeout(() => location.reload(), 1000);
        } else {
          const msg = resp.error || "Unknown error.";
          $.notify({ title: "âš ï¸ Failed", message: msg, icon: "fa fa-exclamation-triangle" },
                   { type: "danger", placement: { from: "bottom", align: "right" }, delay: 5000 });
          if (errorBox) { errorBox.textContent = msg; errorBox.classList.remove('d-none'); }
        }
      },
      error: function(xhr) {
        const msg = xhr.responseJSON?.error || "Server error";
        $.notify({ title: "âŒ Server Error", message: msg, icon: "fa fa-times-circle" },
                 { type: "danger", placement: { from: "bottom", align: "right" }, delay: 5000 });
      },
      complete: function() {
        submitBtn.disabled = false;
        spinner.classList.add('d-none');
        btnText.textContent = 'Save Changes';
      }
    });
  });
})();
</script>

<!-- ==================== ASSET OWNER TRANSFER SCRIPT ==================== -->

<script>
$(document).ready(function () {
  // --- Asset Owner Transfer Form ---
  const assetForm = $('#editAssetOwnerForm');

  assetForm.on('submit', function (e) {
    e.preventDefault();

    const url = assetForm.data('url');
    const submitBtn = $('#submitButtonAsset');
    const spinner = submitBtn.find('.spinner-border');
    const btnText = submitBtn.find('.button-text');
    const errorBox = $('#assetOwnerError');
    const desktopId = "{{ equipment_package.id }}";
    const payload = assetForm.serialize(); // includes csrfmiddlewaretoken

    // Disable submit button and show loading state
    submitBtn.prop('disabled', true);
    spinner.removeClass('d-none');
    btnText.text('Saving...');
    errorBox.addClass('d-none').text('');

    $.ajax({
      url: url,
      type: 'POST',
      data: payload,
      success: function (resp) {
        if (resp.success) {
          $('#editAssetOwnerModal').modal('hide');
          // âœ… Optional: Show success toast
          $.notify({
            title: "âœ… Success",
            message: "Asset owner transferred successfully!",
            icon: "fa fa-check-circle"
          }, {
            type: "success",
            placement: { from: "bottom", align: "right" },
            delay: 2500,
            z_index: 9999
          });

          // âœ… Refresh after slight delay
          setTimeout(() => {
            window.location.href = `/desktop_details_view/${desktopId}/#pills-user`;
            window.location.reload();
          }, 1000);
        } else {
          const msg = resp.error || 'Transfer failed.';
          showError(msg);
        }
      },
      error: function (xhr) {
        const msg = xhr.responseJSON?.error || "Server error while transferring ownership.";
        showError(msg);
      },
      complete: function () {
        submitBtn.prop('disabled', false);
        spinner.addClass('d-none');
        btnText.text('Save Changes');
      }
    });

    // --- Local helper ---
    function showError(msg) {
      $.notify({
        title: "âš ï¸ Error",
        message: msg,
        icon: "fa fa-exclamation-triangle"
      }, {
        type: "danger",
        placement: { from: "bottom", align: "right" },
        delay: 4000,
        z_index: 9999
      });
      errorBox.text(msg).removeClass('d-none');
    }
  });

  // Reset modal when closed
  $('#editAssetOwnerModal').on('hidden.bs.modal', function () {
    assetForm.trigger('reset');
    $('#assetOwnerError').addClass('d-none').text('');
  });
});
</script>



<!-- ==================== TAB NAVIGATION WITH URL HASH ==================== -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  // 1ï¸âƒ£ Auto-open the correct tab if there's a hash in the URL
  const hash = window.location.hash;
  if (hash) {
    const triggerEl = document.querySelector(`button[data-bs-target="${hash}"]`);
    if (triggerEl) {
      const tab = new bootstrap.Tab(triggerEl);
      tab.show();
    }
  }

  // 2ï¸âƒ£ When the user switches tabs, update the hash in the URL
  const tabButtons = document.querySelectorAll('button[data-bs-toggle="pill"]');
  tabButtons.forEach(btn => {
    btn.addEventListener('shown.bs.tab', function (e) {
      const target = e.target.getAttribute('data-bs-target');
      history.replaceState(null, null, target);
    });
  });
});
</script>


<script>
  // âœ… Formats both OS and Office keys â€” adds dashes every 5 characters
  function formatProductKey(input) {
    let value = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
    input.value = value.match(/.{1,5}/g)?.join('-') || '';
  }
</script>
{% endblock %}



{% endblock %}