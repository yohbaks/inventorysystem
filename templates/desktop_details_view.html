{% extends 'base.html' %}
{% load static %} 
{% block content %}
<div class="container">
  <div class="page-inner">
    <div class="row">
      <!-- Left Column -->
      <div class="col-md-8">
        <div class="card card-round">
          <div class="card-header">
            {% comment %} <div class="card-title"><h3>{{ desktop_detailsx.computer_name }}</h3></div> {% endcomment %}
            <div class="card-tools">
              {% if not desktop_detailsx.is_disposed %}
              <button class="btn btn-label-danger btn-round btn-sm me-2" data-bs-toggle="modal" data-bs-target="#disposeModal">
                <span class="btn-label"><i class="fa fa-location-arrow"></i></span> Return to Supply
              </button>
              {% endif %}
              <a href="{% url 'export_desktop_excel' %}" class="btn btn-label-success btn-round btn-sm me-2">
                <span class="btn-label"><i class="fa fa-pencil"></i></span> ExporT
              </a>
              <a href="{% url 'maintenance_history' desktop_package.id %}" class="btn btn-label-info btn-round btn-sm">
                <span class="btn-label" ><i class="fa fa-print"></i></span> Maintenance
              </a>
              <a href="{% url 'generate_desktop_pdf' desktop_package.id %}" class="btn btn-label-success btn-round btn-sm me-2">
                  <i class="fa fa-file-pdf"></i> Download PDF
              </a>
              <!-- Trigger Button for QR CODE -->
                <button type="button" class="btn btn-label-warning btn-round btn-sm" data-bs-toggle="modal" data-bs-target="#qrModal">
                <i class="fas fa-qrcode"></i> Generate QR Code
                </button>
            
            </div>


          </div> 
<!-- Trigger Button -->

<!-- Modal Structure of QR CODDE -->
<div class="modal fade" id="qrModal" tabindex="-1" aria-labelledby="qrModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title" id="qrModalLabel">Desktop Package QR Code</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body text-center">
        {% if desktop_package.qr_code %}
          <img src="{{ desktop_package.qr_code.url }}" alt="QR Code for Desktop Package {{ desktop_package.pk }}" width="200">
          <p class="mt-2">Scan to view this desktop package</p>
        {% else %}
          <p>No QR code available.</p>
        {% endif %}
      </div>

    </div>
  </div>
</div>
          <div class="card-body">
            <!-- Pills Navigation -->
            <ul class="nav nav-pills nav-secondary nav-pills-no-bd nav-pills-icons justify-content-center" id="pills-tab-with-icon" role="tablist">
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link active" id="pills-desktop-tab" data-bs-toggle="pill" href="#pills-desktop" role="tab" aria-controls="pills-desktop" aria-selected="true">
                  <i class="fas fa-power-off"></i> Desktop Details
                </a>
              </li>
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link" id="pills-monitor-tab" data-bs-toggle="pill" href="#pills-monitor" role="tab" aria-controls="pills-monitor" aria-selected="false">
                  <i class="fas fa-tv"></i> Monitor Details
                </a>
              </li>
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link" id="pills-keyboard-tab" data-bs-toggle="pill" href="#pills-keyboard" role="tab" aria-controls="pills-keyboard" aria-selected="false">
                  <i class="fas fa-keyboard"></i> Keyboard Details
                </a>
              </li>
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link" id="pills-mouse-tab" data-bs-toggle="pill" href="#pills-mouse" role="tab" aria-controls="pills-mouse" aria-selected="false">
                  <i class="fas fa-mouse-pointer"></i> Mouse Details
                </a>
              </li>
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link" id="pills-ups-tab" data-bs-toggle="pill" href="#pills-ups" role="tab" aria-controls="pills-ups" aria-selected="false">
                  <i class="fas fa-battery-full"></i> UPS Details
                </a>
              </li>
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link" id="pills-user-tab" data-bs-toggle="pill" href="#pills-user" role="tab" aria-controls="pills-user" aria-selected="false">
                  <i class="fas fa-user"></i> User Details
                </a>
              </li>
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link" id="pills-documents-tab" data-bs-toggle="pill" href="#pills-documents" role="tab" aria-controls="pills-documents" aria-selected="false">
                  <i class="fas fa-file-alt"></i> Documents
                </a>
              </li>
              
            </ul>
          </div>
        </div>
      </div>
      
               {% if desktop_detailsx.is_disposed %}
                    <div class="col-md-4">
                <div class="card card-danger bg-danger-gradient">
                  <div class="card-body curves-shadow">
                    <img src="{% static 'img/kaiadmin/logo_light.svg' %}" height="20" alt="Visa Logo">
                    <h1 class="py-4 mb-0">{{ desktop_detailsx.computer_name }}</h1>
                    <div class="row">
                      <div class="col-8 pe-0">
                        <h3 class="fw-bold mb-1">{{ user_details.user_Assetowner.employee_fname}} {{ user_details.user_Assetowner.employee_mname}}. {{ user_details.user_Assetowner.employee_lname}}</h3>
                        <div class="text-small text-uppercase fw-bold op-8">
                          {{ user_details.user_Assetowner.employee_position}}
                        </div>
                      </div>
                      <div class="col-4 ps-0 text-end">
                        <h3 class="fw-bold mb-1">4/26</h3>
                        <div class="text-small text-uppercase fw-bold op-8">
                          Date Enetered
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
               {% else %}
               

    <div class="col-md-4">
                <div class="card card-secondary bg-secondary-gradient">
                  <div class="card-body curves-shadow">
                    <img src="{% static 'img/kaiadmin/logo_light.svg' %}" height="20" alt="Visa Logo">
                    <h1 class="py-4 mb-0">{{ desktop_detailsx.computer_name }}</h1>
                    <div class="row">
                      <div class="col-8 pe-0">
                        <h3 class="fw-bold mb-1">{{ user_details.user_Assetowner.employee_fname}} {{ user_details.user_Assetowner.employee_mname}}. {{ user_details.user_Assetowner.employee_lname}}</h3>
                        <div class="text-small text-uppercase fw-bold op-8">
                          {{ user_details.user_Assetowner.employee_position}}
                        </div>
                      </div>
                      <div class="col-4 ps-0 text-end">
                        <h3 class="fw-bold mb-1">4/26</h3>
                        <div class="text-small text-uppercase fw-bold op-8">
                          Date Enetered
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              {% endif %}

      <!-- Desktop Details Tab -->
    <!-- Tab Content -->
    <div class="tab-content mt-2 mb-3" id="pills-tabContent">
      <!-- Desktop Details Tab -->
      <div class="tab-pane fade show active" id="pills-desktop" role="tabpanel" aria-labelledby="pills-desktop-tab">
        <div class="card">
          <div class="card-header">
            {% if has_active_desktop %}
            <div class="card-title">Desktop Details</div>
          </div>
          <div class="card-body">
            <table class="table table-head-bg-success table-bordered table-hover">
              <thead>
                <tr>
                  <th scope="col-md-4 ms-auto me-auto">ATTRIBUTES</th>
                  <th scope="col">DETAILS</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Package Number:</strong></td>
                  <td>{{ desktop_detailsx.desktop_package }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Serial Number:</strong></td>
                  <td>{{ desktop_detailsx.serial_no }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Brand Name:</strong></td>
                  <td>{{ desktop_detailsx.brand_name }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Model:</strong></td>
                  <td>{{ desktop_detailsx.model }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Processor:</strong></td>
                  <td>{{ desktop_detailsx.processor }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Memory:</strong></td>
                  <td>{{ desktop_detailsx.memory }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Drive:</strong></td>
                  <td>{{ desktop_detailsx.drive }}</td>
                </tr>
              </tbody>
            </table>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editDesktopModal">Edit</button>
            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#disposeModal">Dispose</button>

<!-- Update desktop Modal -->

<div class="modal fade" id="editDesktopModal" tabindex="-1" aria-labelledby="editDesktopModal" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" action="{% url 'update_desktop' pk=desktop_detailsx.id %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editDesktopModal">Edit Desktopp</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="desktopId">

          
          <div class="mb-3">
            <label for="desktop_sn_form" class="form-label">Serial Number</label>
            <input type="text" class="form-control" id="desktop_sn_form" name="desktop_sn_form" value="{{ desktop_detailsx.serial_no }}" required>
          </div>
          <div class="mb-3">
            <label for="desktop_brand_form" class="form-label">Brand</label>
            <select class="form-select form-control" id="desktop_brand_form" name="desktop_brand_form" required>
              <option value="" disabled>Select Brand</option>
              {% for brandD in desktop_brands %}
                <option value="{{ brandD.id }}"
                        {% if desktop_detailsx.brand_name.id == brandD.id %}selected{% endif %}>
                  {{ brandD.name }}
                </option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label for="desktop_model_form" class="form-label">Model</label>
            <input type="text" class="form-control" id="desktop_model_form" name="desktop_model_form" value="{{ desktop_detailsx.model }}" required>
          </div>
          <div class="mb-3">
            <label for="desktop_proccessor_form" class="form-label">Proccessor</label>
           <!-- <input type="text" class="form-control" id="desktop_proccessor_form" name="desktop_proccessor_form" value="{{ desktop_detailsx.processor }}" required>  -->
            <select class="form-select form-control" id="desktop_proccessor_form" name="desktop_proccessor_form" required>

                <optgroup label="Core i9 (Desktop)">
                <option value="i9-14900K" {% if desktop_detailsx.processor == 'i9-14900K' %}selected{% endif %}>Core i9-14900K (14th Gen Raptor Lake)</option>
                <option value="i9-13900K" {% if desktop_detailsx.processor == 'i9-13900K' %}selected{% endif %}>Core i9-13900K (13th Gen Raptor Lake)</option>
                <option value="i9-12900K" {% if desktop_detailsx.processor == 'i9-12900K' %}selected{% endif %}>Core i9-12900K (12th Gen Alder Lake)</option>
                <option value="i9-11900K" {% if desktop_detailsx.processor == 'i9-11900K' %}selected{% endif %}>Core i9-11900K (11th Gen Rocket Lake)</option>
                <option value="i9-10900K" {% if desktop_detailsx.processor == 'i9-10900K' %}selected{% endif %}>Core i9-10900K (10th Gen Comet Lake)</option>
              </optgroup>

              <optgroup label="Core i7 (Desktop)">
                <option value="i7-14700K" {% if desktop_detailsx.processor == 'i7-14700K' %}selected{% endif %}>Core i7-14700K (14th Gen)</option>
                <option value="i7-13700K" {% if desktop_detailsx.processor == 'i7-13700K' %}selected{% endif %}>Core i7-13700K (13th Gen)</option>
                <option value="i7-12700K" {% if desktop_detailsx.processor == 'i7-12700K' %}selected{% endif %}>Core i7-12700K (12th Gen)</option>
                <option value="i7-11700K" {% if desktop_detailsx.processor == 'i7-11700K' %}selected{% endif %}>Core i7-11700K (11th Gen)</option>
              </optgroup>

              <optgroup label="Core i5 (Desktop)">
                <option value="i5-14600K" {% if desktop_detailsx.processor == 'i5-14600K' %}selected{% endif %}>Core i5-14600K (14th Gen)</option>
                <option value="i5-13600K" {% if desktop_detailsx.processor == 'i5-13600K' %}selected{% endif %}>Core i5-13600K (13th Gen)</option>
                <option value="i5-12600K" {% if desktop_detailsx.processor == 'i5-12600K' %}selected{% endif %}>Core i5-12600K (12th Gen)</option>
                <option value="i5-11600K" {% if desktop_detailsx.processor == 'i5-11600K' %}selected{% endif %}>Core i5-11600K (11th Gen)</option>
              </optgroup>

            </select>
          </div>
          <div class="mb-3">
            <label for="desktop_memory_form" class="form-label">Memory</label>
            <input type="text" class="form-control" id="desktop_memory_form" name="desktop_memory_form" value="{{ desktop_detailsx.memory }}" required>
          </div>
          <div class="mb-3">
            <label for="desktop_drive_form" class="form-label">Drive</label>
            <input type="text" class="form-control" id="desktop_drive_form" name="desktop_drive_form" value="{{ desktop_detailsx.drive }}" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Update Desktop Package</button>
        </div>
      </div>
    </form>
  </div>
</div>            

           
  {% endif %}
{% if disposed_desktop.exists %}
      <hr>
      <h5>Disposed Desktop Details</h5>
      <table class="table table-head-bg-danger table-bordered table-hover">
        <thead>
          <tr>
            <th>Serial Number</th>
            <th>Brand</th>
            <th>Model</th>
            <th>Disposal Date</th>
          </tr>
        </thead>
        <tbody>
          {% for record in disposed_desktop %}
          <tr>
            <td>{{ record.serial_no }}</td>
            <td>{{ record.brand_name }}</td>
            <td>{{ record.model }}</td>
            <td>{{ record.date_disposed|date:"Y-m-d" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
       
      {% endif %}

          </div>

          

        </div>
<!-- Preventive Maintenance Schedule and status -->
        <div class="col-md-8">
                <div class="card card-round">
                  <div class="card-header">
                    <div class="card-head-row card-tools-still-right">
                      <div class="card-title">Preventive Maintenance Schedule and Status</div>
                      <div class="card-tools">
                        <div class="dropdown">
                          <button class="btn btn-icon btn-clean me-0" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-h"></i>
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a class="dropdown-item" href="{% url 'checklist' desktop_package.id %}">Conduct PM</a>
                            <a class="dropdown-item" href="{% url 'update_desktop' pk=desktop_detailsx.id %}">PM History</a>
                            <a class="dropdown-item" href="#">PM All View</a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card-body p-0">
                    {% if pm_assignments %}
                    <div class="table-responsive">
                      <!-- Projects table -->
                      <table class="table align-items-center mb-0 table-hover">
                        <thead class="thead-light">
                          <tr>
                            <th scope="col">Quarter</th>
                            <th scope="col">Section</th>
                            <th scope="col" class="text-end">Start Date</th>
                            <th scope="col" class="text-end">End Date</th>
                            <th scope="col" class="text-end">Status</th>
                          </tr>
                        </thead>
                        <tbody>
                            {% for assignment in pm_assignments %}
                              {% if assignment.is_completed %}
                                {% url 'maintenance_history' assignment.desktop_package.id as target_url %}
                              {% else %}
                                {% url 'checklist' assignment.desktop_package.id as target_url %}
                              {% endif %}
                              <tr class="clickable-row" data-href="{{ target_url }}">
                                <th scope="row">
                                  {% if assignment.is_completed %}
                                    <span class="btn btn-icon btn-round btn-success btn-sm me-2" title="View History">
                                      <i class="fa fa-check"></i>
                                    </span>
                                  {% else %}
                                    <span class="btn btn-icon btn-round btn-warning btn-sm me-2" title="Do Checklist">
                                      <i class="fas fa-wrench"></i>
                                    </span>
                                  {% endif %}
                                  {{ assignment.pm_section_schedule.quarter_schedule.get_quarter_display }} {{ assignment.pm_section_schedule.quarter_schedule.year }}
                                </th>
                                <td class="text">{{ assignment.pm_section_schedule.section.name }}</td>
                                <td class="text-end">{{ assignment.pm_section_schedule.start_date }}</td>
                                <td class="text-end">{{ assignment.pm_section_schedule.end_date }}</td>
                                <td class="text-end">
                                  {% if assignment.is_completed %}
                                    <span class="badge bg-success">Completed</span>
                                  {% else %}
                                    <span class="badge bg-warning text-dark">Pending</span>
                                  {% endif %}
                                </td>
                              </tr>
                            {% endfor %}
                        </tbody>
                        {% else %}
                            <p>No preventive maintenance schedule found for this desktop.</p>
                        {% endif %}
                      </table>

                                <script>
                                  document.addEventListener("DOMContentLoaded", function () {
                                    const rows = document.querySelectorAll(".clickable-row");

                                    rows.forEach(row => {
                                      row.style.cursor = "pointer";
                                      row.addEventListener("click", function () {
                                        const href = this.getAttribute("data-href");
                                        if (href) {
                                          window.location.href = href;
                                        }
                                      });
                                    });
                                  });
                                </script>


                    </div>
                  </div>
                </div>
              </div>
      </div>


      <!-- Monitor Details Tab --> 
      <div class="tab-pane fade" id="pills-monitor" role="tabpanel" aria-labelledby="pills-monitor-tab">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div class="card-title">Monitor Details</div>
            {% if not has_active_monitor and has_active_desktop %}
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMonitorModal">Add Monitor</button>
            {% endif %}
           
          </div>
          <div class="card-body">
            {% if monitor_detailse %}
            <table class="table table-head-bg-success table-bordered table-hover">
              <thead>
                <tr>
                  <th scope="col-md-4 ms-auto me-auto">ATTRIBUTES</th>
                  <th scope="col">DETAILS</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Package Number:</strong></td>
                  <td>{{ monitor_detailse.desktop_package_db }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Serial Number:</strong></td>
                  <td>{{ monitor_detailse.monitor_sn_db }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Brand Name:</strong></td>
                  <td>{{ monitor_detailse.monitor_brand_db }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Model:</strong></td>
                  <td>{{ monitor_detailse.monitor_model_db }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Monitor Size:</strong></td>
                  <td>{{ monitor_detailse.monitor_size_db }}</td>
                </tr>
              </tbody>
            </table>

        
            <button 
            class="btn btn-primary edit-monitor-btn" 
            data-bs-toggle="modal" 
            data-bs-target="#editMonitorModal"
            data-id="{{ monitor_detailse.id }}"
            data-package="{{ monitor_detailse.desktop_package_db.id }}"
            data-sn="{{ monitor_detailse.monitor_sn_db }}"
            data-brand="{{ monitor_detailse.monitor_brand_db }}"
            data-model="{{ monitor_detailse.monitor_model_db }}"
            data-size="{{ monitor_detailse.monitor_size_db }}"
          >
            Edittt
          </button>
          
        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDisposeModal_Monitor">Dispose Monitor</button>

            <!-- Update Monitor Modal -->

        <div class="modal fade" id="editMonitorModal" tabindex="-1" aria-labelledby="editMonitorModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <form method="POST" action="{% url 'update_monitor' pk=monitor_detailse.id %}">
              {% csrf_token %}
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="editMonitorModalLabel">Edit Monitor</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <input type="hidden" id="monitorId">
        
                  
                  <div class="mb-3">
                    <label for="editSN" class="form-label">Serial Number</label>
                    <input type="text" class="form-control" id="editSN" name="monitor_sn_db" required value="{{ monitor_detailse.monitor_sn_db }}">
                  </div>
                  <div class="mb-3">
                    <label for="editBrand" class="form-label">Brand</label>
                    
                    <select class="form-select form-control" id="editBrand" name="monitor_brand_db" required>
                      <option value="" disabled>Select Brand</option>
                      {% for brandM in monitor_brands %}
                        <option value="{{ brandM.id }}"
                                {% if monitor_detailse.monitor_brand_db.id == brandM.id %}selected{% endif %}>
                          {{ brandM.name }}
                        </option>
                      {% endfor %}
                    </select>
                  </div>
                  <div class="mb-3">
                    <label for="editModel" class="form-label">Model</label>
                    <input type="text" class="form-control" id="editModel" name="monitor_model_db" value="{{ monitor_detailse.monitor_model_db }}">
                  </div>
                  <div class="mb-3">
                    <label for="editSize" class="form-label">Monitor Size</label>
                    <input type="text" class="form-control" id="editSize" name="monitor_size_db" value="{{ monitor_detailse.monitor_size_db }}">
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-primary">Update Monitor</button>
                </div>
              </div>
            </form>
          </div>
        </div>


                <!-- Disposal Confirmation Modal -->
                <div class="modal fade" id="confirmDisposeModal_Monitor" tabindex="-1" aria-labelledby="confirmDisposeModal_Monitor" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="confirmDisposeModal_Monitor">Confirm Disposal</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        Are you sure you want to dispose of this Monitor?
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <!-- Disposal form inside modal -->
                        <form method="POST" action="{% url 'monitor_disposed' monitor_detailse.id %}" class="dispose-monitor-form d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger">Confirm Dispose</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
                {% endif %}



                {% if not has_active_monitor and not has_active_desktop %}
                <p class="text-danger">This Monitor was completely disposed under the whole package.</p>
                {% endif %}

                
                  
                {% if not has_active_monitor and has_active_desktop %}
                <p class="text-danger">No available Monitors for this desktop package. You can still add a monitor under this packge.</p>
                   {% endif %}
                

                 <!-- Disposed Monitor Table -->
      {% if disposed_monitor.exists %}
      <hr>
      <h5>Disposed Monitors</h5>
      <table class="table table-head-bg-danger table-bordered table-hover">
        <thead>
          <tr>
            <th>Serial Number</th>
            <th>Brand</th>
            <th>Model</th>
            <th>Disposal Date</th>
          </tr>
        </thead>
        <tbody>
          {% for disposed_monitor in disposed_monitor %}
          <tr>
            <td>{{ disposed_monitor.monitor_disposed_db.monitor_sn_db }}</td>
            <td>{{ disposed_monitor.monitor_disposed_db.monitor_brand_db }}</td>
            <td>{{ disposed_monitor.monitor_disposed_db.monitor_model_db }}</td>
            <td>{{ disposed_monitor.disposal_date }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      {% endif %}

          </div>
        </div>

         <!-- Add Monitor Modal -->
  <div class="modal fade" id="addMonitorModal" tabindex="-1" aria-labelledby="addMonitorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addMonitorModalLabel">Add New Monitor</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        {% if desktop_package and desktop_package.id %}
        <form method="POST" action="{% url 'add_monitor_to_package' desktop_package.id %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="mb-3">
              <label for="monitor_sn" class="form-label">Serial Number</label>
              <input type="text" class="form-control" id="monitor_sn" name="monitor_sn" required>
            </div>
            <div class="mb-3">
              <label for="monitor_brand" class="form-label">Brandd</label>
              <input type="text" class="form-control" id="monitor_brand" name="monitor_brand" required>
            </div>
            
            <div class="mb-3">
              <label for="monitor_brand" class="form-label">Brand</label>
              <select class="form-select form-control" id="editBrand" name="monitor_brand_db" required>
                <option value="" disabled selected>Select Brand</option>
                {% for brandMonitor in monitor_brands %}
                  <option value="{{ brandMonitor.id }}">{{ brandMonitor.name }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-3">
              <label for="monitor_model" class="form-label">Model</label>
              <input type="text" class="form-control" id="monitor_model" name="monitor_model" required>
            </div>
            <div class="mb-3">
              <label for="monitor_size" class="form-label">Size</label>
              <input type="text" class="form-control" id="monitor_size" name="monitor_size" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Monitor</button>
          </div>
        </form>
        {% else %}
        <p class="text-danger">Desktop package not available. Please create it first.</p>
        {% endif %}
      </div>
    </div>
  </div>
      </div>

      
<!-- Keyboard Details Tab ORGIGNAL -->

<div class="tab-pane fade" id="pills-keyboard" role="tabpanel" aria-labelledby="pills-keyboard-tab">
  <div class="card">
    <!-- Card Header with Flexbox to Align Title and Button -->
    <div class="card-header d-flex justify-content-between align-items-center">
      <div class="card-title">Keyboard Details</div>
      
      <!-- Conditionally show Add Keyboard Button only if no active keyboards are present -->
      {% if not has_active_keyboards and has_active_desktop%} 
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addKeyboardModal">Add Keyboard</button>
      {% endif %}
    </div>
    
    <div class="card-body">
      {% if keyboard_detailse %}
        <!-- Keyboard Details Table -->
        <table class="table table-head-bg-success table-bordered table-hover">
          <thead>
            <tr>
              <th scope="col-md-4 ms-auto me-auto">ATTRIBUTES</th>
              <th scope="col">DETAILS</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Package Number:</strong></td>
              <td>{{ keyboard_detailse.desktop_package }}</td>
            </tr>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Serial Number:</strong></td>
              <td>{{ keyboard_detailse.keyboard_sn_db }}</td>
            </tr>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Brand Name:</strong></td>
              <td>{{ keyboard_detailse.keyboard_brand_db }}</td>
            </tr>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Model:</strong></td>
              <td>{{ keyboard_detailse.keyboard_model_db }}</td>
            </tr>
          </tbody>
        </table>

        <!-- Edit and Dispose Buttons for active keyboard -->
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editKeyboardModal">Edit</button>
        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDisposeModal">Dispose Keyboard</button>


<!-- Update keyboard Modal or edit keyboard-->

<div class="modal fade" id="editKeyboardModal" tabindex="-1" aria-labelledby="editKeyboardModal" aria-hidden="true">
  <div class="modal-dialog">
     {% if keyboard_detailse and keyboard_detailse.id %}
    <form method="POST" action="{% url 'update_keyboard' pk=keyboard_detailse.id %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editKeyboardModal">Edit Keyboard</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="keyboardId">

          
          <div class="mb-3">
            <label for="editSN" class="form-label">Serial Number</label>
            <input type="text" class="form-control" id="editSN" name="keyboard_sn_db" required value="{{ keyboard_detailse.keyboard_sn_db }}" required>
          </div>
          <div class="mb-3">
            <label for="editBrand" class="form-label">Brand</label>
            <select class="form-select form-control" id="editBrand" name="keyboard_brand_db" required>
              <option value="" disabled>Select Brand</option>
              {% for brandK in keyboard_brands %}
                <option value="{{ brandK.id }}"
                        {% if keyboard_detailse.keyboard_brand_db.id == brandK.id %}selected{% endif %}>
                  {{ brandK.name }}
                </option>
              {% endfor %}
              </select>
          </div>
          <div class="mb-3">
            <label for="editModel" class="form-label">Model</label>
            <input type="text" class="form-control" id="editModel" name="keyboard_model_db" value="{{ keyboard_detailse.keyboard_model_db }}" required>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Update Keyboard Details</button>
        </div>
      </div>
    </form>

     {% else %}
      <div class="alert alert-danger m-3">
        Cannot edit keyboard: data not available.
      </div>
    {% endif %}
  </div>
</div>


        <!-- Disposal Confirmation Modal -->
        <div class="modal fade" id="confirmDisposeModal" tabindex="-1" aria-labelledby="confirmDisposeModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="confirmDisposeModalLabel">Confirm Disposal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                Are you sure you want to dispose of this keyboard?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <!-- Disposal form inside modal -->
                <form method="POST" action="{% url 'keyboard_disposed' keyboard_detailse.id %}" class="dispose-keyboard-form d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Confirm Dispose</button>
                </form>
              </div>
            </div>
          </div>
        </div>
        {% endif %}



                {% if not has_active_keyboards and not has_active_desktop %}
                <p class="text-danger">This Keyboard was completely disposed under the whole package.</p>
                {% endif %}

                            
                {% if not has_active_keyboards and has_active_desktop %}
                <p class="text-danger">No available Keyboard for this desktop package. You can still add a monitor under this packge.</p>
                {% endif %}



      <!-- Disposed Keyboards Table -->
      {% if disposed_keyboards.exists %}
      <hr>
      <h5>Disposed Keyboards</h5>
      <table class="table table-head-bg-danger table-bordered table-hover">
        <thead>
          <tr>
            <th>Serial Number</th>
            <th>Brand</th>
            <th>Model</th>
            <th>Disposal Date</th>
          </tr>
        </thead>
        <tbody>
          {% for disposed_keyboard in disposed_keyboards %}
          <tr>
            <td>{{ disposed_keyboard.keyboard_dispose_db.keyboard_sn_db}}</td>
            <td>{{ disposed_keyboard.keyboard_dispose_db.keyboard_brand_db }}</td>
            <td>{{ disposed_keyboard.keyboard_dispose_db.keyboard_model_db }}</td>
            <td>{{ disposed_keyboard.disposal_date }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
        <p>No disposed keyboards for this desktop package.</p>
      {% endif %}
    </div>
  </div>

  <!-- Add Keyboard Modal -->
  <div class="modal fade" id="addKeyboardModal" tabindex="-1" aria-labelledby="addKeyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addKeyboardModalLabel">Add New Keyboard</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        {% if desktop_package and desktop_package.id %}
        <form method="POST" action="{% url 'add_keyboard_to_package' desktop_package.id %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="mb-3">
              <label for="keyboard_sn" class="form-label">Serial Number</label>
              <input type="text" class="form-control" id="keyboard_sn" name="keyboard_sn" required>
            </div>


            <div class="mb-3">
              <label for="keyboard_brand" class="form-label">Brand</label>
              <select class="form-select form-control" id="editBrand" name="keyboard_brand_db" required>
                <option value="" disabled selected>Select Brand</option>
                {% for brandKeyboard in keyboard_brands %}
                  <option value="{{ brandKeyboard.id }}">{{ brandKeyboard.name }}</option>
                {% endfor %}
              </select>
            </div>


            <div class="mb-3">
              <label for="keyboard_model" class="form-label">Model</label>
              <input type="text" class="form-control" id="keyboard_model" name="keyboard_model" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Keyboard</button>
          </div>
        </form>

         {% else %}
      <div class="alert alert-danger m-3">
        Cannot edit keyboard: data not available.
      </div>
    {% endif %}
      </div>
    </div>
  </div>
</div>


<!-- Keyboard Details Tab END -->

      <!-- Mouse Details Tab -->
<div class="tab-pane fade" id="pills-mouse" role="tabpanel" aria-labelledby="pills-mouse-tab">
  <div class="card">
    <!-- Card Header with Flexbox to Align Title and Button -->
    <div class="card-header d-flex justify-content-between align-items-center">
      <div class="card-title">Mouse Details</div>
      
      <!-- Conditionally show Add Mouse Button only if no active mice are present -->
      {% if not has_active_mouse and has_active_desktop %}
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMouseModal">Add Mouse</button>
      {% endif %}
    </div>
    
    <div class="card-body">
      {% if mouse_detailse %}
        <!-- Mouse Details Table -->
        <table class="table table-head-bg-success table-bordered table-hover">
          <thead>
            <tr>
              <th scope="col-md-4 ms-auto me-auto">ATTRIBUTES</th>
              <th scope="col">DETAILS</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Package Number:</strong></td>
              <td>{{ mouse_detailse.desktop_package}}</td>
            </tr>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Serial Number:</strong></td>
              <td>{{ mouse_detailse.mouse_sn_db  }}</td>
            </tr>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Brand Name:</strong></td>
              <td>{{ mouse_detailse.mouse_brand_db }}</td>
            </tr>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Model:</strong></td>
              <td>{{ mouse_detailse.mouse_model_db }}</td>
            </tr>
          </tbody>
        </table>

        <!-- Edit and Dispose Buttons for active mouse -->
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editMouseModal">Edit</button>
        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDisposeMouseModal">Dispose Mouse</button>

<!-- Update Mouse Modal or edit Mouse-->

<div class="modal fade" id="editMouseModal" tabindex="-1" aria-labelledby="editMouseModal" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" action="{% url 'update_mouse' pk=mouse_detailse.id %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editMouseModal">Edit Mouse Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="mouseId">

          
          <div class="mb-3">
            <label for="editSN" class="form-label">Serial Number</label>
            <input type="text" class="form-control" id="editSN" name="mouse_sn_db" required value="{{ mouse_detailse.mouse_sn_db }}" required>
          </div>
          <div class="mb-3">
            <label for="editBrand" class="form-label">Brand</label>
            <select class="form-select form-control" id="editBrand" name="mouse_brand_db" required>
              <option value="" disabled>Select Brand</option>
              {% for brandMouse in mouse_brands %}
                <option value="{{ brandMouse.id }}"
                        {% if mouse_detailse.mouse_brand_db.id == brandMouse.id %}selected{% endif %}>
                  {{ brandMouse.name }}
                </option>
              {% endfor %}
              </select>
          </div>
          <div class="mb-3">
            <label for="editModel" class="form-label">Model</label>
            <input type="text" class="form-control" id="editModel" name="mouse_model_db" value="{{ mouse_detailse.mouse_model_db }}" required>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Update Mouse Details</button>
        </div>
      </div>
    </form>
  </div>
</div>        

        <!-- Disposal Confirmation Modal -->
        <div class="modal fade" id="confirmDisposeMouseModal" tabindex="-1" aria-labelledby="confirmDisposeMouseModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="confirmDisposeMouseModalLabel">Confirm Disposal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                Are you sure you want to dispose of this mouse?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <!-- Disposal form inside modal -->
                <form method="POST" action="{% url 'mouse_disposed' mouse_detailse.id %}" class="dispose-mouse-form d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Confirm Dispose</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      {% endif %}
                {% if not has_active_mouse and not has_active_desktop %}
                <p class="text-danger">This Mouse was completely disposed under the whole package.</p>
                {% endif %}

                            
                {% if not has_active_mouse and has_active_desktop %}
                <p class="text-danger">No available Mouse for this desktop package. You can still add a monitor under this packge.</p>
                {% endif %}

      <!-- Disposed Mice Table -->
      {% if disposed_mouse.exists %}
      <hr>
      <h5>Disposed Mice</h5>
      <table class="table table-head-bg-danger table-bordered table-hover">
        <thead>
          <tr>
            <th>Serial Number</th>
            <th>Brand</th>
            <th>Model</th>
            <th>Disposal Date</th>
          </tr>
        </thead>
        <tbody>
          {% for disposed_mousx in disposed_mouse %}
          <tr>
            <td>{{ disposed_mousx.mouse_db.mouse_sn_db }}</td>
            <td>{{ disposed_mousx.mouse_db.mouse_brand_db }}</td>
            <td>{{ disposed_mousx.mouse_db.mouse_model_db }}</td>
            <td>{{ disposed_mousx.disposal_date }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>   
      {% endif %}
    </div>
  </div>

  <!-- Add Mouse Modal -->
  <div class="modal fade" id="addMouseModal" tabindex="-1" aria-labelledby="addMouseModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addMouseModalLabel">Add New Mouse</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        {% if desktop_package and desktop_package.id %}
        <form method="POST" action="{% url 'add_mouse_to_package' desktop_package.id %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="mb-3">
              <label for="mouse_sn" class="form-label">Serial Number</label>
              <input type="text" class="form-control" id="mouse_sn" name="mouse_sn" required>
            </div>

            <div class="mb-3">
              <label for="mouse_brand" class="form-label">Brand</label>
              <select class="form-select form-control" id="editBrand" name="mouse_brand_db" required>
                <option value="" disabled selected>Select Brand</option>
                {% for brandMouse in mouse_brands %}
                  <option value="{{ brandMouse.id }}">{{ brandMouse.name }}</option>
                {% endfor %}
              </select>
            </div>
            
            <div class="mb-3">
              <label for="mouse_model" class="form-label">Model</label>
              <input type="text" class="form-control" id="mouse_model" name="mouse_model" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Mouse</button>
          </div>
        </form>
        {% else %}
  <div class="alert alert-warning">
    Mouse form not available  desktop package is missing.
  </div>
{% endif %}
      </div>  
    </div>
  </div>
</div>


      <!-- UPS Details Tab -->
      
      <div class="tab-pane fade" id="pills-ups" role="tabpanel" aria-labelledby="pills-ups-tab">
        <div class="card">
          <!-- Card Header with Flexbox to Align Title and Button -->
          <div class="card-header d-flex justify-content-between align-items-center">
            <div class="card-title">UPS Details</div>
            
            <!-- Conditionally show Add UPS Button only if no active mice are present -->
            {% if not has_active_ups and has_active_desktop %}
              <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUpsModal">Add UPS</button>
            {% endif %}
          </div>
          
          <div class="card-body">
            {% if ups_detailse %}
              <!-- UPS Details Table -->
              <table class="table table-head-bg-success table-bordered table-hover">
                <thead>
                  <tr>
                    <th scope="col-md-4 ms-auto me-auto">ATTRIBUTES</th>
                    <th scope="col">DETAILS</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="col-sm-6 col-md-3"><strong>Package Number:</strong></td>
                    <td>{{ ups_detailse.desktop_package}}</td>  
                  </tr>
                  <tr>
                    <td class="col-sm-6 col-md-3"><strong>Serial Number:</strong></td>
                    <td>{{ ups_detailse.ups_sn_db  }}</td>
                  </tr>
                  <tr>
                    <td class="col-sm-6 col-md-3"><strong>Brand Name:</strong></td>
                    <td>{{ ups_detailse.ups_brand_db }}</td>
                  </tr>
                  <tr>
                    <td class="col-sm-6 col-md-3"><strong>Model:</strong></td>
                    <td>{{ ups_detailse.ups_model_db }}</td>
                  </tr>
                  <tr>
                    <td class="col-sm-6 col-md-3"><strong>Capacity:</strong></td>
                    <td>{{ ups_detailse.ups_capacity_db }}</td>
                  </tr>
                </tbody>
              </table>
      
              <!-- Edit and Dispose Buttons for active ups -->
              <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editUpsModal">Edit</button>
              <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDisposeUpsModal">Dispose UPS</button>


                 <!-- ups update modal or edit details -->
              <div class="modal fade" id="editUpsModal" tabindex="-1" aria-labelledby="editUpsModal" aria-hidden="true">
                <div class="modal-dialog">
                  <form method="POST" action="{% url 'update_ups' pk=ups_detailse.id %}">
                    {% csrf_token %}
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="editUpsModal">Edit UPS Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <input type="hidden" id="upsId">
              
                        
                        <div class="mb-3">
                          <label for="editSN" class="form-label">Serial Number</label>
                          <input type="text" class="form-control" id="editSN" name="ups_sn_db" required value="{{ ups_detailse.ups_sn_db }}" required>
                        </div>
                        <div class="mb-3">
                          <label for="editBrand" class="form-label">Brand</label>
                          
                           <select class="form-select form-control" id="editBrand" name="ups_brand_db" required>
                            <option value="" disabled>Select Brand</option>
                            {% for brandUPS in ups_brands %}
                              <option value="{{ brandUPS.id }}"
                                      {% if ups_detailse.ups_brand_db.id == brandUPS.id %}selected{% endif %}>
                                {{ brandUPS.name }}
                              </option>
                            {% endfor %}
                            </select>
                                      </div>
                        <div class="mb-3">
                          <label for="editModel" class="form-label">Model</label>
                          <input type="text" class="form-control" id="editModel" name="ups_model_db" value="{{ ups_detailse.ups_model_db }}" required>
                        </div>
                        <div class="mb-3">
                          <label for="editCapacity" class="form-label">Capacity</label>
                          <input type="text" class="form-control" id="editCapacity" name="ups_capacity_db" value="{{ ups_detailse.ups_capacity_db }}" required>
                        </div>
              
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update UPS Details</button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>                      
      
              <!-- Disposal Confirmation Modal -->
              <div class="modal fade" id="confirmDisposeUpsModal" tabindex="-1" aria-labelledby="confirmDisposeUpsModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="confirmDisposeUpsModalLabel">Confirm Disposal</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      Are you sure you want to dispose of this UPS?
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                      <!-- Disposal form inside modal -->
                      <form method="POST" action="{% url 'ups_disposed' ups_detailse.id %}" class="dispose-ups-form d-inline">
                          {% csrf_token %}
                          <button type="submit" class="btn btn-danger">Confirm Dispose</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            {% endif %}

                {% if not has_active_ups and not has_active_desktop %}
                <p class="text-danger">This UPS was completely disposed under the whole package.</p>
                {% endif %}

                            
                {% if not has_active_ups and has_active_desktop %}
                <p class="text-danger">No available UPS for this desktop package. You can still add a monitor under this packge.</p>
                {% endif %}

      
            <!-- Disposed UPS Table -->
            {% if disposed_ups.exists %}
            <hr>
            <h5>Disposed UPS History</h5>
            <table class="table table-head-bg-danger table-bordered table-hover">
              <thead>
                <tr>
                  <th>Serial Number</th>
                  <th>Brand</th>
                  <th>Model</th>
                  <th>Disposal Date</th>
                </tr>
              </thead>
              <tbody>
                {% for disposed_upsx in disposed_ups %}
                <tr>
                  <td>{{ disposed_upsx.ups_db.ups_sn_db }}</td>
                  <td>{{ disposed_upsx.ups_db.ups_brand_db }}</td>
                  <td>{{ disposed_upsx.ups_db.ups_model_db }}</td>
                  <td>{{ disposed_upsx.disposal_date }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            
            {% endif %}
          </div>
        </div>
      
        <!-- Add UPS Modal -->
        <div class="modal fade" id="addUpsModal" tabindex="-1" aria-labelledby="addUpsModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="addUpsModalLabel">Add New UPS</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              {% if desktop_package and desktop_package.id %}
              <form method="POST" action="{% url 'add_ups_to_package' desktop_package.id %}">
                {% csrf_token %}
                <div class="modal-body">
                  <div class="mb-3">
                    <label for="mouse_sn" class="form-label">Serial Number</label>
                    <input type="text" class="form-control" id="ups_sn" name="ups_sn" required>
                  </div>



                  <div class="mb-3">
                    <label for="ups_brand" class="form-label">Brand</label>
                    <select class="form-select form-control" id="editBrand" name="ups_brand_form" required>
                      <option value="" disabled selected>Select Brand</option>
                      {% for brandUps in ups_brands %}
                        <option value="{{ brandUps.id }}">{{ brandUps.name }}</option>
                      {% endfor %}
                    </select>
                  </div>

                  <div class="mb-3">
                    <label for="mouse_model" class="form-label">Model</label>
                    <input type="text" class="form-control" id="ups_model" name="ups_model" required>
                  </div>
                  <div class="mb-3">
                    <label for="mouse_capacity" class="form-label">Capacity</label>
                    <input type="text" class="form-control" id="ups_capacity" name="ups_capacity" required>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary">Add UPS</button>
                </div>
              </form>
              {% else %}
               <div class="alert alert-warning">
                    UPS form cannot be displayed  desktop package is not set.
                  </div>
                {% endif %}
            </div>  
          </div>
        </div>
      </div>

<!-- Dispose Modal  for desktop, I put it in here so that tanan pills maka click sa button -->
  
 <div class="modal fade" id="disposeModal" tabindex="-1" aria-labelledby="disposeModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    {% if desktop_detailsx and desktop_detailsx.id %}
    <form method="POST" action="{% url 'dispose_desktop' desktop_detailsx.id %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Dispose Desktop Package: {{ desktop_detailsx.computer_name }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="reason" class="form-label">Reason for disposal</label>
            <textarea name="reason" class="form-control" required></textarea>
          </div>
          <p class="text-warning">
            Please <strong>do not dispose of peripherals</strong> such as keyboards, monitors, and other devices if they are still functioning. Keeping equipment that works helps to reduce waste and saves costs!
          </p>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="monitor" id="monitor">
            <label class="form-check-label" for="monitor">Dispose Monitor(s)</label> 
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="keyboard" id="keyboard">
            <label class="form-check-label" for="keyboard">Dispose Keyboard (s)</label> 
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="mouse" id="mouse">
            <label class="form-check-label" for="mouse">Dispose Mouse (s)</label> 
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="ups" id="ups">
            <label class="form-check-label" for="ups">Dispose UPS (s)</label>
          </div>
          
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Dispose</button>
        </div>
      </div>
    </form>
    {% else %}
  <div class="alert alert-warning">
    Cannot dispose: Desktop details are missing.
  </div>
{% endif %}
  </div>
</div>


<!-- User Details Tab -->
<div class="tab-pane fade" id="pills-user" role="tabpanel" aria-labelledby="pills-user-tab">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div class="card-title">User Details</div>
    </div>
    
    <div class="card-body">
      {% if user_details %}
        <!-- User Details Table -->
        <table class="table table-head-bg-success table-bordered table-hover">
          <thead>
            <tr>
              <th>ATTRIBUTES</th>
              <th>DETAILS</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Package Number:</strong></td>
              <td>{{ user_details.desktop_package_db }}</td>
            </tr>
            <tr>
              <td><strong>Asset Owner:</strong></td>
              <td>{{ user_details.user_Assetowner.employee_fname }} {{ user_details.user_Assetowner.employee_lname }} </td>
            </tr>
            <tr>
              <td><strong>Asset Owner Designation</strong></td>
              <td>{{ user_details.user_Assetowner.employee_position }}</td>
            </tr>
            <tr>
              <td><strong>Asset Owner Office:</strong></td>
              <td>{{ user_details.user_Assetowner.employee_office_section }}</td>
            </tr>
            <tr>
              <td><strong>End User:</strong></td>
              <td>{{ user_details.user_Enduser.employee_fname }}</td>
            </tr>
            <tr>
              <td><strong>End User Designation:</strong></td>
              <td>{{ user_details.user_Enduser.employee_position }}</td>
            </tr>
            <tr>
              <td><strong>End User Office:</strong></td>
              <td>{{ user_details.user_Enduser.employee_office_section }}</td>
            </tr>
          </tbody>
        </table>
        <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editEndUserModal">Edit User</a>
        <a href="#" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#editAssetOwnerModal">Transfer Ownership</a>

      {% else %}
        <p class="text-danger">No available user for this desktop package.</p>
      {% endif %}
    </div>

    <!-- Edit EndUser Modal -->
    <div class="modal fade" id="editEndUserModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit End User</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form id="editEndUserForm">
            <div class="modal-body">
              {% csrf_token %}
              <div class="mb-3">
                <label class="form-label">Select End User</label>
                <select class="form-select" name="enduser_input" required>
                  <option value="">Select End User</option>
                  {% for employee in employees %}
                    <option value="{{ employee.id }}">{{ employee.employee_fname }} {{ employee.employee_lname }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary" id="submitButton">
                <span class="button-text">Save Changes</span>
                <span class="spinner-border spinner-border-sm d-none" aria-hidden="true"></span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Edit AssetOwner Modal -->
    <div class="modal fade" id="editAssetOwnerModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Transfer Ownership</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form id="editAssetOwnerForm">
            <div class="modal-body">
              {% csrf_token %}
              <div class="mb-3">
                <label class="form-label">Select Asset Owner</label>
                <select class="form-select" name="assetowner_input" required>
                  <option value="">Select Asset Owner</option>
                  {% for employee in employees %}
                    <option value="{{ employee.id }}">{{ employee.employee_fname }} {{ employee.employee_lname }}</option>
                  {% endfor %}
                </select>
              </div>    
            </div>    
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary" id="submitButton">
                <span class="button-text">Save Changes</span>
                <span class="spinner-border spinner-border-sm d-none" aria-hidden="true"></span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    {% comment %} Table to show the change history of asset owner {% endcomment %}

{% comment %} Table to show the change history of ender user {% endcomment %}
    <hr>
    <div class="card-body">
      <div class="table-responsive">
        {% comment %} the end user change history view {% endcomment %}
        <h3>End User Change History</h3>
        <p>Below is the history of changes made to the End User for this desktop package.</p>

        <table class="table table-head-bg-danger table-bordered table-hover">
            <thead>
                <tr>
                    <th>Old End User</th>
                    <th>New End User</th>
                    <th>Changed By</th>
                    <th>Changed At</th>
                </tr>
            </thead>
            <tbody>
                {% for record in enduser_history %}
                <tr>
                    <td>{{ record.old_enduser.employee_fname }} {{ record.old_enduser.employee_lname }}</td>
                    <td>{{ record.new_enduser.employee_fname }} {{ record.new_enduser.employee_lname }}</td>
                    <td>{{ record.changed_by.username }}</td>
                    <td>{{ record.changed_at }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">No history available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>  
      </div>
    </div>
{% comment %} Table to show the change history of asset owner {% endcomment %}
    <hr>
    <div class="card-body">
      <div class="table-responsive">
       
        <h3>Asset Owner Transfer History</h3>
        <p>Below is the transfer history of Assetowner for this desktop package.</p>

        <table class="table table-head-bg-danger table-bordered table-hover">
            <thead>
                <tr>
                    <th>Old Asset Owner</th>
                    <th>New Asset Owner</th>
                    <th>Changed By</th>
                    <th>Changed At</th>
                </tr>
            </thead>
            <tbody>
                {% for record in assetowner_history %}
                <tr>
                    <td>{{ record.old_assetowner.employee_fname }} {{ record.old_assetowner.employee_lname }}</td>
                    <td>{{ record.new_assetowner.employee_fname }} {{ record.new_assetowner.employee_lname }}</td>
                    <td>{{ record.changed_by.username }}</td>
                    <td>{{ record.changed_at }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">No history available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>  
      </div>
    </div>
  </div>
</div>
 
<!-- Documents Tab -->
<div class="tab-pane fade" id="pills-documents" role="tabpanel" aria-labelledby="pills-documents-tab">
  <div class="card">
    <div class="card-header">
      <div class="card-title">Documents Details</div>
    </div>
    <div class="card-body">
      <table class="table table-head-bg-success table-bordered table-hover">
        <thead>
          <tr>
            <th scope="col-md-4 ms-auto me-auto">ATTRIBUTES</th>
            <th scope="col">DETAILS</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="col-sm-6 col-md-3"><strong>Package Number:</strong></td>
            <td>{{ documents_detailse.desktop_package }}</td>
          </tr>
          <tr>
            <td class="col-sm-6 col-md-3"><strong>Document PAR Number</strong></td>
            <td>{{ documents_detailse.docs_PAR }}</td>
          </tr>
          <tr>
            <td class="col-sm-6 col-md-3"><strong>Property Number</strong></td>
            <td>{{ documents_detailse.docs_Propertyno }}</td>
          </tr>
          <tr>
            <td class="col-sm-6 col-md-3"><strong>Acuistion Type</strong></td>
            <td>{{ documents_detailse.docs_Acquisition_Type }}</td>
          </tr>          
          <tr>
            <td class="col-sm-6 col-md-3"><strong>Package Value</strong></td>
            <td>{{ documents_detailse.docs_Value }}</td>
          </tr>
          <tr>
            <td class="col-sm-6 col-md-3"><strong>Date Received</strong></td>
            <td>{{ documents_detailse.docs_Datereceived }}</td>
          </tr>
          <tr>
            <td class="col-sm-6 col-md-3"><strong>Date Inspected</strong></td>
            <td>{{ documents_detailse.docs_Dateinspected }}</td>
          </tr>
          <tr>
            <td class="col-sm-6 col-md-3"><strong>Supplier</strong></td>
            <td>{{ documents_detailse.docs_Supplier }}</td>
          </tr>
           <tr>
            <td class="col-sm-6 col-md-3"><strong>Status</strong></td>
            <td>{{ documents_detailse.docs_Status }}</td>
          </tr>       
        </tbody>
      </table>
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editDocumentsdModal">Edit</button>

    

    </div>
  </div>
  

    </div>
  </div>
</div>

{% comment %} update documents modal {% endcomment %}
<div class="modal fade" id="editDocumentsdModal" tabindex="-1" aria-labelledby="editDocumentsdModal" aria-hidden="true">
  <div class="modal-dialog">
    {% if documents_detailse and documents_detailse.id %}
    <form method="POST" action="{% url 'update_documents' pk=documents_detailse.id %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editDocumentdModal">Edit Documents Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="documentsId">
          
          <div class="mb-3">
            <label for="editSN" class="form-label">Document PAR Number</label>
            <input type="text" class="form-control" id="editSN" name="docs_PAR" required value="{{ documents_detailse.docs_PAR }}" required>
          </div>
          <div class="mb-3">
            <label for="editBrand" class="form-label">Property Number</label>
            <input type="text" class="form-control" id="editBrand" name="docs_Propertyno" value="{{ documents_detailse.docs_Propertyno }}" required>
          </div>
          <div class="mb-3">
            <label for="editModel" class="form-label">Acuisition Type</label>
            <input type="text" class="form-control" id="editModel" name="docs_Acquisition_Type" value="{{ documents_detailse.docs_Acquisition_Type }}" required>
          </div>
          <div class="mb-3">
            <label for="editModel" class="form-label">Package Value</label>
            <input type="text" class="form-control" id="editModel" name="docs_Value" value="{{ documents_detailse.docs_Value }}" required>
          </div>
          <div class="mb-3">
            <label for="editModel" class="form-label">Date Received</label>
            <input type="text" class="form-control" id="editModel" name="docs_Datereceived" value="{{ documents_detailse.docs_Datereceived }}" required>
          </div>
         <div class="mb-3">
            <label for="editModel" class="form-label">Date Inspected</label>
            <input type="text" class="form-control" id="editModel" name="docs_Dateinspected" value="{{ documents_detailse.docs_Dateinspected }}" required>
          </div>
        <div class="mb-3">
            <label for="editModel" class="form-label">Supplier</label>
            <input type="text" class="form-control" id="editModel" name="docs_Supplier" value="{{ documents_detailse.docs_Supplier }}" required>
          </div>
        <div class="mb-3">
            <label for="editModel" class="form-label">Status</label>
            <input type="text" class="form-control" id="editModel" name="docs_Status" value="{{ documents_detailse.docs_Status }}" required>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Update Document Details</button>
        </div>
      </div>
    </form>
    {% else %}
  <div class="alert alert-warning">
    Cannot update: document details not available.
  </div>
  {% endif %}
  </div>
</div>    



<!-- Optional JavaScript -->
<script>
  // Initialize the Bootstrap pill tabs
  var triggerTabList = [].slice.call(document.querySelectorAll('#pills-tab-with-icon a'))
  triggerTabList.forEach(function (triggerEl) {
    var tabTrigger = new pbootstrap.Tab(triggerEl)
    triggerEl.addEventListener('click', function (event) {
      event.preventDefault()
      tabTrigger.show()
    })
  })
</script>
<!-- JavaScript for pill hash -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Check if there is a hash in the URL
    const hash = window.location.hash;
    if (hash) {
      // Find the tab link with matching href and activate it
      const targetTabLink = document.querySelector(`a[href="${hash}"]`);
      if (targetTabLink) {
        const tab = new bootstrap.Tab(targetTabLink);
        tab.show();
      }
    }
  });
</script>

<!-- Bootstrap Toast for success message -->
<div class="toast-container position-fixed top-0 end-0 p-3">
  <div id="updateSuccessToast_End_User" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
         End User updated successfully!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<div class="toast-container position-fixed top-0 end-0 p-3">
  <div id="updateSuccessToast_Asset_Owner" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
         Asset Owner updated successfully!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {
    // Track if form is being submitted
    let isSubmitting = false;
    
    $("#editEndUserForm").submit(function(event) {
        event.preventDefault();
        
        if (isSubmitting) return false;
        isSubmitting = true;
        
        let desktopId = "{{ desktop_package.id }}";
        let formData = $(this).serialize();

        // Show loading state
        let submitBtn = $(this).find('button[type="submit"]');
        submitBtn.prop('disabled', true).html(
            '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...'
        );

        $.ajax({
            type: "POST",
            url: "/updateeee_end_user/" + desktopId + "/",
            data: formData,
            success: function(response) {
                if (response.success) {
                    // Hide modal immediately
                    var modal = bootstrap.Modal.getInstance(document.getElementById('editEndUserModal'));
                    modal.hide();
                    
                    // Show success toast
                    var toast = new bootstrap.Toast(document.getElementById('updateSuccessToast_End_User'));
                    toast.show();
                    
                    // Full page reload after 1 second
                    setTimeout(function() {
                        window.location.href = window.location.href.split('#')[0] + '#pills-user';
                        window.location.reload();
                    }, 1000);
                } else {
                    showError(response.error || "Failed to update End User");
                }
            },
            error: function(xhr) {
                showError(xhr.responseJSON?.error || "Something went wrong");
            },
            complete: function() {
                isSubmitting = false;
                submitBtn.prop('disabled', false).html('Save Changes');
            }
        });
    });

    // Reset form when modal is closed
    $('#editEndUserModal').on('hidden.bs.modal', function() {
        $(this).find('form')[0].reset();
    });
});

function showError(message) {
    Swal.fire({
        icon: "error",
        title: "Error",
        text: message,
    });
}
</script>


<script>
  $(document).ready(function() {
    // Track if form is being submitted
    let isSubmitting = false;
    
    $("#editAssetOwnerForm").submit(function(event) {
        event.preventDefault();
        
        if (isSubmitting) return false;
        isSubmitting = true;
        
        let desktopId = "{{ desktop_package.id }}";
        let formData = $(this).serialize();

        // Show loading state
        let submitBtn = $(this).find('button[type="submit"]');
        submitBtn.prop('disabled', true).html(
            '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...'
        );

        $.ajax({
            type: "POST",
            url: "/updateeee_asset_owner/" + desktopId + "/",
            data: formData,
            success: function(response) {
                if (response.success) {
                    // Hide modal immediately
                    var modal = bootstrap.Modal.getInstance(document.getElementById('editAssetOwnerModal'));
                    modal.hide();
                    
                    // Show success toast
                    var toast = new bootstrap.Toast(document.getElementById('updateSuccessToast_Asset_Owner'));
                    toast.show();
                    
                    // Full page reload after 1 second
                    setTimeout(function() {
                        window.location.href = window.location.href.split('#')[0] + '#pills-user';
                        window.location.reload();
                    }, 1000);
                } else {
                    showError(response.error || "Failed to update Asset Owner");
                }
            },
            error: function(xhr) {
                showError(xhr.responseJSON?.error || "Something went wrong");
            },
            complete: function() {
                isSubmitting = false;
                submitBtn.prop('disabled', false).html('Save Changes');
            }
        });
    });

    // Reset form when modal is closed
    $('#editAssetOwnerModal').on('hidden.bs.modal', function() {
        $(this).find('form')[0].reset();
    });
});

function showError(message) {
    Swal.fire({
        icon: "error",
        title: "Error",
        text: message,
    });
}
</script>



<script>
  $(document).ready(function () {
    $("#editEndUserForm").submit(function (event) {
        event.preventDefault();
        
        let desktopId = "{{ desktop_package.id }}";
        let formData = $(this).serialize();

        $.ajax({
            type: "POST",
            url: "/updateeee_end_user/" + desktopId + "/",
            data: formData,
            success: function (response) {
                if (response.success) {
                    // Close the modal first
                    $('#editEndUserModal').modal('hide');
                    
                    // Show success toast
                    let toast = new bootstrap.Toast(document.getElementById('updateSuccessToast_End_User'));
                    toast.show();
                    
                    // Redirect after a short delay to allow modal to close
                    setTimeout(function() {
                        window.location.href = `/desktop_details_view/${desktopId}/#pills-user`;
                    }, 500); // 500ms delay
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Error",
                        text: response.error || "Failed to update End User",
                    });
                }
            },
            error: function(xhr, status, error) {
                Swal.fire({
                    icon: "error",
                    title: "Error",
                    text: "Something went wrong while updating the End User.",
                });
            }
        });
    });
});
</script>

<script>
  $(document).ready(function () {
    $("#editAssetOwnerForm").submit(function (event) {
        event.preventDefault();
        
        let desktopId = "{{ desktop_package.id }}";
        let formData = $(this).serialize();

        $.ajax({
            type: "POST",
            url: "/updateeee_asset_owner/" + desktopId + "/",
            data: formData,
            success: function (response) {
                if (response.success) {
                    // Close the modal first
                    $('#editAssetOwnerModal').modal('hide');
                    
                    // Show success toast
                    let toast = new bootstrap.Toast(document.getElementById('updateSuccessToast_Asset_Owner'));
                    toast.show();
                    
                    // Redirect after a short delay to allow modal to close
                    setTimeout(function() {
                        window.location.href = `/desktop_details_view/${desktopId}/#pills-user`;
                    }, 500); // 500ms delay
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Error",
                        text: response.error || "Failed to update Asset Owner",
                    });
                }
            },
            error: function(xhr, status, error) {
                Swal.fire({
                    icon: "error",
                    title: "Error",
                    text: "Something went wrong while updating the Asset Owner.",
                });
            }
        });
    });
});
</script> 

{% endblock %}
