{% extends 'base.html' %}
{% block content %}
<div class="container">
  <div class="page-inner">
    <div class="row">
      <!-- Left Column -->
      <div class="col-md-8">
        <div class="card card-round">
          <div class="card-header">
            <div class="card-title"><h3>{{ desktop_detailsx.computer_name }}</h3></div>
            <div class="card-tools">
              <button class="btn btn-label-danger btn-round btn-sm me-2" data-bs-toggle="modal" data-bs-target="#disposeModal">
                <span class="btn-label"><i class="fa fa-location-arrow"></i></span> Return to Supply
              </button>
              <a href="#" class="btn btn-label-success btn-round btn-sm me-2">
                <span class="btn-label"><i class="fa fa-pencil"></i></span> Export
              </a>
              <a href="#" class="btn btn-label-info btn-round btn-sm">
                <span class="btn-label"><i class="fa fa-print"></i></span> Print
              </a>
            </div>
          </div> 
          <div class="card-body">
            <!-- Pills Navigation -->
            <ul class="nav nav-pills nav-secondary nav-pills-no-bd nav-pills-icons justify-content-center" id="pills-tab-with-icon" role="tablist">
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link active" id="pills-desktop-tab" data-bs-toggle="pill" href="#pills-desktop" role="tab" aria-controls="pills-desktop" aria-selected="true">
                  <i class="fas fa-power-off"></i> Desktop Details
                </a>
              </li>
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link" id="pills-monitor-tab" data-bs-toggle="pill" href="#pills-monitor" role="tab" aria-controls="pills-monitor" aria-selected="false">
                  <i class="fas fa-tv"></i> Monitor Details
                </a>
              </li>
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link" id="pills-keyboard-tab" data-bs-toggle="pill" href="#pills-keyboard" role="tab" aria-controls="pills-keyboard" aria-selected="false">
                  <i class="fas fa-keyboard"></i> Keyboard Details
                </a>
              </li>
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link" id="pills-mouse-tab" data-bs-toggle="pill" href="#pills-mouse" role="tab" aria-controls="pills-mouse" aria-selected="false">
                  <i class="fas fa-mouse-pointer"></i> Mouse Details
                </a>
              </li>
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link" id="pills-ups-tab" data-bs-toggle="pill" href="#pills-ups" role="tab" aria-controls="pills-ups" aria-selected="false">
                  <i class="fas fa-battery-full"></i> UPS Details
                </a>
              </li>
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link" id="pills-user-tab" data-bs-toggle="pill" href="#pills-user" role="tab" aria-controls="pills-user" aria-selected="false">
                  <i class="fas fa-user"></i> User Details
                </a>
              </li>
              <li class="nav-item submenu" role="presentation">
                <a class="nav-link" id="pills-documents-tab" data-bs-toggle="pill" href="#pills-documents" role="tab" aria-controls="pills-documents" aria-selected="false">
                  <i class="fas fa-file-alt"></i> Documents
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Right Column for PM green -->
      <div class="col-md-4">
        <div class="card card-success bg-success2">
          <div class="card-body pb-0">
            <div class="h1 fw-bold float-end">+7%</div>
            <h2 class="mb-2">{{ desktop_detailsx.computer_name }}</h2>
            <p>Transactions</p>
            <div class="pull-in sparkline-fix chart-as-background">
              <div id="lineChart6"><canvas width="507" height="70" style="display: inline-block; width: 507.984px; height: 70px; vertical-align: top;"></canvas></div>
            </div>
          </div>
        </div>
      </div>
    </div>
 


    <!-- Tab Content -->
    <div class="tab-content mt-2 mb-3" id="pills-tabContent">
      <!-- Desktop Details Tab -->
      <div class="tab-pane fade show active" id="pills-desktop" role="tabpanel" aria-labelledby="pills-desktop-tab">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Desktop Details</div>
          </div>
          <div class="card-body">
            <table class="table table-head-bg-success table-bordered table-hover">
              <thead>
                <tr>
                  <th scope="col-md-4 ms-auto me-auto">ATTRIBUTES</th>
                  <th scope="col">DETAILS</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Package Number:</strong></td>
                  <td>{{ desktop_detailsx.desktop_package }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Serial Number:</strong></td>
                  <td>{{ desktop_detailsx.serial_no }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Brand Name:</strong></td>
                  <td>{{ desktop_detailsx.brand_name }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Model:</strong></td>
                  <td>{{ desktop_detailsx.model }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Processor:</strong></td>
                  <td>{{ desktop_detailsx.processor }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Memory:</strong></td>
                  <td>{{ desktop_detailsx.memory }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Drive:</strong></td>
                  <td>{{ desktop_detailsx.drive }}</td>
                </tr>
              </tbody>
            </table>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editDesktopModal">Edit</button>
            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#disposeModal">Dispose</button>

            <!-- Dispose Modal -->
<!-- Dispose Modal -->
<!-- Dispose Modal -->
<div class="modal fade" id="disposeModal" tabindex="-1" aria-labelledby="disposeModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" action="{% url 'dispose_desktop' desktop_detailsx.id %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Dispose Desktop</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="reason" class="form-label">Reason for disposal</label>
            <textarea name="reason" class="form-control" required></textarea>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="monitor" id="monitor">
            <label class="form-check-label" for="monitor">Dispose Monitor(s)</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Dispose</button>
        </div>
      </div>
    </form>
  </div>
</div>



          </div>
        </div>
      </div>




      {% comment %} <!-- Monitor Details Tab --> {% endcomment %}
      <div class="tab-pane fade" id="pills-monitor" role="tabpanel" aria-labelledby="pills-monitor-tab">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div class="card-title">Monitor Details</div>
            {% if not has_active_monitor %}
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMonitorModal">Add Monitor</button>
            {% endif %}
          </div>
          <div class="card-body">
            {% if monitor_detailse %}
            <table class="table table-head-bg-success table-bordered table-hover">
              <thead>
                <tr>
                  <th scope="col-md-4 ms-auto me-auto">ATTRIBUTES</th>
                  <th scope="col">DETAILS</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Package Number:</strong></td>
                  <td>{{ monitor_detailse.desktop_package_db }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Serial Number:</strong></td>
                  <td>{{ monitor_detailse.monitor_sn_db }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Brand Name:</strong></td>
                  <td>{{ monitor_detailse.monitor_brand_db }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Model:</strong></td>
                  <td>{{ monitor_detailse.monitor_model_db }}</td>
                </tr>
                <tr>
                  <td class="col-sm-6 col-md-3"><strong>Monitor Size:</strong></td>
                  <td>{{ monitor_detailse.monitor_size_db }}</td>
                </tr>
              </tbody>
            </table>

        
            <button 
            class="btn btn-primary edit-monitor-btn" 
            data-bs-toggle="modal" 
            data-bs-target="#editMonitorModal"
            data-id="{{ monitor_detailse.id }}"
            data-package="{{ monitor_detailse.desktop_package_db.id }}"
            data-sn="{{ monitor_detailse.monitor_sn_db }}"
            data-brand="{{ monitor_detailse.monitor_brand_db }}"
            data-model="{{ monitor_detailse.monitor_model_db }}"
            data-size="{{ monitor_detailse.monitor_size_db }}"
          >
            Edittt
          </button>
          
        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDisposeModal_Monitor">Dispose Monitor</button>

            <!-- Update Monitor Modal -->

        <div class="modal fade" id="editMonitorModal" tabindex="-1" aria-labelledby="editMonitorModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <form method="POST" action="{% url 'update_monitor' pk=monitor_detailse.id %}">
              {% csrf_token %}
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="editMonitorModalLabel">Edit Monitor</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <input type="hidden" id="monitorId">
        
                  
                  <div class="mb-3">
                    <label for="editSN" class="form-label">Serial Number</label>
                    <input type="text" class="form-control" id="editSN" name="monitor_sn_db" required>
                  </div>
                  <div class="mb-3">
                    <label for="editBrand" class="form-label">Brand</label>
                    <input type="text" class="form-control" id="editBrand" name="monitor_brand_db" required>
                  </div>
                  <div class="mb-3">
                    <label for="editModel" class="form-label">Model</label>
                    <input type="text" class="form-control" id="editModel" name="monitor_model_db">
                  </div>
                  <div class="mb-3">
                    <label for="editSize" class="form-label">Monitor Size</label>
                    <input type="text" class="form-control" id="editSize" name="monitor_size_db">
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-primary">Update Monitor</button>
                </div>
              </div>
            </form>
          </div>
        </div>





                <!-- Disposal Confirmation Modal -->
                <div class="modal fade" id="confirmDisposeModal_Monitor" tabindex="-1" aria-labelledby="confirmDisposeModal_Monitor" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="confirmDisposeModal_Monitor">Confirm Disposal</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        Are you sure you want to dispose of this Monitor?
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <!-- Disposal form inside modal -->
                        <form method="POST" action="{% url 'monitor_disposed' monitor_detailse.id %}" class="dispose-monitor-form d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger">Confirm Dispose</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
                {% else %}
                <p class="text-danger">No available Monitors for this desktop package.</p>
                 {% endif %}

                 <!-- Disposed Monitor Table -->
      {% if disposed_monitor.exists %}
      <hr>
      <h5>Disposed Monitors</h5>
      <table class="table table-head-bg-danger table-bordered table-hover">
        <thead>
          <tr>
            <th>Serial Number</th>
            <th>Brand</th>
            <th>Model</th>
            <th>Disposal Date</th>
          </tr>
        </thead>
        <tbody>
          {% for disposed_monitor in disposed_monitor %}
          <tr>
            <td>{{ disposed_monitor.monitor_disposed_db.monitor_sn_db }}</td>
            <td>{{ disposed_monitor.monitor_disposed_db.monitor_brand_db }}</td>
            <td>{{ disposed_monitor.monitor_disposed_db.monitor_model_db }}</td>
            <td>{{ disposed_monitor.disposal_date }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
        <p>No disposed Monitor for this desktop package.</p>
      {% endif %}

          </div>
        </div>

         <!-- Add Monitor Modal -->
  <div class="modal fade" id="addMonitorModal" tabindex="-1" aria-labelledby="addMonitorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addMonitorModalLabel">Add New Monitor</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" action="{% url 'add_monitor_to_package' desktop_package.id %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="mb-3">
              <label for="monitor_sn" class="form-label">Serial Number</label>
              <input type="text" class="form-control" id="monitor_sn" name="monitor_sn" required>
            </div>
            <div class="mb-3">
              <label for="monitor_brand" class="form-label">Brand</label>
              <input type="text" class="form-control" id="monitor_brand" name="monitor_brand" required>
            </div>
            <div class="mb-3">
              <label for="monitor_model" class="form-label">Model</label>
              <input type="text" class="form-control" id="monitor_model" name="monitor_model" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Monitor</button>
          </div>
        </form>
      </div>
    </div>
  </div>
      </div>

      
<!-- Keyboard Details Tab ORGIGNAL -->
<div class="tab-pane fade" id="pills-keyboard" role="tabpanel" aria-labelledby="pills-keyboard-tab">
  <div class="card">
    <!-- Card Header with Flexbox to Align Title and Button -->
    <div class="card-header d-flex justify-content-between align-items-center">
      <div class="card-title">Keyboard Details</div>
      
      <!-- Conditionally show Add Keyboard Button only if no active keyboards are present -->
      {% if not has_active_keyboards %}
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addKeyboardModal">Add Keyboard</button>
      {% endif %}
    </div>
    
    <div class="card-body">
      {% if keyboard_detailse %}
        <!-- Keyboard Details Table -->
        <table class="table table-head-bg-success table-bordered table-hover">
          <thead>
            <tr>
              <th scope="col-md-4 ms-auto me-auto">ATTRIBUTES</th>
              <th scope="col">DETAILS</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Package Number:</strong></td>
              <td>{{ keyboard_detailse.desktop_package }}</td>
            </tr>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Serial Number:</strong></td>
              <td>{{ keyboard_detailse.keyboard_sn_db }}</td>
            </tr>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Brand Name:</strong></td>
              <td>{{ keyboard_detailse.keyboard_brand_db }}</td>
            </tr>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Model:</strong></td>
              <td>{{ keyboard_detailse.keyboard_model_db }}</td>
            </tr>
          </tbody>
        </table>

        <!-- Edit and Dispose Buttons for active keyboard -->
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editKeyboardModal">Edit</button>
        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDisposeModal">Dispose Keyboard</button>

        <!-- Disposal Confirmation Modal -->
        <div class="modal fade" id="confirmDisposeModal" tabindex="-1" aria-labelledby="confirmDisposeModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="confirmDisposeModalLabel">Confirm Disposal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                Are you sure you want to dispose of this keyboard?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <!-- Disposal form inside modal -->
                <form method="POST" action="{% url 'keyboard_disposed' keyboard_detailse.id %}" class="dispose-keyboard-form d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Confirm Dispose</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      {% else %}
        <p class="text-danger">No available keyboards for this desktop package.</p>
      {% endif %}

      <!-- Disposed Keyboards Table -->
      {% if disposed_keyboards.exists %}
      <hr>
      <h5>Disposed Keyboards</h5>
      <table class="table table-head-bg-danger table-bordered table-hover">
        <thead>
          <tr>
            <th>Serial Number</th>
            <th>Brand</th>
            <th>Model</th>
            <th>Disposal Date</th>
          </tr>
        </thead>
        <tbody>
          {% for disposed_keyboard in disposed_keyboards %}
          <tr>
            <td>{{ disposed_keyboard.keyboard_dispose_db.keyboard_sn_db}}</td>
            <td>{{ disposed_keyboard.keyboard_dispose_db.keyboard_brand_db }}</td>
            <td>{{ disposed_keyboard.keyboard_dispose_db.keyboard_model_db }}</td>
            <td>{{ disposed_keyboard.disposal_date }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
        <p>No disposed keyboards for this desktop package.</p>
      {% endif %}
    </div>
  </div>

  <!-- Add Keyboard Modal -->
  <div class="modal fade" id="addKeyboardModal" tabindex="-1" aria-labelledby="addKeyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addKeyboardModalLabel">Add New Keyboard</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" action="{% url 'add_keyboard_to_package' desktop_package.id %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="mb-3">
              <label for="keyboard_sn" class="form-label">Serial Number</label>
              <input type="text" class="form-control" id="keyboard_sn" name="keyboard_sn" required>
            </div>
            <div class="mb-3">
              <label for="keyboard_brand" class="form-label">Brand</label>
              <input type="text" class="form-control" id="keyboard_brand" name="keyboard_brand" required>
            </div>
            <div class="mb-3">
              <label for="keyboard_model" class="form-label">Model</label>
              <input type="text" class="form-control" id="keyboard_model" name="keyboard_model" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Keyboard</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<!-- Keyboard Details Tab END -->

      <!-- Mouse Details Tab -->
      <!-- Mouse Details Tab -->
<div class="tab-pane fade" id="pills-mouse" role="tabpanel" aria-labelledby="pills-mouse-tab">
  <div class="card">
    <!-- Card Header with Flexbox to Align Title and Button -->
    <div class="card-header d-flex justify-content-between align-items-center">
      <div class="card-title">Mouse Details</div>
      
      <!-- Conditionally show Add Mouse Button only if no active mice are present -->
      {% if not has_active_mouse %}
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMouseModal">Add Mouse</button>
      {% endif %}
    </div>
    
    <div class="card-body">
      {% if mouse_detailse %}
        <!-- Mouse Details Table -->
        <table class="table table-head-bg-success table-bordered table-hover">
          <thead>
            <tr>
              <th scope="col-md-4 ms-auto me-auto">ATTRIBUTES</th>
              <th scope="col">DETAILS</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Package Number:</strong></td>
              <td>{{ mouse_detailse.desktop_package}}</td>
            </tr>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Serial Number:</strong></td>
              <td>{{ mouse_detailse.mouse_sn_db  }}</td>
            </tr>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Brand Name:</strong></td>
              <td>{{ mouse_detailse.mouse_brand_db }}</td>
            </tr>
            <tr>
              <td class="col-sm-6 col-md-3"><strong>Model:</strong></td>
              <td>{{ mouse_detailse.mouse_model_db }}</td>
            </tr>
          </tbody>
        </table>

        <!-- Edit and Dispose Buttons for active mouse -->
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editMouseModal">Edit</button>
        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDisposeMouseModal">Dispose Mouse</button>

        <!-- Disposal Confirmation Modal -->
        <div class="modal fade" id="confirmDisposeMouseModal" tabindex="-1" aria-labelledby="confirmDisposeMouseModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="confirmDisposeMouseModalLabel">Confirm Disposal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                Are you sure you want to dispose of this mouse?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <!-- Disposal form inside modal -->
                <form method="POST" action="{% url 'mouse_disposed' mouse_detailse.id %}" class="dispose-mouse-form d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Confirm Dispose</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      {% else %}
        <p class="text-danger">No available mice for this desktop package.</p>
      {% endif %}

      <!-- Disposed Mice Table -->
      {% if disposed_mouse.exists %}
      <hr>
      <h5>Disposed Mice</h5>
      <table class="table table-head-bg-danger table-bordered table-hover">
        <thead>
          <tr>
            <th>Serial Number</th>
            <th>Brand</th>
            <th>Model</th>
            <th>Disposal Date</th>
          </tr>
        </thead>
        <tbody>
          {% for disposed_mousx in disposed_mouse %}
          <tr>
            <td>{{ disposed_mousx.mouse_db.mouse_sn_db }}</td>
            <td>{{ disposed_mousx.mouse_db.mouse_brand_db }}</td>
            <td>{{ disposed_mousx.mouse_db.mouse_model_db }}</td>
            <td>{{ disposed_mousx.disposal_date }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      
      <h5 class="text-success">
        <br>
        No disposed mice for this desktop package.
      </h5>
      {% endif %}
    </div>
  </div>

  <!-- Add Mouse Modal -->
  <div class="modal fade" id="addMouseModal" tabindex="-1" aria-labelledby="addMouseModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addMouseModalLabel">Add New Mouse</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" action="{% url 'add_mouse_to_package' desktop_package.id %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="mb-3">
              <label for="mouse_sn" class="form-label">Serial Number</label>
              <input type="text" class="form-control" id="mouse_sn" name="mouse_sn" required>
            </div>
            <div class="mb-3">
              <label for="mouse_brand" class="form-label">Brand</label>
              <input type="text" class="form-control" id="mouse_brand" name="mouse_brand" required>
            </div>
            <div class="mb-3">
              <label for="mouse_model" class="form-label">Model</label>
              <input type="text" class="form-control" id="mouse_model" name="mouse_model" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Mouse</button>
          </div>
        </form>
      </div>  
    </div>
  </div>
</div>


      <!-- UPS Details Tab -->
      
      <div class="tab-pane fade" id="pills-ups" role="tabpanel" aria-labelledby="pills-ups-tab">
        <div class="card">
          <!-- Card Header with Flexbox to Align Title and Button -->
          <div class="card-header d-flex justify-content-between align-items-center">
            <div class="card-title">UPS Details</div>
            
            <!-- Conditionally show Add UPS Button only if no active mice are present -->
            {% if not has_active_ups %}
              <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUpsModal">Add UPS</button>
            {% endif %}
          </div>
          
          <div class="card-body">
            {% if ups_detailse %}
              <!-- UPS Details Table -->
              <table class="table table-head-bg-success table-bordered table-hover">
                <thead>
                  <tr>
                    <th scope="col-md-4 ms-auto me-auto">ATTRIBUTES</th>
                    <th scope="col">DETAILS</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="col-sm-6 col-md-3"><strong>Package Number:</strong></td>
                    <td>{{ ups_detailse.desktop_package}}</td>  
                  </tr>
                  <tr>
                    <td class="col-sm-6 col-md-3"><strong>Serial Number:</strong></td>
                    <td>{{ ups_detailse.ups_sn_db  }}</td>
                  </tr>
                  <tr>
                    <td class="col-sm-6 col-md-3"><strong>Brand Name:</strong></td>
                    <td>{{ ups_detailse.ups_brand_db }}</td>
                  </tr>
                  <tr>
                    <td class="col-sm-6 col-md-3"><strong>Model:</strong></td>
                    <td>{{ ups_detailse.ups_model_db }}</td>
                  </tr>
                </tbody>
              </table>
      
              <!-- Edit and Dispose Buttons for active ups -->
              <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editUpsModal">Edit</button>
              <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDisposeUpsModal">Dispose UPS</button>
      
              <!-- Disposal Confirmation Modal -->
              <div class="modal fade" id="confirmDisposeUpsModal" tabindex="-1" aria-labelledby="confirmDisposeUpsModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="confirmDisposeUpsModalLabel">Confirm Disposal</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      Are you sure you want to dispose of this UPS?
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                      <!-- Disposal form inside modal -->
                      <form method="POST" action="{% url 'ups_disposed' ups_detailse.id %}" class="dispose-ups-form d-inline">
                          {% csrf_token %}
                          <button type="submit" class="btn btn-danger">Confirm Dispose</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            {% else %}
              <p class="text-danger">No available mice for this desktop package.</p>
            {% endif %}
      
            <!-- Disposed UPS Table -->
            {% if disposed_ups.exists %}
            <hr>
            <h5>Disposed Mice</h5>
            <table class="table table-head-bg-danger table-bordered table-hover">
              <thead>
                <tr>
                  <th>Serial Number</th>
                  <th>Brand</th>
                  <th>Model</th>
                  <th>Disposal Date</th>
                </tr>
              </thead>
              <tbody>
                {% for disposed_upsx in disposed_ups %}
                <tr>
                  <td>{{ disposed_upsx.ups_db.ups_sn_db }}</td>
                  <td>{{ disposed_upsx.ups_db.brand_db }}</td>
                  <td>{{ disposed_upsx.ups_db.model_db }}</td>
                  <td>{{ disposed_upsx.disposal_date }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% else %}
            
            <h5 class="text-success">
              <br>
              No disposed mice for this desktop package.
            </h5>
            {% endif %}
          </div>
        </div>
      
        <!-- Add UPS Modal -->
        <div class="modal fade" id="addUpsModal" tabindex="-1" aria-labelledby="addUpsModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="addUpsModalLabel">Add New UPS</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <form method="POST" action="{% url 'add_ups_to_package' desktop_package.id %}">
                {% csrf_token %}
                <div class="modal-body">
                  <div class="mb-3">
                    <label for="mouse_sn" class="form-label">Serial Number</label>
                    <input type="text" class="form-control" id="ups_sn" name="ups_sn" required>
                  </div>
                  <div class="mb-3">
                    <label for="mouse_brand" class="form-label">Brand</label>
                    <input type="text" class="form-control" id="ups_brand" name="ups_brand" required>
                  </div>
                  <div class="mb-3">
                    <label for="mouse_model" class="form-label">Model</label>
                    <input type="text" class="form-control" id="ups_model" name="ups_model" required>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary">Add UPS</button>
                </div>
              </form>
            </div>  
          </div>
        </div>
      </div>

<!-- User Details Tab -->
<div class="tab-pane fade" id="pills-user" role="tabpanel" aria-labelledby="pills-user-tab">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div class="card-title">User Details</div>
    </div>
    
    <div class="card-body">
      {% if user_details %}
        <!-- User Details Table -->
        <table class="table table-head-bg-success table-bordered table-hover">
          <thead>
            <tr>
              <th>ATTRIBUTES</th>
              <th>DETAILS</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Package Number:</strong></td>
              <td>{{ user_details.desktop_package_db }}</td>
            </tr>
            <tr>
              <td><strong>Asset Owner:</strong></td>
              <td>{{ user_details.user_Assetowner.employee_fname }} {{ user_details.user_Assetowner.employee_lname }} </td>
            </tr>
            <tr>
              <td><strong>Asset Owner Designation</strong></td>
              <td>{{ user_details.user_Assetowner.employee_position }}</td>
            </tr>
            <tr>
              <td><strong>Asset Owner Office:</strong></td>
              <td>{{ user_details.user_Assetowner.employee_office }}</td>
            </tr>
            <tr>
              <td><strong>End User:</strong></td>
              <td>{{ user_details.user_Enduser.employee_fname }}</td>
            </tr>
            <tr>
              <td><strong>End User Designation:</strong></td>
              <td>{{ user_details.user_Enduser.employee_position }}</td>
            </tr>
            <tr>
              <td><strong>End User Office:</strong></td>
              <td>{{ user_details.user_Enduser.employee_office }}</td>
            </tr>
          </tbody>
        </table>
        <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editEndUserModal">Edit User</a>
        <a href="#" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#editAssetOwnerModal">Transfer Ownership</a>

      {% else %}
        <p class="text-danger">No available user for this desktop package.</p>
      {% endif %}
    </div>

    <!-- Edit EndUser Modal -->
    <div class="modal fade" id="editEndUserModal" tabindex="-1" aria-labelledby="editEndUserModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit End User</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="editEndUserForm" method="post">
              {% csrf_token %}
              <select class="form-select form-control" id="enduser_input" name="enduser_input">
                <option value="">Select End User</option>
                {% for employee in employees %}
                  <option value="{{ employee.id }}">{{ employee.employee_fname }} {{ employee.employee_lname }} - {{ employee.employee_position }}</option>
                {% endfor %}
              </select>
              <br>
              <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Edit AssetOwner Modal -->
    <div class="modal fade" id="editAssetOwnerModal" tabindex="-1" aria-labelledby="editAssetOwnerModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Asset Owner</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="editAssetOwnerForm" method="post">
              {% csrf_token %}
              <select class="form-select form-control" id="assetowner_input" name="assetowner_input">
                <option value="">Select End User</option>
                {% for employee in employees %}
                  <option value="{{ employee.id }}">{{ employee.employee_fname }} {{ employee.employee_lname }} - {{ employee.employee_position }}</option>
                {% endfor %}
              </select>
              <br>
              <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
          </div>
        </div>
      </div>
    </div>
{% comment %} Table to show the change history of ender user {% endcomment %}
    <hr>
    <div class="card-body">
      <div class="table-responsive">
        {% comment %} the end user change history view {% endcomment %}
        <h3>End User Change History</h3>
        <p>Below is the history of changes made to the End User for this desktop package.</p>

        <table class="table table-head-bg-danger table-bordered table-hover">
            <thead>
                <tr>
                    <th>Old End User</th>
                    <th>New End User</th>
                    <th>Changed By</th>
                    <th>Changed At</th>
                </tr>
            </thead>
            <tbody>
                {% for record in enduser_history %}
                <tr>
                    <td>{{ record.old_enduser.employee_fname }} {{ record.old_enduser.employee_lname }}</td>
                    <td>{{ record.new_enduser.employee_fname }} {{ record.new_enduser.employee_lname }}</td>
                    <td>{{ record.changed_by.username }}</td>
                    <td>{{ record.changed_at }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">No history available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>  
      </div>
    </div>
{% comment %} Table to show the change history of asset owner {% endcomment %}
    <hr>
    <div class="card-body">
      <div class="table-responsive">
        {% comment %} the end user change history view {% endcomment %}
        <h3>Asset Owner Transfer History</h3>
        <p>Below is the transfer history of Assetowner for this desktop package.</p>

        <table class="table table-head-bg-danger table-bordered table-hover">
            <thead>
                <tr>
                    <th>Old Asset Owner</th>
                    <th>New Asset Owner</th>
                    <th>Changed By</th>
                    <th>Changed At</th>
                </tr>
            </thead>
            <tbody>
                {% for record in assetowner_history %}
                <tr>
                    <td>{{ record.old_assetowner.employee_fname }} {{ record.old_assetowner.employee_lname }}</td>
                    <td>{{ record.new_assetowner.employee_fname }} {{ record.new_assetowner.employee_lname }}</td>
                    <td>{{ record.changed_by.username }}</td>
                    <td>{{ record.changed_at }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">No history available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>  
      </div>
    </div>
  </div>
</div>

<!-- Documents Tab -->
<div class="tab-pane fade" id="pills-documents" role="tabpanel" aria-labelledby="pills-documents-tab">
  <div class="card">
    <div class="card-header">
      <div class="card-title">Documents Details</div>
    </div>
    <div class="card-body">
      <table class="table table-head-bg-success table-bordered table-hover">
        <thead>
          <tr>
            <th scope="col-md-4 ms-auto me-auto">ATTRIBUTES</th>
            <th scope="col">DETAILS</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="col-sm-6 col-md-3"><strong>Package Number:</strong></td>
            <td>{{ keyboard_detailsx.package_no }}</td>
          </tr>
          <tr>
            <td class="col-sm-6 col-md-3"><strong>Serial Number:</strong></td>
            <td>{{ keyboard_detailsx.serial_no }}</td>
          </tr>
          <tr>
            <td class="col-sm-6 col-md-3"><strong>Brand Name:</strong></td>
            <td>{{ keyboard_detailsx.brand_name }}</td>
          </tr>
          <tr>
            <td class="col-sm-6 col-md-3"><strong>Model:</strong></td>
            <td>{{ keyboard_detailsx.model }}</td>
          </tr>
        </tbody>
      </table>
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editKeyboardModal">Edit</button>
    </div>
  </div>
</div>

<!-- Optional JavaScript -->
<script>
  // Initialize the Bootstrap pill tabs
  var triggerTabList = [].slice.call(document.querySelectorAll('#pills-tab-with-icon a'))
  triggerTabList.forEach(function (triggerEl) {
    var tabTrigger = new bootstrap.Tab(triggerEl)
    triggerEl.addEventListener('click', function (event) {
      event.preventDefault()
      tabTrigger.show()
    })
  })
</script>
<!-- JavaScript for pill hash -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Check if there is a hash in the URL
    const hash = window.location.hash;
    if (hash) {
      // Find the tab link with matching href and activate it
      const targetTabLink = document.querySelector(`a[href="${hash}"]`);
      if (targetTabLink) {
        const tab = new bootstrap.Tab(targetTabLink);
        tab.show();
      }
    }
  });
</script>
<!-- Bootstrap Toast for success message -->
<div class="toast-container position-fixed top-0 end-0 p-3">
  <div id="updateSuccessToast_End_User" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        ✅ End User updated successfully!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<div class="toast-container position-fixed top-0 end-0 p-3">
  <div id="updateSuccessToast_Asset_Owner" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        ✅ Asset Owner updated successfully!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>
<script>
  $(document).ready(function () {
    $("#editEndUserForm").submit(function (event) {
      event.preventDefault();  // Prevent default form submission

      let desktopId = "{{ desktop_package.id }}";  // Get the desktop package ID
      let formData = $(this).serialize();  // Serialize form data

      $.ajax({
        type: "POST",
        url: "/updateeee_end_user/" + desktopId + "/",
        data: formData,
        success: function (response) {
          if (response.success) {
            // Show Bootstrap Toast on success
            let toast = new bootstrap.Toast(document.getElementById('updateSuccessToast_End_User'));
            toast.show();

            // Close modal after a short delay
            setTimeout(function () {
              $("#editEndUserModal").modal("hide");
              location.reload(); // Reload to reflect changes
            }, 1500);
          } else {
            Swal.fire({
              icon: "error",
              title: "Oops...",
              text: "Failed to update End User!",
            });
          }
        },
        error: function () {
          Swal.fire({
            icon: "error",
            title: "Error",
            text: "Something went wrong while updating the End User.",
          });
        },
      });
    });
  });
</script>

<script>
  $(document).ready(function () {
    $("#editAssetOwnerForm").submit(function (event) {
      event.preventDefault();  // Prevent default form submission

      let desktopId = "{{ desktop_package.id }}";  // Get the desktop package ID
      let formData = $(this).serialize();  // Serialize form data

      $.ajax({
        type: "POST",
        url: "/updateeee_asset_onwer/" + desktopId + "/",
        data: formData,
        success: function (response) {
          if (response.success) {
            // Show Bootstrap Toast on success
            let toast = new bootstrap.Toast(document.getElementById('updateSuccessToast_Asset_Owner'));
            toast.show();

            // Close modal after a short delay
            setTimeout(function () {
              $("#editAssetOwnerModal").modal("hide");
              location.reload(); // Reload to reflect changes
            }, 1500);
          } else {
            Swal.fire({
              icon: "error",
              title: "Oops...",
              text: "Failed to update End User!",
            });
          }
        },
        error: function () {
          Swal.fire({
            icon: "error",
            title: "Error",
            text: "Something went wrong while updating the End User.",
          });
        },
      });
    });
  });
</script>
{% endblock %}



{% comment %} update script for monitor {% endcomment %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const editButtons = document.querySelectorAll('.edit-monitor-btn');
    const form = document.getElementById('editMonitorForm');

    editButtons.forEach(button => {
      button.addEventListener('click', () => {
        const id = button.dataset.id;
        const packageId = button.dataset.package;
        const sn = button.dataset.sn;
        const brand = button.dataset.brand;
        const model = button.dataset.model;
        const size = button.dataset.size;

        // Fill form fields
        document.getElementById('editPackage').value = packageId;
        document.getElementById('editSN').value = sn;
        document.getElementById('editBrand').value = brand;
        document.getElementById('editModel').value = model;
        document.getElementById('editSize').value = size;

        // Set form action dynamically
        form.action = `/monitor/${id}/update/`;
      });
    });
  });
</script>
