{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container">
  <div class="page-inner">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <div class="d-flex align-items-center">
              <h4 class="card-title">ðŸ›  Salvage Overview</h4>
              <div class="ms-auto">
                <a href="{% url 'export_salvage_excel' %}" class="btn btn-success btn-sm me-2">
                  <i class="fa fa-download me-1"></i> Export
                </a>
                <a href="{% url 'print_salvage_overview' %}" target="_blank" class="btn btn-info btn-sm">
                  <i class="fa fa-print me-1"></i> Print
                </a>
              </div>
            </div>
          </div>

          <div class="card-body">
            <!-- Nav Pills -->
            <ul class="nav nav-pills nav-secondary mb-3" id="salvage-tabs" role="tablist">
              <li class="nav-item submenu"><a class="nav-link active" data-bs-toggle="pill" href="#monitors">Monitors</a></li>
              <li class="nav-item submenu"><a class="nav-link" data-bs-toggle="pill" href="#keyboards">Keyboards</a></li>
              <li class="nav-item submenu"><a class="nav-link" data-bs-toggle="pill" href="#mice">Mice</a></li>
              <li class="nav-item submenu"><a class="nav-link" data-bs-toggle="pill" href="#ups">UPS</a></li>
            </ul>

            <div class="tab-content mt-2" id="salvage-tabContent">

              <!-- Monitors -->
              <div class="tab-pane fade show active" id="monitors">
                <div class="table-responsive table-head-bg-primary">
                  <table class="display table table-striped table-hover" id="monitor-table" style="width:100%">
                    <thead>
                      <tr>
                        <th>SN</th>
                        <th>Brand</th>
                        <th>Model</th>
                        <th>Size</th>
                        <th>Computer Name</th>
                        <th>Asset Owner</th>
                        <th>Date Salvaged</th>
                        <th>Notes</th>
                        <th>Status</th>
                      </tr>
                      <tr class="filters">
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search SN" data-table="monitor" data-column="0" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Brand" data-table="monitor" data-column="1" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Model" data-table="monitor" data-column="2" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Size" data-table="monitor" data-column="3" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Computer" data-table="monitor" data-column="4" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Owner" data-table="monitor" data-column="5" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Date" data-table="monitor" data-column="6" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Notes" data-table="monitor" data-column="7" /></th>
                        <th>
                          <select class="form-select form-select-sm column-search" data-table="monitor" data-column="8">
                            <option value="">All</option>
                            <option value="Available">Available</option>
                            <option value="Reassigned">Reassigned</option>
                            <option value="Disposed">Disposed</option>
                          </select>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for item in salvaged_monitors %}
                      <tr>
                        <td><a href="{% url 'salvaged_monitor_detail' item.id %}">{{ item.monitor_sn }}</a></td>
                        <td>{{ item.monitor_brand }}</td>
                        <td>{{ item.monitor_model }}</td>
                        <td>{{ item.monitor_size }}</td>
                        <td>{{ item.computer_name }}</td>
                        <td>{{ item.asset_owner }}</td>
                        <td>{{ item.salvage_date|date:"Y-m-d H:i" }}</td>
                        <td>{{ item.notes|default:"â€”" }}</td>
                        <td>
                          {% if item.is_disposed %}
                            <span class="badge bg-danger">Disposed</span>
                          {% elif item.is_reassigned %}
                            <a href="{% url 'salvaged_monitor_detail' item.id %}" class="badge bg-secondary text-decoration-none">
                              Reassigned â†’ {{ item.reassigned_computer_name|default:"Unknown" }}
                            </a>
                          {% else %}
                            <span class="badge bg-success">Available</span>
                          {% endif %}
                        </td>
                      </tr>
                      {% empty %}
                      <tr><td colspan="9" class="text-center text-muted">No salvaged monitors</td></tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Keyboards -->
              <div class="tab-pane fade" id="keyboards">
                <div class="table-responsive table-head-bg-primary">
                  <table class="display table table-striped table-hover" id="keyboard-table" style="width:100%">
                    <thead>
                      <tr>
                        <th>SN</th>
                        <th>Brand</th>
                        <th>Model</th>
                        <th>Computer Name</th>
                        <th>Asset Owner</th>
                        <th>Date Salvaged</th>
                        <th>Notes</th>
                        <th>Status</th>
                      </tr>
                      <tr class="filters">
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search SN" data-table="keyboard" data-column="0" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Brand" data-table="keyboard" data-column="1" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Model" data-table="keyboard" data-column="2" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Computer" data-table="keyboard" data-column="3" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Owner" data-table="keyboard" data-column="4" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Date" data-table="keyboard" data-column="5" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Notes" data-table="keyboard" data-column="6" /></th>
                        <th>
                          <select class="form-select form-select-sm column-search" data-table="keyboard" data-column="7">
                            <option value="">All</option>
                            <option value="Available">Available</option>
                            <option value="Reassigned">Reassigned</option>
                            <option value="Disposed">Disposed</option>
                          </select>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for item in salvaged_keyboards %}
                      <tr>
                        <td><a href="{% url 'salvaged_keyboard_detail' item.id %}">{{ item.keyboard_sn }}</a></td>
                        <td>{{ item.keyboard_brand }}</td>
                        <td>{{ item.keyboard_model }}</td>
                        <td>{{ item.computer_name }}</td>
                        <td>{{ item.asset_owner }}</td>
                        <td>{{ item.salvage_date|date:"Y-m-d H:i" }}</td>
                        <td>{{ item.notes|default:"â€”" }}</td>
                        <td>
                          {% if item.is_disposed %}
                            <span class="badge bg-danger">Disposed</span>
                          {% elif item.is_reassigned %}
                            <a href="{% url 'salvaged_keyboard_detail' item.id %}" class="badge bg-secondary text-decoration-none">
                              Reassigned â†’ {{ item.reassigned_computer_name|default:"Unknown" }}
                            </a>
                          {% else %}
                            <span class="badge bg-success">Available</span>
                          {% endif %}
                        </td>
                      </tr>
                      {% empty %}
                      <tr><td colspan="8" class="text-center text-muted">No salvaged keyboards</td></tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Mice -->
              <div class="tab-pane fade" id="mice">
                <div class="table-responsive table-head-bg-primary">
                  <table class="display table table-striped table-hover" id="mouse-table" style="width:100%">
                    <thead>
                      <tr>
                        <th>SN</th>
                        <th>Brand</th>
                        <th>Model</th>
                        <th>Computer Name</th>
                        <th>Asset Owner</th>
                        <th>Date Salvaged</th>
                        <th>Notes</th>
                        <th>Status</th>
                      </tr>
                      <tr class="filters">
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search SN" data-table="mouse" data-column="0" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Brand" data-table="mouse" data-column="1" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Model" data-table="mouse" data-column="2" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Computer" data-table="mouse" data-column="3" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Owner" data-table="mouse" data-column="4" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Date" data-table="mouse" data-column="5" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Notes" data-table="mouse" data-column="6" /></th>
                        <th>
                          <select class="form-select form-select-sm column-search" data-table="mouse" data-column="7">
                            <option value="">All</option>
                            <option value="Available">Available</option>
                            <option value="Reassigned">Reassigned</option>
                            <option value="Disposed">Disposed</option>
                          </select>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for item in salvaged_mice %}
                      <tr>
                        <td><a href="{% url 'salvaged_mouse_detail' item.id %}">{{ item.mouse_sn }}</a></td>
                        <td>{{ item.mouse_brand }}</td>
                        <td>{{ item.mouse_model }}</td>
                        <td>{{ item.computer_name }}</td>
                        <td>{{ item.asset_owner }}</td>
                        <td>{{ item.salvage_date|date:"Y-m-d H:i" }}</td>
                        <td>{{ item.notes|default:"â€”" }}</td>
                        <td>
                          {% if item.is_disposed %}
                            <span class="badge bg-danger">Disposed</span>
                          {% elif item.is_reassigned %}
                            <a href="{% url 'salvaged_mouse_detail' item.id %}" class="badge bg-secondary text-decoration-none">
                              Reassigned â†’ {{ item.reassigned_computer_name|default:"Unknown" }}
                            </a>
                          {% else %}
                            <span class="badge bg-success">Available</span>
                          {% endif %}
                        </td>
                      </tr>
                      {% empty %}
                      <tr><td colspan="8" class="text-center text-muted">No salvaged mice</td></tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- UPS -->
              <div class="tab-pane fade" id="ups">
                <div class="table-responsive table-head-bg-primary">
                  <table class="display table table-striped table-hover" id="ups-table" style="width:100%">
                    <thead>
                      <tr>
                        <th>SN</th>
                        <th>Brand</th>
                        <th>Model</th>
                        <th>Capacity</th>
                        <th>Computer Name</th>
                        <th>Asset Owner</th>
                        <th>Date Salvaged</th>
                        <th>Notes</th>
                        <th>Status</th>
                      </tr>
                      <tr class="filters">
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search SN" data-table="ups" data-column="0" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Brand" data-table="ups" data-column="1" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Model" data-table="ups" data-column="2" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Capacity" data-table="ups" data-column="3" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Computer" data-table="ups" data-column="4" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Owner" data-table="ups" data-column="5" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Date" data-table="ups" data-column="6" /></th>
                        <th><input type="text" class="form-control form-control-sm column-search" placeholder="Search Notes" data-table="ups" data-column="7" /></th>
                        <th>
                          <select class="form-select form-select-sm column-search" data-table="ups" data-column="8">
                            <option value="">All</option>
                            <option value="Available">Available</option>
                            <option value="Reassigned">Reassigned</option>
                            <option value="Disposed">Disposed</option>
                          </select>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for item in salvaged_ups %}
                      <tr>
                        <td><a href="{% url 'salvaged_ups_detail' item.id %}">{{ item.ups_sn }}</a></td>
                        <td>{{ item.ups_brand }}</td>
                        <td>{{ item.ups_model }}</td>
                        <td>{{ item.ups_capacity }}</td>
                        <td>{{ item.computer_name }}</td>
                        <td>{{ item.asset_owner }}</td>
                        <td>{{ item.salvage_date|date:"Y-m-d H:i" }}</td>
                        <td>{{ item.notes|default:"â€”" }}</td>
                        <td>
                          {% if item.is_disposed %}
                            <span class="badge bg-danger">Disposed</span>
                          {% elif item.is_reassigned %}
                            <a href="{% url 'salvaged_ups_detail' item.id %}" class="badge bg-secondary text-decoration-none">
                              Reassigned â†’ {{ item.reassigned_computer_name|default:"Unknown" }}
                            </a>
                          {% else %}
                            <span class="badge bg-success">Available</span>
                          {% endif %}
                        </td>
                      </tr>
                      {% empty %}
                      <tr><td colspan="9" class="text-center text-muted">No salvaged UPS</td></tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script>
$(document).ready(function() {
  console.log('Initializing Salvage DataTables...');
  
  // Store table instances
  var tables = {};
  
  // Initialize all DataTables
  tables.monitor = $('#monitor-table').DataTable({
    orderCellsTop: true,
    fixedHeader: false,
    pageLength: 10,
    lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
    language: {
      lengthMenu: "Show _MENU_ entries",
      info: "Showing _START_ to _END_ of _TOTAL_ monitors",
      infoEmpty: "Showing 0 to 0 of 0 monitors",
      infoFiltered: "(filtered from _MAX_ total monitors)"
    }
  });
  
  tables.keyboard = $('#keyboard-table').DataTable({
    orderCellsTop: true,
    fixedHeader: false,
    pageLength: 10,
    lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
    language: {
      lengthMenu: "Show _MENU_ entries",
      info: "Showing _START_ to _END_ of _TOTAL_ keyboards",
      infoEmpty: "Showing 0 to 0 of 0 keyboards",
      infoFiltered: "(filtered from _MAX_ total keyboards)"
    }
  });
  
  tables.mouse = $('#mouse-table').DataTable({
    orderCellsTop: true,
    fixedHeader: false,
    pageLength: 10,
    lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
    language: {
      lengthMenu: "Show _MENU_ entries",
      info: "Showing _START_ to _END_ of _TOTAL_ mice",
      infoEmpty: "Showing 0 to 0 of 0 mice",
      infoFiltered: "(filtered from _MAX_ total mice)"
    }
  });
  
  tables.ups = $('#ups-table').DataTable({
    orderCellsTop: true,
    fixedHeader: false,
    pageLength: 10,
    lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
    language: {
      lengthMenu: "Show _MENU_ entries",
      info: "Showing _START_ to _END_ of _TOTAL_ UPS",
      infoEmpty: "Showing 0 to 0 of 0 UPS",
      infoFiltered: "(filtered from _MAX_ total UPS)"
    }
  });
  
  console.log('DataTables initialized');
  
  // Apply the search using data-column and data-table attributes
  $('.column-search').on('keyup change', function() {
    var tableName = $(this).data('table');
    var columnIndex = $(this).data('column');
    var searchValue = this.value;
    
    console.log('Searching ' + tableName + ' table, column ' + columnIndex + ' for: ' + searchValue);
    
    if (tables[tableName]) {
      tables[tableName].column(columnIndex).search(searchValue).draw();
    }
  });
  
  console.log('Filter handlers attached');
});
</script>
{% endblock %}