
<!-- ==================== 💻 EDIT LAPTOP MODAL ==================== -->
{% if laptop_details %}
<div class="modal fade" id="editLaptopModal" tabindex="-1" aria-labelledby="editLaptopModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" action="{% url 'edit_laptop' laptop_details.id %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title"><i class="fa fa-edit"></i> Edit Laptop Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">

          <!-- Serial Number -->
          <div class="mb-3">
            <label class="form-label">Serial Number</label>
            <input type="text" name="laptop_sn_db" class="form-control" value="{{ laptop_details.laptop_sn_db }}" required>
          </div>

          <!-- Brand -->
          <div class="mb-3">
            <label class="form-label">Brand</label>
            <select class="form-select" name="brand_name" required>
              <option value="">-- Select Brand --</option>
              {% for brand in brands %}
              <option value="{{ brand.id }}" {% if laptop_details.brand_name and laptop_details.brand_name.id == brand.id %}selected{% endif %}>
                {{ brand.name }}
              </option>
              {% endfor %}
            </select>
          </div>

          <!-- Model -->
          <div class="mb-3">
            <label class="form-label">Model</label>
            <input type="text" name="model" class="form-control" value="{{ laptop_details.model }}" required>
          </div>

          <!-- Processor -->
          <div class="mb-3">
            <label class="form-label">Processor</label>
            <select class="form-select form-control" id="processor" name="processor" required>
              <option value="" disabled {% if not laptop_details.processor %}selected{% endif %}>-- Select Processor --</option>

              <optgroup label="Core i9">
                <option value="i9-14900K" {% if laptop_details.processor == "i9-14900K" %}selected{% endif %}>Core i9-14900K (14th Gen)</option>
                <option value="i9-13900K" {% if laptop_details.processor == "i9-13900K" %}selected{% endif %}>Core i9-13900K (13th Gen)</option>
                <option value="i9-12900K" {% if laptop_details.processor == "i9-12900K" %}selected{% endif %}>Core i9-12900K (12th Gen)</option>
              </optgroup>

              <optgroup label="Core i7">
                <option value="i7-14700K" {% if laptop_details.processor == "i7-14700K" %}selected{% endif %}>Core i7-14700K (14th Gen)</option>
                <option value="i7-13700K" {% if laptop_details.processor == "i7-13700K" %}selected{% endif %}>Core i7-13700K (13th Gen)</option>
              </optgroup>

              <optgroup label="Core i5">
                <option value="i5-14600K" {% if laptop_details.processor == "i5-14600K" %}selected{% endif %}>Core i5-14600K (14th Gen)</option>
                <option value="i5-13600K" {% if laptop_details.processor == "i5-13600K" %}selected{% endif %}>Core i5-13600K (13th Gen)</option>
              </optgroup>
            </select>
          </div>

          <!-- Memory & Drive -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Memory</label>
              <select class="form-select form-control mt-2" id="memory" name="memory" required>
                <option value="" disabled {% if not laptop_details.memory %}selected{% endif %}>-- Select Memory --</option>
                <option value="4GB" {% if laptop_details.memory == "4GB" %}selected{% endif %}>4GB</option>
                <option value="8GB" {% if laptop_details.memory == "8GB" %}selected{% endif %}>8GB</option>
                <option value="16GB" {% if laptop_details.memory == "16GB" %}selected{% endif %}>16GB</option>
                <option value="32GB" {% if laptop_details.memory == "32GB" %}selected{% endif %}>32GB</option>
                <option value="64GB" {% if laptop_details.memory == "64GB" %}selected{% endif %}>64GB</option>
                <option value="128GB" {% if laptop_details.memory == "128GB" %}selected{% endif %}>128GB</option>
              </select>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Drive</label>
              <input type="text" name="drive" class="form-control" value="{{ laptop_details.drive }}" required>
            </div>
          </div>

          <!-- Software Section -->
          <div class="row">
            <!-- Operating System -->
            <div class="col-md-6 mb-3">
              <label class="form-label">Operating System</label>
              <select name="laptop_OS" id="laptop_OS" class="form-select form-control" required>
                <option value="" disabled {% if not laptop_details.laptop_OS %}selected{% endif %}>Select OS</option>
                <option value="Windows 11 Pro" {% if laptop_details.laptop_OS == "Windows 11 Pro" %}selected{% endif %}>Windows 11 Pro</option>
                <option value="Windows 11 Home" {% if laptop_details.laptop_OS == "Windows 11 Home" %}selected{% endif %}>Windows 11 Home</option>
                <option value="Windows 11 Enterprise" {% if laptop_details.laptop_OS == "Windows 11 Enterprise" %}selected{% endif %}>Windows 11 Enterprise</option>
                <option value="Windows 10 Pro" {% if laptop_details.laptop_OS == "Windows 10 Pro" %}selected{% endif %}>Windows 10 Pro</option>
                <option value="Windows 10 Home" {% if laptop_details.laptop_OS == "Windows 10 Home" %}selected{% endif %}>Windows 10 Home</option>
                <option value="Windows 10 Enterprise" {% if laptop_details.laptop_OS == "Windows 10 Enterprise" %}selected{% endif %}>Windows 10 Enterprise</option>
                <option value="Windows 8.1 Pro" {% if laptop_details.laptop_OS == "Windows 8.1 Pro" %}selected{% endif %}>Windows 8.1 Pro</option>
                <option value="Windows 8 Pro" {% if laptop_details.laptop_OS == "Windows 8 Pro" %}selected{% endif %}>Windows 8 Pro</option>
                <option value="Windows 7 Ultimate" {% if laptop_details.laptop_OS == "Windows 7 Ultimate" %}selected{% endif %}>Windows 7 Ultimate</option>
                <option value="Windows 7 Professional" {% if laptop_details.laptop_OS == "Windows 7 Professional" %}selected{% endif %}>Windows 7 Professional</option>
                <option value="Windows Server 2022" {% if laptop_details.laptop_OS == "Windows Server 2022" %}selected{% endif %}>Windows Server 2022</option>
                <option value="Windows Server 2019" {% if laptop_details.laptop_OS == "Windows Server 2019" %}selected{% endif %}>Windows Server 2019</option>
                <option value="Windows Server 2016" {% if laptop_details.laptop_OS == "Windows Server 2016" %}selected{% endif %}>Windows Server 2016</option>
                <option value="Windows Server 2012 R2" {% if laptop_details.laptop_OS == "Windows Server 2012 R2" %}selected{% endif %}>Windows Server 2012 R2</option>
                <option value="Other" {% if laptop_details.laptop_OS == "Other" %}selected{% endif %}>Other</option>
              </select>

              <!-- 🔑 OS Product Key -->
              <label class="form-label mt-2">Operating System Key</label>
              <input type="text"
                     name="laptop_OS_keys"
                     class="form-control kai-safe-key-input"
                     maxlength="29"
                     oninput="formatProductKey(this)"
                     value="{{ laptop_details.laptop_OS_keys|default:'' }}"
                     placeholder="XXXXX-XXXXX-XXXXX-XXXXX-XXXXX">
            </div>

            <!-- Office Version -->
            <div class="col-md-6 mb-3">
              <label class="form-label">Microsoft Office Version</label>
              <select name="laptop_Office" id="laptop_Office" class="form-select form-control" required>
                <option value="" disabled {% if not laptop_details.laptop_Office %}selected{% endif %}>Select Office Version</option>
                <option value="Microsoft Office 2024 Professional Plus" {% if laptop_details.laptop_Office == "Microsoft Office 2024 Professional Plus" %}selected{% endif %}>Microsoft Office 2024 Professional Plus</option>
                <option value="Microsoft Office 2024 Standard" {% if laptop_details.laptop_Office == "Microsoft Office 2024 Standard" %}selected{% endif %}>Microsoft Office 2024 Standard</option>
                <option value="Microsoft Office 2021 Professional Plus" {% if laptop_details.laptop_Office == "Microsoft Office 2021 Professional Plus" %}selected{% endif %}>Microsoft Office 2021 Professional Plus</option>
                <option value="Microsoft Office 2021 Standard" {% if laptop_details.laptop_Office == "Microsoft Office 2021 Standard" %}selected{% endif %}>Microsoft Office 2021 Standard</option>
                <option value="Microsoft Office 2019 Professional Plus" {% if laptop_details.laptop_Office == "Microsoft Office 2019 Professional Plus" %}selected{% endif %}>Microsoft Office 2019 Professional Plus</option>
                <option value="Microsoft Office 2019 Standard" {% if laptop_details.laptop_Office == "Microsoft Office 2019 Standard" %}selected{% endif %}>Microsoft Office 2019 Standard</option>
                <option value="Microsoft Office 2016 Professional Plus" {% if laptop_details.laptop_Office == "Microsoft Office 2016 Professional Plus" %}selected{% endif %}>Microsoft Office 2016 Professional Plus</option>
                <option value="Microsoft Office 2016 Standard" {% if laptop_details.laptop_Office == "Microsoft Office 2016 Standard" %}selected{% endif %}>Microsoft Office 2016 Standard</option>
                <option value="Microsoft Office 2013 Professional Plus" {% if laptop_details.laptop_Office == "Microsoft Office 2013 Professional Plus" %}selected{% endif %}>Microsoft Office 2013 Professional Plus</option>
                <option value="Microsoft Office 2013 Standard" {% if laptop_details.laptop_Office == "Microsoft Office 2013 Standard" %}selected{% endif %}>Microsoft Office 2013 Standard</option>
                <option value="Microsoft Office 2021 Home and Business" {% if laptop_details.laptop_Office == "Microsoft Office 2021 Home and Business" %}selected{% endif %}>Microsoft Office 2021 Home and Business</option>
                <option value="Microsoft Office 2019 Home and Business" {% if laptop_details.laptop_Office == "Microsoft Office 2019 Home and Business" %}selected{% endif %}>Microsoft Office 2019 Home and Business</option>
                <option value="Microsoft Office 2016 Home and Business" {% if laptop_details.laptop_Office == "Microsoft Office 2016 Home and Business" %}selected{% endif %}>Microsoft Office 2016 Home and Business</option>
                <option value="Office 365 (Microsoft 365)" {% if laptop_details.laptop_Office == "Office 365 (Microsoft 365)" %}selected{% endif %}>Office 365 (Microsoft 365)</option>
                <option value="LibreOffice" {% if laptop_details.laptop_Office == "LibreOffice" %}selected{% endif %}>LibreOffice</option>
                <option value="WPS Office" {% if laptop_details.laptop_Office == "WPS Office" %}selected{% endif %}>WPS Office</option>
                <option value="OpenOffice" {% if laptop_details.laptop_Office == "OpenOffice" %}selected{% endif %}>OpenOffice</option>
                <option value="Other" {% if laptop_details.laptop_Office == "Other" %}selected{% endif %}>Other</option>
              </select>

              <!-- 🔑 MS Office Product Key -->
              <label class="form-label mt-2">Microsoft Office Key</label>
              <input type="text"
                     name="laptop_Office_keys"
                     class="form-control kai-safe-key-input"
                     maxlength="29"
                     oninput="formatProductKey(this)"
                     value="{{ laptop_details.laptop_Office_keys|default:'' }}"
                     placeholder="XXXXX-XXXXX-XXXXX-XXXXX-XXXXX">
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">
            <i class="fa fa-save"></i> Save Changes
          </button>
        </div>

      </div>
    </form>
  </div>
</div>
{% endif %}

<!-- ==================== 🗑 DISPOSE LAPTOP MODAL ==================== -->
<div class="modal fade" id="disposeModal" tabindex="-1" aria-labelledby="disposeModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    {% if laptop_details %}
    <form method="POST" action="{% url 'dispose_laptop' laptop_details.id %}" id="disposeLaptopForm">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title"><i class="fa fa-trash"></i> Dispose Laptop</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <label class="form-label">Reason</label>
          <textarea name="reason" class="form-control" required></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">
            <span class="button-text"><i class="fa fa-trash"></i> Dispose</span>
            <span class="spinner-border spinner-border-sm d-none"></span>
          </button>
        </div>
      </div>
    </form>
    {% else %}
    <div class="alert alert-warning m-0">
      ⚠ No active laptop to dispose in this package.
    </div>
    {% endif %}
  </div>
</div>



<!-- ==================== 👤 EDIT END USER MODAL ==================== -->
<div class="modal fade" id="editEndUserModal" tabindex="-1" aria-labelledby="editEndUserModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form id="editEndUserForm" data-url="{% url 'update_end_user_laptop' laptop_package.id %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title"><i class="fa fa-user"></i> Update End User</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Select New End User</label>
            <select name="enduser_input" class="form-select" required>
              <option value="">-- Select End User --</option>
              {% for employee in employees %}
              <option value="{{ employee.id }}" 
                {% if user_details and user_details.user_Enduser.id == employee.id %}selected{% endif %}>
                {{ employee.full_name }} - {{ employee.employee_position }}
              </option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary" id="submitButton">
            <span class="button-text"><i class="fa fa-save"></i> Save Changes</span>
            <span class="spinner-border spinner-border-sm d-none"></span>
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- ==================== 🔁 EDIT ASSET OWNER MODAL ==================== -->
<div class="modal fade" id="editAssetOwnerModal" tabindex="-1" aria-labelledby="editAssetOwnerModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form id="editAssetOwnerForm" data-url="{% url 'update_asset_owner_laptop' laptop_package.id %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header bg-warning text-dark">
          <h5 class="modal-title"><i class="fa fa-exchange-alt"></i> Transfer Asset Ownership</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Select New Asset Owner</label>
            <select name="assetowner_input" class="form-select" required>
              <option value="">-- Select Asset Owner --</option>
              {% for employee in employees %}
              <option value="{{ employee.id }}"
                {% if user_details and user_details.user_Assetowner.id == employee.id %}selected{% endif %}>
                {{ employee.full_name }} - {{ employee.employee_position }}
              </option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-warning" id="submitButtonAsset">
            <span class="button-text"><i class="fa fa-save"></i> Save Changes</span>
            <span class="spinner-border spinner-border-sm d-none"></span>
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- ==================== 📄 EDIT DOCUMENTS MODAL ==================== -->
<div class="modal fade" id="editDocumentsModal" tabindex="-1" aria-labelledby="editDocumentsModalLabel" aria-hidden="true">
  <div class="modal-dialog">
 
    <form id="editDocumentsForm" data-url="{% url 'update_documents_laptop' laptop_package.id %}" method="POST">

      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title"><i class="fa fa-file-alt"></i> Edit Documents</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">PAR Number</label>
            <input type="text" name="docs_PAR" class="form-control" 
              value="{{ documents_details.docs_PAR }}" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Property Number</label>
            <input type="text" name="docs_Propertyno" class="form-control" 
              value="{{ documents_details.docs_Propertyno }}" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Acquisition Type</label>
            <select name="docs_Acquisition_Type" class="form-select" required>
              <option value="Purchased" {% if documents_details.docs_Acquisition_Type == "Purchased" %}selected{% endif %}>Purchased</option>
              <option value="Donated" {% if documents_details.docs_Acquisition_Type == "Donated" %}selected{% endif %}>Donated</option>
              <option value="Transferred" {% if documents_details.docs_Acquisition_Type == "Transferred" %}selected{% endif %}>Transferred</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Value</label>
            <input type="number" step="0.01" name="docs_Value" class="form-control" 
              value="{{ documents_details.docs_Value }}" required>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Date Received</label>
              <input type="date" name="docs_Datereceived" class="form-control" 
                value="{{ documents_details.docs_Datereceived|date:'Y-m-d' }}" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Date Inspected</label>
              <input type="date" name="docs_Dateinspected" class="form-control" 
                value="{{ documents_details.docs_Dateinspected|date:'Y-m-d' }}" required>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Supplier</label>
            <input type="text" name="docs_Supplier" class="form-control" 
              value="{{ documents_details.docs_Supplier }}" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Status</label>
            <select name="docs_Status" class="form-select" required>
              <option value="Active" {% if documents_details.docs_Status == "Active" %}selected{% endif %}>Active</option>
              <option value="Under Repair" {% if documents_details.docs_Status == "Under Repair" %}selected{% endif %}>Under Repair</option>
              <option value="Disposed" {% if documents_details.docs_Status == "Disposed" %}selected{% endif %}>Disposed</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-info text-white">
            <span class="button-text"><i class="fa fa-save"></i> Save Changes</span>
            <span class="spinner-border spinner-border-sm d-none"></span>
          </button>
        </div>
      </div>
    </form>
  </div>
</div>