<!-- templates/add_desktop_package_with_details.html -->
{% extends 'base.html' %}
{% load static %}
{% block content %}


<!-- Forms begins here -->
<div class="container">
  <div class="page-inner">
    <div class="page-header">
      <h3 class="fw-bold mb-3">Forms</h3>
      <ul class="breadcrumbs mb-3">
        <li class="nav-home"><a href="#"><i class="icon-home"></i></a></li>
        <li class="separator"><i class="icon-arrow-right"></i></li>
        <li class="nav-item"><a href="#">Forms</a></li>
        <li class="separator"><i class="icon-arrow-right"></i></li>
        <li class="nav-item"><a href="#">Basic Form</a></li>
      </ul>
    </div>

    <!-- Success and Error Messages -->
   

    <!-- Main Form Container -->  
    <div class="container">
      <div class="card col">
        <div class="card-header">
          <div class="card-title">ADD ICT EQUIPMENT</div>
        </div>
        
      <form method="post" action="{% url 'add_desktop_package_with_details' %}" id="addEquipmentForm">
          {% csrf_token %}

          <!-- Equipment Selection Dropdown -->
          <div class="card-body">
            <div class="form-group">
              <label for="equipmentSelect"><h5>Equipment Type</h5></label>
              <select class="form-select form-control" id="equipmentSelect" name="name_input"  required>
                <option value="" selected disabled>Select Equipment Type</option>
                <option value="Desktop" {% if equipment_type == 'Desktop' %}selected{% endif %}>Desktop</option>
                <option value="Laptop" {% if equipment_type == 'Laptop' %}selected{% endif %}>Laptop</option>
                <option value="UPS" {% if equipment_type == 'UPS' %}selected{% endif %}>UPS</option>
              </select>
            </div>
          </div>
        
          <!-- Desktop Details Card -->
          <div id="desktopForm" class="equipment-form card-body" style="display: {% if equipment_type == 'Desktop' %}block{% else %}none{% endif %};">
            <hr>
            <h3><i class="fas fa-window-maximize"> &nbsp;</i>Desktop Details</h3>
            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label for="desktopSerial">Serial Number</label>
                  <input type="text" name="desktop_serial_no" id="desktop_serial_no" class="form-control" placeholder="Serial Number" required>
                </div>
              </div>
              <div class="col-md-4">
                    <div class="form-group">
                      <label for="desktopBrand">Brand Name</label>
                      <select name="desktop_brand_name" id="desktop_brand_name" class="form-select" required>
                        <option value="">-- Select Brand --</option>
                        {% for brand in desktop_brands %}
                           <option value="{{ brand.id }}" style="color: black;">{{ brand.name }}</option>
                        {% endfor %}
                      </select>
                    </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label for="desktopModel">Model</label>
                  <input type="text" name="desktop_model" id="desktop_model" class="form-control">
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label for="desktopProcessor">Processor</label>
                  <input type="text" name="desktop_processor" id="desktop_processor" class="form-control">
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label for="desktopMemory">Memory</label>
                  <input type="text" name="desktop_memory" id="desktop_memory" class="form-control">
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label for="desktopDrive">Computer Drive</label>
                  <input type="text" name="desktop_drive" id="desktop_drive" class="form-control">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label for="desktopGPU">Graphics Name</label>
                  <input type="text" name="desktop_Graphics" id="desktop_Graphics" class="form-control">
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label for="desktopGPUSIZE">Graphics Size</label>
                  <input type="text" name="desktop_Graphics_Size" id="desktop_Graphics_Size" class="form-control">
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label for="desktopOS">Operating System</label>
                  <input type="text" name="desktop_OS" id="desktop_OS" class="form-control">
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label for="desktopOffice">Office Version</label>
                  <input type="text" name="desktop_Office" id="desktop_Office" class="form-control">
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label for="desktopOSkeys">OS License Keys</label>
                  <input type="text" name="desktop_OS_keys" id="desktop_OS_keys" class="form-control">
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label for="desktopOfficekeys">Office License Keys</label>
                  <input type="text" name="desktop_Office_keys" id="desktop_Office_keys" class="form-control">
                </div>
              </div>

         
        
      </div>
    </div>
    
  </div>
</div>




<!-- Monitor Separate Container for Additional Details Monitor --> 
      
<div id="MonitorContainer" class="container" style="display: none;">
  <div class="card col">
    <div class="card-header">
      <h3><i class="fas fa-desktop"> &nbsp;</i>Monitor Details</h3>
    </div>
    <div class="card-body">
      <p>Here you can add extra details specifically related to the selected Monitor.</p>

      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label for="MonitorSerial">Monitor Serial Number</label>
            <input type="text" name="monitor_sn" id="monitor_sn" class="form-control" required>
          </div>
        </div>
        <div class="col-md-4">
          
            <div class="form-group">
            <label for="MonitorBrand">Monitor Brand</label>
           <select name="monitor_brand" class="form-select" required>
              <option value="">-- Select Brand --</option>
              {% for brand in monitor_brands %}
                <option value="{{ brand.id }}">{{ brand.name }}</option>
              {% endfor %}
            </select>
            </div>
          </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="MonitorModel">Monitor Model</label>
            <input type="text" name="monitor_model" id="monitor_model" class="form-control" required>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="MonitorSize">Monitor Size</label>
            <input type="text" name="monitor_size" id="monitor_size" class="form-control" required>
          </div>
        </div>

      </div>
      
    </div>

    
  </div>
</div>
<!-- Keyboard Separate Container for Additional Details -->
<div id="KeyboardContainer" class="container" style="display: none;">
  <div class="card col">
    <div class="card-header">
      <h3><i class="fas fa-desktop"> &nbsp;</i>Keyboard Details</h3>
    </div>
    <div class="card-body">
      <p>Here you can add extra details specifically related to the selected Keyboard.</p>

      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label for="keyboardSerial">Keyboard Serial Number</label>
            <input type="text" name="keyboard_sn" id="keyboard_sn" class="form-control">
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="keyboardBrand">Keyboard Brand</label>
            <select name="keyboard_brand" id="keyboard_brand" class="form-select" required>
              <option value="">-- Select Keyboard Brand --</option>
              {% for brand in keyboard_brands %}
                <option value="{{ brand.id }}">{{ brand.name }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="keyboardModel">Keyboard Model</label>
            <input type="text" name="keyboard_model" id="keyboard_model" class="form-control">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


 <!-- Mouse Separate Container for Additional Details -->
<div id="MouseContainer" class="container" style="display: none;">
  <div class="card col">
    <div class="card-header">
      <h3><i class="fas fa-mouse-pointer"> &nbsp;</i>Mouse Details</h3>
    </div>
    <div class="card-body">
      <p>Here you can add extra details specifically related to the selected Mouse.</p>

      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label for="MouseSerial">Mouse Serial Number</label>
            <input type="text" name="mouse_sn" id="mouse_sn" class="form-control">
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="MouseBrand">Mouse Brand</label>
            <select name="mouse_brand" id="mouse_brand" class="form-select" required>
              <option value="">-- Select Mouse Brand --</option>
              {% for brand in mouse_brands %}
                <option value="{{ brand.id }}">{{ brand.name }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="keyboardModel">Mouse Model</label>
            <input type="text" name="mouse_model" id="mouse_model" class="form-control">
          </div>
        </div>

      </div>
    </div>

  </div>
</div>

 <!-- UPS Separate Container for Additional Details -->
<div id="UPSContainer" class="container" style="display: none;">
  <div class="card col">
    <div class="card-header">
      <h3><i class="fas fa-plug"> &nbsp;</i>UPS Details</h3>
    </div>
    <div class="card-body">
      <p>Here you can add extra details specifically related to the selected UPS.</p>

      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label for="UPSSerial">UPS Serial Number</label>
            <input type="text" name="ups_sn" id="ups_sn" class="form-control">
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="UPSBrand">UPS Brand</label>
            <select name="ups_brand" id="ups_brand" class="form-select" required>
                <option value="">-- Select UPS Brand --</option>
                {% for brand in ups_brands %}
                  <option value="{{ brand.id }}">{{ brand.name }}</option>
                {% endfor %}
              </select>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="UPSModel">UPS Model</label>
            <input type="text" name="ups_model" id="ups_model" class="form-control">
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="UPSCapacity">UPS Capacity</label>
            <input type="text" name="ups_capacity" id="ups_capacity" class="form-control">
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<div id="DocumentsContainer" class="container" style="display: none;">
  <div class="card col">
    <div class="card-header">
      <h3><i class="fas fa-money-check"> &nbsp;</i>Documents Details</h3>
    </div>
    <div class="card-body">
      <p>Here you can add extra details specifically related to the selected Documents.</p>

      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label for="parnumber">PAR Number</label>
            <input type="text" class="form-control" id="parnumber" name="par_number_input">
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="propertynumber">Property Number</label>
            <input type="text" class="form-control" id="propertynumber" name="property_number_input" >
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="Acquisition">Acquisition Type</label>
            <input type="text" class="form-control" id="acquisition" name="acquisition_type_input">
          </div>
        </div>
      </div>    

      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label for="value">Package Value</label>
            <input type="text" class="form-control" id="value" name="value_desktop_input" value="{{ value_desktop_input_any }}" >
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="dateReceived">Date Received</label>
            <input type="text" class="form-control" id="dateReceived" name="date_received_input" value="{{ date_received_input_any }}" >
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="dateInspected">Date Inspected</label>
            <input type="text" class="form-control" id="dateInspected" name="date_inspected_input" value="{{ date_inspected_input_any }}" >
          </div>
        </div>
      </div>    

      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label for="supplier">Supplier</label>
            <input type="text" class="form-control" id="supplier" name="supplier_name_input" value="{{ supplier_name_input_any }}" >
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="status">Status</label>
            <input type="text" class="form-control" id="status" name="status_desktop_input" value="{{ status_desktop_input_any }}" >
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="computername">Computer Name</label>
            
            <input type="text" class="form-control" id="computername" name="computer_name_input" value="{{ computer_name_input_any }}">
          </div>
        </div>
      
  </div>
</div>
</div>
{% comment %} sdf {% endcomment %}

<div id="UserContainer" class="container" style="display: none;">
  <div class="card col">
    <div class="card-header">
      <h3><i class="fas fa-user-alt"> &nbsp;</i>User Details</h3>
    </div>
    <div class="card-body">
      <p>Here you can add extra details specifically related to the selected User.</p>


      <div class="row">
        <div class="col-md-4">
            <div class="form-group">
              <label for="largeSelect">End User</label>


              <select class="form-select form-control" id="enduser_input" name="enduser_input" required>
                <option value="">Select End User</option>
                {% for employee in employees %}
                    <option value="{{ employee.id }}">
                        {{ employee.employee_fname }} {{ employee.employee_lname }} - {{ employee.employee_position }}
                    </option>
                {% endfor %}
            </select>
            </div>
        </div>

        <div class="col-md-4">
          <div class="form-group">
            <label for="propertynumber">Asset Owner</label>
            <select class="form-select form-control" id="assetowner_input" name="assetowner_input" required>
              <option value="">Select Asset User</option>
              {% for employee in employees %}
                  <option value="{{ employee.id }}">
                      {{ employee.employee_fname }} {{ employee.employee_lname }} - {{ employee.employee_position }}
                  </option>
              {% endfor %}
          </select>
             </div> <!-- close col-md-4 (Asset Owner) -->
      </div> <!-- close row -->
    </div> <!-- close card-body -->
  </div> <!-- close card.col -->
</div> <!-- close #UserContainer -->

<!-- Submit/Reset Buttons (inside form) -->
<div class="card-action">
  <button type="submit" class="btn btn-success mt-3">Submit</button>
  <button type="reset" class="btn btn-danger mt-3">Cancel</button>
</div>
</form> <!-- ✅ End of form -->

<!-- Scripts and Modals -->

<!-- jQuery -->
<script src="{% static 'js/core/jquery-3.7.1.min.js' %}"></script>
<!-- Bootstrap Bundle -->
<script src="{% static 'js/core/bootstrap.bundle.min.js' %}"></script>

<!-- Modal for Duplicate Computer Name -->
<div class="modal fade" id="duplicateComputerModal" tabindex="-1" aria-labelledby="duplicateComputerModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content border-danger">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="duplicateComputerModalLabel">🚫 Duplicate Computer Name</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <p>The computer name you entered already exists. Please enter a unique name.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Okay</button>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript for Dynamic Form Display -->
<script>
  document.getElementById('equipmentSelect').addEventListener('change', function() {
    // Hide all form containers initially
    document.querySelectorAll('.equipment-form').forEach(function(form) {
      form.style.display = 'none';
    });
    
    // Hide additional details container
    
    document.getElementById('MonitorContainer').style.display = 'none';
    document.getElementById('KeyboardContainer').style.display = 'none';
    document.getElementById('MouseContainer').style.display = 'none';
    document.getElementById('UPSContainer').style.display = 'none';
    document.getElementById('DocumentsContainer').style.display = 'none';
    document.getElementById('UserContainer').style.display = 'none';
    



    // Show the selected form and additional details if Desktop is selected
    const selectedValue = this.value;
    if (selectedValue === 'Desktop') {
      document.getElementById('desktopForm').style.display = 'block';
      document.getElementById('MonitorContainer').style.display = 'block';
      document.getElementById('KeyboardContainer').style.display = 'block';
      document.getElementById('MouseContainer').style.display = 'block';
      document.getElementById('UPSContainer').style.display = 'block';
      document.getElementById('DocumentsContainer').style.display = 'block';
      document.getElementById('UserContainer').style.display = 'block';
      
      


    } else if (selectedValue === 'Laptop') {
      document.getElementById('laptopForm').style.display = 'block';
    } else if (selectedValue === 'UPS') {
      document.getElementById('upsForm').style.display = 'block';
    }
  });
</script>
  
 

<script>// Always prevent to run validation first
  async function checkDuplicateName(name) {
    const response = await fetch(`/check_computer_name/?computer_name=${encodeURIComponent(name)}`);
    const data = await response.json();
    return data.exists;
  }

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('addEquipmentForm');
    const input = document.getElementById('computername');
    const modalEl = document.getElementById('duplicateComputerModal');

    if (!form || !input || !modalEl) return;

    const modal = new bootstrap.Modal(modalEl);

    form.addEventListener('submit', async function (e) { 
      e.preventDefault();  // Always prevent to run validation first
      const name = input.value.trim();

      if (!name) {
        input.classList.add('is-invalid');
        return;
      }

      const isDuplicate = await checkDuplicateName(name);
      if (isDuplicate) {
        input.classList.add('is-invalid');
        modal.show();
      } else {
        input.classList.remove('is-invalid');
        // Submit only when validated and not duplicate
        form.submit();  // ✅ this will truly submit the form
      }
    });
  });
</script> 


{% endblock %}

