<div class="tab-pane fade" id="pills-monitor" role="tabpanel" aria-labelledby="pills-monitor-tab">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div class="card-title">Monitor Details</div>
      {% if not has_active_monitor and has_active_desktop %}
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMonitorModal">Add Monitor</button>
      {% endif %}
    </div>
    <div class="card-body">
      {% if monitor_detailse %}
      <table class="table table-head-bg-success table-bordered table-hover">
        <thead>
          <tr>
            <th>ATTRIBUTES</th>
            <th>DETAILS</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Package Number:</strong></td>
            <td>{{ monitor_detailse.equipment_package }}</td>
          </tr>
          <tr>
            <td><strong>Serial Number:</strong></td>
            <td>{{ monitor_detailse.monitor_sn_db }}</td>
          </tr>
          <tr>
            <td><strong>Brand Name:</strong></td>
            <td>{{ monitor_detailse.monitor_brand_db }}</td>
          </tr>
          <tr>
            <td><strong>Model:</strong></td>
            <td>{{ monitor_detailse.monitor_model_db }}</td>
          </tr>
          <tr>
            <td><strong>Monitor Size:</strong></td>
            <td>{{ monitor_detailse.monitor_size_db }}</td>
          </tr>
        </tbody>
      </table>

      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editMonitorModal">Edit</button>
      <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDisposeModal_Monitor">Dispose Monitor</button>

      {% endif %}

      {% if not has_active_monitor and not has_active_desktop %}
      <p class="text-danger">This Monitor was completely disposed under the whole package.</p>
      {% endif %}

      {% if not has_active_monitor and has_active_desktop %}
      <p class="text-danger">No available Monitors for this desktop package. You can still add a monitor under this package.</p>
      {% endif %}

      {% if disposed_monitor.exists %}
      <hr>
      <h5>Disposed Monitors</h5>
      <table class="table table-head-bg-danger table-bordered table-hover">
        <thead>
          <tr>
            <th>Serial Number</th>
            <th>Brand</th>
            <th>Model</th>
            <th>Disposal Date</th>
          </tr>
        </thead>
        <tbody>
          {% for disposed_monitor in disposed_monitor %}
          <tr>
            <td>{{ disposed_monitor.monitor_disposed_db.monitor_sn_db }}</td>
            <td>{{ disposed_monitor.monitor_disposed_db.monitor_brand_db }}</td>
            <td>{{ disposed_monitor.monitor_disposed_db.monitor_model_db }}</td>
            <td>{{ disposed_monitor.disposal_date }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% endif %}
    </div>
  </div>

  <!-- Add Monitor Modal -->
  <div class="modal fade" id="addMonitorModal" tabindex="-1" aria-labelledby="addMonitorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addMonitorModalLabel">Add New Monitor</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        {% if equipment_package and equipment_package.id %}
        <form method="POST" action="{% url 'add_monitor_to_package' equipment_package.id %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="mb-3">
              <label for="monitor_sn" class="form-label">Serial Number</label>
              <input type="text" class="form-control" id="monitor_sn" name="monitor_sn" required>
            </div>
            <div class="mb-3">
              <label for="monitor_brand_db" class="form-label">Brand</label>
              <select class="form-select" id="monitor_brand_db" name="monitor_brand_db" required>
                <option value="" disabled selected>Select Brand</option>
                {% for brandMonitor in monitor_brands %}
                <option value="{{ brandMonitor.id }}">{{ brandMonitor.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="mb-3">
              <label for="monitor_model" class="form-label">Model</label>
              <input type="text" class="form-control" id="monitor_model" name="monitor_model" required>
            </div>
            <div class="mb-3">
              <label for="monitor_size" class="form-label">Size</label>
              <input type="text" class="form-control" id="monitor_size" name="monitor_size" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Monitor</button>
          </div>
        </form>
        {% else %}
        <div class="alert alert-danger m-3">
          Desktop package not available. Please create it first.
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Edit Monitor Modal -->
  <div class="modal fade" id="editMonitorModal" tabindex="-1" aria-labelledby="editMonitorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form method="POST" action="{% url 'update_monitor' pk=monitor_detailse.id %}">
        {% csrf_token %}
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editMonitorModalLabel">Edit Monitor</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="editSN" class="form-label">Serial Number</label>
              <input type="text" class="form-control" id="editSN" name="monitor_sn_db" required value="{{ monitor_detailse.monitor_sn_db }}">
            </div>
            <div class="mb-3">
              <label for="editBrand" class="form-label">Brand</label>
              <select class="form-select" id="editBrand" name="monitor_brand_db" required>
                <option value="" disabled>Select Brand</option>
                {% for brandM in monitor_brands %}
                <option value="{{ brandM.id }}" {% if monitor_detailse.monitor_brand_db.id == brandM.id %}selected{% endif %}>{{ brandM.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="mb-3">
              <label for="editModel" class="form-label">Model</label>
              <input type="text" class="form-control" id="editModel" name="monitor_model_db" value="{{ monitor_detailse.monitor_model_db }}">
            </div>
            <div class="mb-3">
              <label for="editSize" class="form-label">Monitor Size</label>
              <input type="text" class="form-control" id="editSize" name="monitor_size_db" value="{{ monitor_detailse.monitor_size_db }}">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Update Monitor</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Confirm Dispose Modal -->
  <div class="modal fade" id="confirmDisposeModal_Monitor" tabindex="-1" aria-labelledby="confirmDisposeModal_Monitor" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmDisposeModal_Monitor">Confirm Disposal</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to dispose of this Monitor?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <form method="POST" action="{% url 'monitor_disposed' monitor_detailse.id %}" class="dispose-monitor-form d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Confirm Dispose</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
